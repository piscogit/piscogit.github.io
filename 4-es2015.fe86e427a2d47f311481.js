(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{Gwuq:function(t,e,n){"use strict";n.d(e,"a",(function(){return w}));var i=n("mrSG"),a=n("fXoL");let o=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Cb({type:t,selectors:[["app-forms-candidate-history-agg"]],decls:0,vars:0,template:function(t,e){},styles:[""]}),t})();var s=n("NrBX"),c=n("L5fO"),r=n("ofXK"),d=n("TEn/");function l(t,e){if(1&t&&(a.Nb(0,"span"),a.pc(1),a.Mb()),2&t){const t=a.Xb(2).$implicit,e=a.Xb(2);a.yb(1),a.rc(" ",e.candidateForm.formItem[t.key].templateDesc," ")}}function m(t,e){if(1&t&&(a.Nb(0,"div"),a.Nb(1,"div",7),a.Nb(2,"span"),a.pc(3),a.Mb(),a.nc(4,l,2,1,"span",8),a.Mb(),a.Mb()),2&t){const t=a.Xb().$implicit,e=a.hc(7),n=a.Xb(2);a.yb(3),a.qc(t.value.question),a.yb(1),a.dc("ngIf",n.candidateForm.formItem[t.key].templateDesc)("ngIfElse",e)}}function b(t,e){if(1&t&&(a.Nb(0,"span"),a.pc(1),a.Mb()),2&t){const t=a.Xb(2).$implicit,e=a.Xb(2);a.yb(1),a.rc(" ",e.candidateForm.formItem[t.key].templateDesc," ")}}function f(t,e){if(1&t&&(a.Nb(0,"div"),a.Nb(1,"div",7),a.Nb(2,"span"),a.pc(3),a.Mb(),a.nc(4,b,2,1,"span",8),a.Mb(),a.Mb()),2&t){const t=a.Xb().$implicit,e=a.hc(7),n=a.Xb(2);a.yb(3),a.qc(t.value.question),a.yb(1),a.dc("ngIf",n.candidateForm.formItem[t.key].templateDesc)("ngIfElse",e)}}function u(t,e){if(1&t&&(a.Nb(0,"span"),a.pc(1),a.Mb()),2&t){const t=a.Xb(2).$implicit,e=a.Xb(2);a.yb(1),a.rc(" ",e.candidateForm.formItem[t.key].value," ")}}function v(t,e){if(1&t&&(a.Nb(0,"div"),a.Nb(1,"div"),a.pc(2),a.Mb(),a.nc(3,u,2,1,"span",8),a.Mb()),2&t){const t=a.Xb().$implicit,e=a.hc(7),n=a.Xb(2);a.yb(2),a.rc("",t.value.question,":"),a.yb(1),a.dc("ngIf",n.candidateForm.formItem[t.key].value)("ngIfElse",e)}}function p(t,e){1&t&&a.Jb(0,"div")}function h(t,e){if(1&t&&(a.Nb(0,"span"),a.pc(1),a.Mb()),2&t){const t=a.Xb(3);a.yb(1),a.qc(t.langProvider.NoData)}}function g(t,e){if(1&t&&(a.Nb(0,"div"),a.Nb(1,"div",4),a.nc(2,m,5,3,"div",5),a.nc(3,f,5,3,"div",5),a.nc(4,v,4,3,"div",5),a.nc(5,p,1,0,"div",5),a.nc(6,h,2,1,"ng-template",null,6,a.oc),a.Mb(),a.Mb()),2&t){const t=e.$implicit;a.yb(1),a.dc("ngSwitch",t.value.type),a.yb(1),a.dc("ngSwitchCase","FormItemSingleSelect"),a.yb(1),a.dc("ngSwitchCase","FormItemMultiSelect"),a.yb(1),a.dc("ngSwitchCase","FormItemText"),a.yb(1),a.dc("ngSwitchCase","FormItemSeperator")}}function y(t,e){if(1&t&&(a.Lb(0),a.Nb(1,"ion-item"),a.Nb(2,"ion-label"),a.Nb(3,"div",1),a.Nb(4,"span"),a.pc(5),a.Mb(),a.Nb(6,"span",2),a.pc(7),a.Yb(8,"date"),a.Mb(),a.Mb(),a.nc(9,g,8,5,"div",3),a.Yb(10,"keyvalue"),a.Mb(),a.Mb(),a.Kb()),2&t){const t=a.Xb();a.yb(1),a.mc("direction",t.langProvider.LangDirection),a.yb(4),a.qc(t.task.name),a.yb(2),a.qc(a.ac(8,5,t.task.date,"dd/MM/yy HH:mm:ss")),a.yb(2),a.dc("ngForOf",a.Zb(10,8,t.taskConfig.formItems))}}let k=(()=>{class t{constructor(t,e,n){this.formsDelegator=t,this.tasksDelegator=e,this.langProvider=n}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.calcHistory()}))}calcHistory(){return Object(i.a)(this,void 0,void 0,(function*(){this.taskConfig=yield this.tasksDelegator.getTasksConfig(this.task.taskId),this.candidateForm=yield this.formsDelegator.loadCandidateTaskFormItem(this.task._id,this.candidate._id,this.taskConfig),this.isInit=!0}))}}return t.\u0275fac=function(e){return new(e||t)(a.Ib(w),a.Ib(s.a),a.Ib(c.b))},t.\u0275cmp=a.Cb({type:t,selectors:[["app-forms-candidate-history"]],inputs:{task:"task",candidate:"candidate"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[2,"direction","ltr"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["noData",""],[1,"formItem"],[4,"ngIf","ngIfElse"]],template:function(t,e){1&t&&a.nc(0,y,11,10,"ng-container",0),2&t&&a.dc("ngIf",e.isInit)},directives:[r.m,d.w,d.C,r.l,r.n,r.o],pipes:[r.e,r.g],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.formItem[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}"]}),t})();function I(t,e){if(1&t&&(a.Lb(0),a.Nb(1,"span",2),a.pc(2),a.Mb(),a.Nb(3,"span"),a.pc(4),a.Mb(),a.Kb()),2&t){const t=a.Xb();a.yb(2),a.qc(t.langProvider.FormCoverageCompleted),a.yb(2),a.sc("",t.langProvider.Full," - ",null==t.task.coverage?null:t.task.coverage.full.length,"")}}function C(t,e){if(1&t&&(a.Lb(0),a.Nb(1,"span",3),a.pc(2),a.Mb(),a.Nb(3,"span"),a.pc(4),a.Mb(),a.Nb(5,"span"),a.pc(6),a.Mb(),a.Kb()),2&t){const t=a.Xb();a.yb(2),a.qc(t.langProvider.FormCoverageNotCompleted),a.yb(2),a.sc("",t.langProvider.Full," - ",null==t.task.coverage?null:t.task.coverage.full.length,""),a.yb(2),a.sc("",t.langProvider.Partial," - ",null==t.task.coverage?null:t.task.coverage.partial.length,"")}}let S=(()=>{class t{constructor(t){this.langProvider=t}ngOnInit(){this.calcHistory()}calcHistory(){const t=new Set(this.task.coverage.full);this.isFormFullfil=this.candidates.filter(t=>"NotActive"!==t.status).every(e=>t.has(e._id))}}return t.\u0275fac=function(e){return new(e||t)(a.Ib(c.b))},t.\u0275cmp=a.Cb({type:t,selectors:[["app-forms-history"]],inputs:{task:"task",candidates:"candidates"},decls:3,vars:4,consts:[[1,"container"],[4,"ngIf"],[1,"completed"],[1,"notCompleted"]],template:function(t,e){1&t&&(a.Nb(0,"div",0),a.nc(1,I,5,3,"ng-container",1),a.nc(2,C,7,5,"ng-container",1),a.Mb()),2&t&&(a.mc("direction",e.langProvider.LangDirection),a.yb(1),a.dc("ngIf",e.isFormFullfil),a.yb(1),a.dc("ngIf",!e.isFormFullfil))},directives:[r.m],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.completed[_ngcontent-%COMP%]{color:green}.notCompleted[_ngcontent-%COMP%]{color:red}"]}),t})();var M=n("sHy1"),D=n("h7jJ"),O=n("nbnm"),N=n("ufmx");let w=(()=>{class t{constructor(t,e,n,i,a){this.dataProvider=t,this.entityNamer=e,this.taskDelegator=n,this.candidatesDelegator=i,this.langProvider=a}getComponentRoute(){return"forms"}getComponent(){return M.a}getHistoryComponent(){return S}getCandidateHistoryComponent(){return k}getCandidateAggregateComponent(){return o}getTaskConfig(t){throw new Error("Method not implemented.")}getTaskName(){throw new Error("Method not implemented.")}saveTask(t,e){var n,a,o,s;return Object(i.a)(this,void 0,void 0,(function*(){const i=[];t.main._id=null!==(n=t.main._id)&&void 0!==n?n:this.entityNamer.taskPrefixWithUniqueIdAnd(t.main.type,t.main.taskId),t.main._rev=t.main._rev,t.main.date=null!==(a=t.main.date)&&void 0!==a?a:new Date,t.main.updateDate=new Date;const c=this.calcCoverage(t,e);t.main.coverage=c,i.push(t.main);for(const e in t.items)if(Object.prototype.hasOwnProperty.call(t.items,e)){const n=t.items[e];n._id=null!==(o=n._id)&&void 0!==o?o:`${t.main._id.replace("main","item")}@${e}`,n._rev=n._rev,n.date=null!==(s=n.date)&&void 0!==s?s:new Date,n.updateDate=new Date,n.candidateId=e,i.push(n)}return yield this.dataProvider.saveEntities(i),t}))}loadTask(t){return Object(i.a)(this,void 0,void 0,(function*(){const e=yield this.dataProvider.loadTask(t),n=e._id.replace("main","item"),i=yield this.dataProvider.loadEntitiesByPrefix(n),a={main:e,items:{}};for(const t of i)a.items[t.candidateId]=t;return a}))}deleteTask(t){return Object(i.a)(this,void 0,void 0,(function*(){const e=[t],n=t._id.replace("main","item");(yield this.dataProvider.loadEntitiesByPrefix(n,{includeDocs:!1})).forEach(t=>e.push(t)),yield this.dataProvider.deleteEntities(e)}))}getTaskHistory(){throw new Error("Method not implemented.")}getTasksForCandidates(t){throw new Error("Method not implemented.")}calcCoverage(t,e){return Object.keys(t.items).reduce((n,i,a)=>{const o=t.items[i];let s=0;const c=Object.keys(o.formItem),r=Object.keys(e.formItems).filter(t=>e.formItems[t].isMandatory);for(const t of c)if(e.formItems[t].isMandatory&&o.formItem[t]){const e=o.formItem[t];(e.value||e.selection)&&s++}return s===r.length?n.full.push(i):s>0&&n.partial.push(i),n},{full:[],partial:[]})}checkTaskEmpty(t,e){var n,i;const a=this.calcCoverage(t,e);return!(t.main._id||(null===(n=a.full)||void 0===n?void 0:n.length)>0||(null===(i=a.partial)||void 0===i?void 0:i.length)>0)}exportCopy(t,e){return Object(i.a)(this,void 0,void 0,(function*(){const n=yield this.taskDelegator.getTasksConfig(e);return yield this.exportTask(t,n)}))}exportTask(t,e){return Object(i.a)(this,void 0,void 0,(function*(){const n=""+t.replace("main","item"),i=yield this.dataProvider.loadEntitiesByPrefix(n),a=this.candidatesDelegator.getCandidatesByIdsMap(i.map(t=>t.candidateId));i.sort((t,e)=>a[t.candidateId].number-a[e.candidateId].number);let o="";for(const s of i){const n=yield this.loadCandidateTaskFormItem(t,s.candidateId,e);o=`${o}\n${this.buildCandidateFormExport(a[n.candidateId],n,e)}`}return o}))}buildCandidateFormExport(t,e,n){var i;let a=`\n${this.langProvider.Candidate}: ${null!==(i=t.name)&&void 0!==i?i:t.number}, ${this.langProvider.Group}: ${t.group}\n----------------------------`;for(const o in n.formItems)if(Object.prototype.hasOwnProperty.call(n.formItems,o)){const t=n.formItems[o];let i;switch(t.type){case"FormItemText":const n=t;e.formItem[o].templateDesc&&(i=`${n.question}: ${e.formItem[o].templateDesc}`);break;case"FormItemSingleSelect":const a=t;e.formItem[o].templateDesc&&(i=`${a.question}: ${e.formItem[o].templateDesc}`);break;case"FormItemMultiSelect":const s=t;e.formItem[o].templateDesc&&(i=`${s.question}: ${e.formItem[o].templateDesc}`)}a=`${a}\n${null!=i?i:""}`}return a}loadCandidateTaskFormItem(t,e,n){return Object(i.a)(this,void 0,void 0,(function*(){const i=`${t.replace("main","item")}@${e}`,a=yield this.dataProvider.loadEntitiesByPrefix(i);let o;return(null==a?void 0:a.length)>0&&(o=a[0]),this.buildCandidateFormTemplateDesc(o,n),o}))}buildCandidateFormTemplateDesc(t,e){var n,i,a,o,s,c,r,d;for(const l of Object.keys(t.formItem))if(t.formItem[l]){const m=t.formItem[l];if("FormItemText"===m.type)m.templateDesc=m.value;else if("FormItemSingleSelect"===m.type){const t=null===(n=m)||void 0===n?void 0:n.selection;t&&(m.templateDesc=null===(o=null===(a=null===(i=e.formItems[l])||void 0===i?void 0:i.options)||void 0===a?void 0:a.find(e=>e.value===t))||void 0===o?void 0:o.desc)}else if("FormItemMultiSelect"===m.type&&(null===(s=m)||void 0===s?void 0:s.selection)){const t=[];for(const n of m.selection){const i=null===(d=null===(r=null===(c=e.formItems[l])||void 0===c?void 0:c.options)||void 0===r?void 0:r.find(t=>t.value===n))||void 0===d?void 0:d.desc;t.push(i)}m.templateDesc=t.join(",")}}}}return t.\u0275fac=function(e){return new(e||t)(a.Rb(D.a),a.Rb(O.a),a.Rb(s.a),a.Rb(N.a),a.Rb(c.b))},t.\u0275prov=a.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},sHy1:function(t,e,n){"use strict";n.d(e,"a",(function(){return $}));var i=n("mrSG"),a=n("kLqA"),o=n("fXoL"),s=n("TEn/"),c=n("ofXK"),r=n("g1yl");function d(t,e){if(1&t){const t=o.Ob();o.Nb(0,"ion-item",1),o.Vb("click",(function(){o.ic(t);const n=e.$implicit;return o.Xb().onSelectCandidate(n)})),o.Jb(1,"app-candidate-avatar",2),o.Nb(2,"span",3),o.pc(3),o.Mb(),o.Mb()}if(2&t){const t=e.$implicit;o.yb(1),o.dc("candidate",t),o.yb(2),o.qc(t.name)}}let l=(()=>{class t{constructor(t){this.popupCtrl=t,this.candidateSelected=new o.n}ngOnInit(){}onSelectCandidate(t){return Object(i.a)(this,void 0,void 0,(function*(){yield this.popupCtrl.dismiss(t)}))}trackByFn(t,e){return e?e._id:t}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(s.ib))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-candidates-list"]],inputs:{candidates:"candidates"},outputs:{candidateSelected:"candidateSelected"},decls:2,vars:2,consts:[["button","",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["button","",3,"click"],["slot","start",1,"avatar",3,"candidate"],["slot","end",1,"candidateName"]],template:function(t,e){1&t&&(o.Nb(0,"ion-list"),o.nc(1,d,4,2,"ion-item",0),o.Mb()),2&t&&(o.yb(1),o.dc("ngForOf",e.candidates)("ngForTrackBy",e.trackByFn))},directives:[s.D,c.l,s.w,r.a],styles:[".avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:var(--avatar-margin)}"]}),t})();var m=n("Mxx3"),b=n("AytR"),f=n("tyNb"),u=n("3LWr"),v=n("zrcv"),p=n("L5fO"),h=n("ufmx"),g=n("NrBX"),y=n("Gwuq");function k(t,e){if(1&t&&(o.Lb(0),o.Jb(1,"app-candidate-avatar",9),o.Nb(2,"span"),o.pc(3),o.Mb(),o.Kb()),2&t){const t=o.Xb(2);o.yb(1),o.dc("candidate",t.selectedCandidate),o.yb(2),o.qc(t.selectedCandidate.name)}}function I(t,e){if(1&t&&(o.Jb(0,"app-candidate-avatar",10),o.Nb(1,"span"),o.pc(2),o.Mb()),2&t){const t=o.Xb(2);o.yb(2),o.qc(t.langProvider.Select)}}function C(t,e){if(1&t){const t=o.Ob();o.Nb(0,"ion-header"),o.Nb(1,"ion-toolbar"),o.Nb(2,"ion-buttons",2),o.Jb(3,"ion-menu-button"),o.Mb(),o.Nb(4,"ion-buttons",3),o.Jb(5,"ion-back-button",4),o.Mb(),o.Nb(6,"ion-title"),o.Nb(7,"span"),o.pc(8),o.Mb(),o.Mb(),o.Mb(),o.Nb(9,"ion-button",5),o.Vb("click",(function(){return o.ic(t),o.Xb().onSelectCandidate()})),o.Nb(10,"div",6),o.nc(11,k,4,2,"ng-container",7),o.nc(12,I,3,1,"ng-template",null,8,o.oc),o.Mb(),o.Mb(),o.Mb()}if(2&t){const t=o.hc(13),e=o.Xb();o.yb(8),o.qc(null==e.taskDesc?null:e.taskDesc.description),o.yb(3),o.dc("ngIf",e.selectedCandidate)("ngIfElse",t)}}function S(t,e){if(1&t&&(o.Nb(0,"ion-select-option",23),o.pc(1),o.Mb()),2&t){const t=e.$implicit;o.dc("value",t.value),o.yb(1),o.rc(" ",t.desc," ")}}function M(t,e){if(1&t){const t=o.Ob();o.Nb(0,"ion-input",24),o.Vb("ionChange",(function(e){o.ic(t);const n=o.Xb(2).$implicit;return o.Xb(3).formSelectDescChanged(e,n)})),o.Mb()}if(2&t){const t=o.Xb(2).$implicit,e=o.Xb(3);o.dc("value",e.selectedCandidateSaveData.formItem[t.key].desc)("placeholder",e.langProvider.Explain)}}function D(t,e){if(1&t){const t=o.Ob();o.Nb(0,"div"),o.Nb(1,"span"),o.pc(2),o.Mb(),o.Nb(3,"ion-select",20),o.Vb("ionChange",(function(e){o.ic(t);const n=o.Xb().$implicit;return o.Xb(3).formSingleSelectChanged(e,n)})),o.nc(4,S,2,2,"ion-select-option",21),o.Mb(),o.nc(5,M,1,2,"ion-input",22),o.Mb()}if(2&t){const t=o.Xb().$implicit,e=o.Xb(3);o.yb(2),o.qc(t.value.question),o.yb(1),o.dc("placeholder",e.langProvider.Select)("interface",e.selectInterface)("value",e.selectedCandidateSaveData.formItem[t.key].selection),o.yb(1),o.dc("ngForOf",t.value.options),o.yb(1),o.dc("ngIf",t.value.isDescOption)}}function O(t,e){if(1&t&&(o.Nb(0,"ion-select-option",23),o.pc(1),o.Mb()),2&t){const t=e.$implicit;o.dc("value",t.value),o.yb(1),o.rc(" ",t.desc," ")}}function N(t,e){if(1&t){const t=o.Ob();o.Nb(0,"ion-input",24),o.Vb("ionChange",(function(e){o.ic(t);const n=o.Xb(2).$implicit;return o.Xb(3).formSelectDescChanged(e,n)})),o.Mb()}if(2&t){const t=o.Xb(2).$implicit,e=o.Xb(3);o.dc("value",e.selectedCandidateSaveData.formItem[t.key].desc)("placeholder",e.langProvider.Explain)}}function w(t,e){if(1&t){const t=o.Ob();o.Nb(0,"div"),o.Nb(1,"span"),o.pc(2),o.Mb(),o.Nb(3,"ion-select",25),o.Vb("ionChange",(function(e){o.ic(t);const n=o.Xb().$implicit;return o.Xb(3).formMultiSelectChanged(e,n)})),o.nc(4,O,2,2,"ion-select-option",21),o.Mb(),o.nc(5,N,1,2,"ion-input",22),o.Mb()}if(2&t){const t=o.Xb().$implicit,e=o.Xb(3);o.yb(2),o.qc(t.value.question),o.yb(1),o.dc("placeholder",e.langProvider.Select)("interface",e.selectInterface)("value",e.selectedCandidateSaveData.formItem[t.key].selection),o.yb(1),o.dc("ngForOf",t.value.options),o.yb(1),o.dc("ngIf",t.value.isDescOption)}}function F(t,e){if(1&t){const t=o.Ob();o.Nb(0,"div"),o.Nb(1,"ion-item"),o.Nb(2,"ion-label",26),o.pc(3),o.Mb(),o.Nb(4,"ion-input",27),o.Vb("ionChange",(function(e){o.ic(t);const n=o.Xb().$implicit;return o.Xb(3).formTextChanged(e,n)})),o.Mb(),o.Mb(),o.Mb()}if(2&t){const t=o.Xb().$implicit,e=o.Xb(3);o.yb(3),o.qc(t.value.question),o.yb(1),o.dc("type",t.value.isNumber?"number":"text")("value",e.selectedCandidateSaveData.formItem[t.key].value)}}function P(t,e){1&t&&(o.Nb(0,"div"),o.Jb(1,"hr"),o.Mb())}function T(t,e){if(1&t&&(o.Nb(0,"div"),o.Nb(1,"div",18),o.nc(2,D,6,6,"div",19),o.nc(3,w,6,6,"div",19),o.nc(4,F,5,3,"div",19),o.nc(5,P,2,0,"div",19),o.Mb(),o.Mb()),2&t){const t=e.$implicit;o.yb(1),o.dc("ngSwitch",t.value.type),o.yb(1),o.dc("ngSwitchCase","FormItemSingleSelect"),o.yb(1),o.dc("ngSwitchCase","FormItemMultiSelect"),o.yb(1),o.dc("ngSwitchCase","FormItemText"),o.yb(1),o.dc("ngSwitchCase","FormItemSeperator")}}function X(t,e){if(1&t&&(o.Nb(0,"div",16),o.nc(1,T,6,5,"div",17),o.Yb(2,"keyvalue"),o.Mb()),2&t){const t=o.Xb(2);o.mc("direction",t.langProvider.LangDirection),o.yb(1),o.dc("ngForOf",o.Zb(2,3,t.taskConfig.formItems))}}function x(t,e){if(1&t){const t=o.Ob();o.Nb(0,"ion-content",11),o.nc(1,X,3,5,"div",12),o.Nb(2,"ion-fab",13),o.Nb(3,"ion-fab-button",14),o.Vb("click",(function(){return o.ic(t),o.Xb().createComment()})),o.Jb(4,"ion-icon",15),o.Mb(),o.Mb(),o.Mb()}if(2&t){const t=o.Xb();o.yb(1),o.dc("ngIf",t.selectedCandidate)}}let $=(()=>{class t{constructor(t,e,n,i,a,o,s,c,r,d){this.router=t,this.route=e,this.store=n,this.msgService=i,this.langProvider=a,this.popoverController=o,this.candidatesDelegator=s,this.taskDelegator=c,this.popupCtrl=r,this.formsDelegator=d,this.selectInterface="popover"}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.taskSavedData=yield this.initTask(),this.taskSavedData=yield this.loadTask(),this.isTaskInit=!0}))}initTask(){var t;return Object(i.a)(this,void 0,void 0,(function*(){const e=null!==(t=this.route.snapshot.paramMap.get(m.a.TaskDescId))&&void 0!==t?t:"t13";this.candidates=yield this.candidatesDelegator.getCandidatesCopy(!0),this.taskDesc=yield this.taskDelegator.getTaskDesk(e),this.taskConfig=yield this.taskDelegator.getTasksConfig(e);const n={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description},items:{}},i={};for(const t in this.taskConfig.formItems){const e=this.taskConfig.formItems[t];if(e)switch(e.type){case"FormItemSingleSelect":i[t]={type:"FormItemSingleSelect"};break;case"FormItemMultiSelect":i[t]={type:"FormItemMultiSelect"};break;case"FormItemText":i[t]={type:"FormItemText"}}}for(const t of this.candidates)n.items[t._id]={taskId:this.taskDesc.id,type:this.taskDesc.type,candidateId:t._id,formItem:JSON.parse(JSON.stringify(i))};return n}))}ionViewWillLeave(){return Object(i.a)(this,void 0,void 0,(function*(){this.formsDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)?this.msgService.showToast(this.langProvider.TaskEmptyDismissed,b.a.taskSavedToastInterval):(this.taskSavedData=yield this.saveTask(),this.msgService.showToast(this.langProvider.TaskSaved,b.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date))}))}saveTask(){return Object(i.a)(this,void 0,void 0,(function*(){return yield this.formsDelegator.saveTask(this.taskSavedData,this.taskConfig)}))}loadTask(){return Object(i.a)(this,void 0,void 0,(function*(){const t=this.route.snapshot.paramMap.get(m.a.SavedTaskId);let e=this.taskSavedData;if(t){e=yield this.formsDelegator.loadTask(t);for(const t in this.taskSavedData.items)if(Object.prototype.hasOwnProperty.call(this.taskSavedData.items,t)){const n=this.taskSavedData.items[t];e.items[t]||(e.items[t]=n)}}return e}))}onSelectCandidate(){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield this.popoverController.create({component:l,componentProps:{candidates:this.candidates}});yield t.present();const e=yield t.onWillDismiss();e.data&&this.setSelectedCandidateFormSaveData(e.data)}))}setSelectedCandidateFormSaveData(t){this.selectedCandidate=t,this.selectedCandidateSaveData=this.taskSavedData.items[this.selectedCandidate._id]}formSingleSelectChanged(t,e){var n;(null===(n=this.selectedCandidateSaveData)||void 0===n?void 0:n.formItem[e.key])||(this.selectedCandidateSaveData.formItem[e.key]={type:"FormItemSingleSelect"}),this.selectedCandidateSaveData.formItem[e.key].selection=t.detail.value,console.log()}formMultiSelectChanged(t,e){var n;(null===(n=this.selectedCandidateSaveData)||void 0===n?void 0:n.formItem[e.key])||(this.selectedCandidateSaveData.formItem[e.key]={type:"FormItemMultiSelect"}),this.selectedCandidateSaveData.formItem[e.key].selection=t.detail.value,console.log()}formSelectDescChanged(t,e){this.selectedCandidateSaveData.formItem[e.key].desc=t.detail.value,console.log()}formTextChanged(t,e){var n;(null===(n=this.selectedCandidateSaveData)||void 0===n?void 0:n.formItem[e.key])||(this.selectedCandidateSaveData.formItem[e.key]={type:"FormItemText"}),this.selectedCandidateSaveData.formItem[e.key].value=t.detail.value,console.log()}onTempClick(){return Object(i.a)(this,void 0,void 0,(function*(){this.msgService.showModal(JSON.stringify(this.selectedCandidateSaveData))}))}createComment(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:a.Guid.raw()}],{skipLocationChange:!0})}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(f.f),o.Ib(f.a),o.Ib(u.a),o.Ib(v.a),o.Ib(p.b),o.Ib(s.ib),o.Ib(h.a),o.Ib(g.a),o.Ib(s.ib),o.Ib(y.a))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-forms"]],inputs:{isIntegrated:"isIntegrated"},decls:2,vars:2,consts:[[4,"ngIf"],["class","content",4,"ngIf"],["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],["color","dark",1,"selectBtn",3,"click"],[1,"selectCandi"],[4,"ngIf","ngIfElse"],["noSelectedCandidate",""],[1,"avatar2",3,"candidate"],[1,"avatar2"],[1,"content"],["class","form",3,"direction",4,"ngIf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],["color","primary",3,"click"],["name","chatbox-ellipses"],[1,"form"],[4,"ngFor","ngForOf"],[1,"formItem",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"placeholder","interface","value","ionChange"],[3,"value",4,"ngFor","ngForOf"],["class","selectDesc",3,"value","placeholder","ionChange",4,"ngIf"],[3,"value"],[1,"selectDesc",3,"value","placeholder","ionChange"],["multiple","",3,"placeholder","interface","value","ionChange"],["position","floating"],[3,"type","value","ionChange"]],template:function(t,e){1&t&&(o.nc(0,C,14,3,"ion-header",0),o.nc(1,x,5,1,"ion-content",1)),2&t&&(o.dc("ngIf",!e.isIntegrated),o.yb(1),o.dc("ngIf",e.isTaskInit))},directives:[c.m,s.s,s.Z,s.k,s.F,s.g,s.h,s.X,s.j,r.a,s.n,s.o,s.p,s.t,c.l,c.n,c.o,s.Q,s.kb,s.R,s.v,s.lb,s.w,s.C],pipes:[c.g],styles:[".candidates[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]{height:100%;overflow:scroll}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-content:flex-start;width:100%;margin-top:1rem}.formItem[_ngcontent-%COMP%]{margin-bottom:1rem}.avatar[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.avatar[_ngcontent-%COMP%], .avatar2[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.selectedCandidate[_ngcontent-%COMP%]{background:#f08080}.selectBtn[_ngcontent-%COMP%]{height:auto;width:100%}.selectCandi[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;justify-content:space-between;align-items:center}hr[_ngcontent-%COMP%]{display:block;position:relative;padding:0;margin:8px auto;height:0;width:100%;max-height:0;font-size:1px;line-height:0;clear:both;border:none;border-top:.1rem solid var(--ion-color-dark);border-bottom:.1rem solid var(--ion-color-dark);height:1rem}"]}),t})()}}]);