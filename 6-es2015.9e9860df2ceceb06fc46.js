(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{LTzM:function(t,e,i){"use strict";i.r(e),i.d(e,"CreateCommentPageModule",(function(){return S}));var n=i("ofXK"),a=i("3Pt+"),o=i("TEn/"),s=i("tyNb"),d=i("mrSG"),c=i("Mxx3"),r=i("+Ff3"),l=i("fXoL"),m=i("NrBX"),b=i("nTzd"),h=i("ufmx"),v=i("zrcv"),g=i("L5fO"),u=i("3LWr"),C=i("5+WD"),f=i("g1yl");function p(t,e){if(1&t&&l.Jb(0,"app-candidate-avatar",19),2&t){const t=l.Xb().$implicit,e=l.Xb();l.dc("candidate",t)("isSelected",e.selectedCandidates[t._id])}}function k(t,e){if(1&t&&l.Jb(0,"app-candidate-avatar",19),2&t){const t=l.Xb().$implicit,e=l.Xb();l.dc("candidate",t)("isSelected",e.selectedCandidates[t._id])}}function D(t,e){1&t&&l.Jb(0,"span",20)}function y(t,e){if(1&t){const t=l.Ob();l.Nb(0,"div",13),l.Nb(1,"ion-item",14),l.Vb("click",(function(){l.ic(t);const i=e.$implicit;return l.Xb().selectCandidate(i)})),l.Jb(2,"app-candidate-avatar",15),l.nc(3,p,1,2,"app-candidate-avatar",16),l.nc(4,k,1,2,"app-candidate-avatar",17),l.Mb(),l.nc(5,D,1,0,"span",18),l.Mb()}if(2&t){const t=e.$implicit,i=l.Xb();l.yb(1),l.dc("cdkDragStartDelay",i.dragDelay),l.yb(1),l.dc("candidate",t)("isSelected",i.selectedCandidates[t._id]),l.yb(3),l.dc("ngIf",i.store.isIos)}}function M(t,e){if(1&t){const t=l.Ob();l.Nb(0,"ion-item",21),l.Vb("click",(function(){l.ic(t);const i=e.$implicit;return l.Xb().savedCommentSelected(i)})),l.Nb(1,"ion-label"),l.Nb(2,"span"),l.pc(3),l.Mb(),l.Mb(),l.Mb()}if(2&t){const t=e.$implicit;l.yb(3),l.qc(t.comment)}}const P=[{path:"",component:(()=>{class t{constructor(t,e,i,n,a,o,s,d,r){this.navCtrl=t,this.route=e,this.router=i,this.tasksDelegator=n,this.tasksCommentsDelegator=a,this.candidatesDelegator=o,this.msgService=s,this.langProvider=d,this.store=r,this.selectedCandidates={},this.dragDelay=c.a.DragDelay,this.title=this.langProvider.GeneralComment,this.isInit=!1}ngOnInit(){var t,e,i;return Object(d.a)(this,void 0,void 0,(function*(){this.candidates=yield this.candidatesDelegator.getCandidatesCopy(!0),this.savedComments=r.c;const n=this.route.snapshot.paramMap.get(c.a.TaskDescId);n&&(this.taskDescRef=yield this.tasksDelegator.getTaskDesk(n),this.taskConfigRef=yield this.tasksDelegator.getTasksConfig(n),this.title=this.taskDescRef.description,this.savedComments=[...null!==(t=this.taskConfigRef.comments)&&void 0!==t?t:[],...null!==(e=this.savedComments)&&void 0!==e?e:[]]);const a=this.route.snapshot.paramMap.get(c.a.Navigate);a&&this.store.editComment.value.id===a&&(this.editedComment=this.store.editComment.value.data,this.editedComment&&(this.comment=this.editedComment.comment,this.editedComment.candidates.forEach(t=>this.selectedCandidates[t._id]=t),this.taskDescRef=this.editedComment.TaskDescRef,this.title=null===(i=this.editedComment.TaskDescRef)||void 0===i?void 0:i.description)),this.isInit=!0}))}ngOnDestroy(){}selectCandidate(t){this.selectedCandidates[t._id]=this.selectedCandidates[t._id]?null:t}dropCandidates(t){}createComment(){var t,e;return Object(d.a)(this,void 0,void 0,(function*(){this.editedComment&&(yield this.tasksCommentsDelegator.deleteComments(this.editedComment.SavedComments));const i=Object.keys(this.selectedCandidates).filter(t=>this.selectedCandidates[t]).map(t=>this.selectedCandidates[t]);if(0===i.length)this.msgService.showToast(this.langProvider.NoneSelectedCandidates,1e3,"toastWarn");else if(null===(t=this.comment)||void 0===t?void 0:t.trim()){const t={candidates:i,comment:this.comment,TaskDescRef:this.taskDescRef,date:null===(e=this.editedComment)||void 0===e?void 0:e.date},n=yield this.tasksCommentsDelegator.createComment(t);if(this.store.lastCommentsChangeDateTime.next(n[0].date),this.msgService.showToast(this.langProvider.CommentSaved+"..."),this.taskDescRef){const t=this.store.lastTaskNavData;yield this.router.navigate([t.value.Path,t.value.Params],t.value.NavigationExtras)}else yield this.router.navigate(["tabs/comments"],{skipLocationChange:!0})}else this.msgService.showToast(this.langProvider.EmptyComment,1e3,"toastWarn")}))}savedCommentSelected(t){this.comment=`${this.comment?this.comment+"\n":""}${t.comment}`}addSavedComment(){return Object(d.a)(this,void 0,void 0,(function*(){}))}back(t){var e;return Object(d.a)(this,void 0,void 0,(function*(){(null===(e=this.comment)||void 0===e?void 0:e.trim())&&(yield this.msgService.showAreYouSure(this.langProvider.CommentNotSaved))&&this.navCtrl.back()}))}}return t.\u0275fac=function(e){return new(e||t)(l.Ib(o.fb),l.Ib(s.a),l.Ib(s.f),l.Ib(m.a),l.Ib(b.a),l.Ib(h.a),l.Ib(v.a),l.Ib(g.b),l.Ib(u.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-create-comment"]],decls:23,vars:14,consts:[["slot","start"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],["cdkDropListGroup","",1,"container"],["lines","none","id","candidates","cdkDropList","","cdkDropListSortingDisabled","",1,"candidates",3,"cdkDropListData","cdkDropListDropped"],["class","iosDndFixItem",4,"ngFor","ngForOf"],[1,"commentArea"],["autocomplete","on","rows","5",1,"commentText",3,"ngModel","placeholder","ngModelChange"],[1,"commentBtns"],["disabled","","color","success",3,"click"],[1,"savedComments"],["button","",3,"click",4,"ngFor","ngForOf"],[1,"iosDndFixItem"],["cdkDrag","",3,"cdkDragStartDelay","click"],[1,"avatar","avatarMargin",3,"candidate","isSelected"],["class","avatar",3,"candidate","isSelected",4,"cdkDragPreview"],["class","avatar",3,"candidate","isSelected",4,"cdkDragPlaceholder"],["class","iosDndFixGap",4,"ngIf"],[1,"avatar",3,"candidate","isSelected"],[1,"iosDndFixGap"],["button","",3,"click"]],template:function(t,e){1&t&&(l.Nb(0,"ion-header"),l.Nb(1,"ion-toolbar"),l.Nb(2,"ion-buttons",0),l.Jb(3,"ion-menu-button"),l.Mb(),l.Nb(4,"ion-buttons",1),l.Nb(5,"ion-button",2),l.Vb("click",(function(t){return e.back(t)})),l.Jb(6,"ion-icon",3),l.Mb(),l.Mb(),l.Nb(7,"ion-title"),l.pc(8),l.Mb(),l.Mb(),l.Mb(),l.Nb(9,"ion-content"),l.Nb(10,"div",4),l.Nb(11,"ion-list",5),l.Vb("cdkDropListDropped",(function(t){return e.dropCandidates(t)})),l.nc(12,y,6,4,"div",6),l.Mb(),l.Nb(13,"div",7),l.Nb(14,"ion-textarea",8),l.Vb("ngModelChange",(function(t){return e.comment=t})),l.Mb(),l.Nb(15,"div",9),l.Nb(16,"ion-button",10),l.Vb("click",(function(){return e.addSavedComment()})),l.pc(17),l.Mb(),l.Nb(18,"ion-button",2),l.Vb("click",(function(){return e.createComment()})),l.pc(19),l.Mb(),l.Mb(),l.Nb(20,"div",11),l.Nb(21,"ion-list"),l.nc(22,M,4,1,"ion-item",12),l.Mb(),l.Mb(),l.Mb(),l.Mb(),l.Mb()),2&t&&(l.yb(7),l.mc("direction",e.langProvider.LangDirection),l.yb(1),l.qc(e.title),l.yb(3),l.dc("cdkDropListData",e.candidates),l.yb(1),l.dc("ngForOf",e.candidates),l.yb(2),l.mc("direction",e.langProvider.LangDirection),l.dc("ngModel",e.comment)("placeholder",e.langProvider.CreateComment),l.yb(3),l.qc(e.langProvider.CreateSavedComment),l.yb(2),l.qc(e.langProvider.CreateComment),l.yb(2),l.mc("direction",e.langProvider.LangDirection),l.yb(1),l.dc("ngForOf",e.savedComments))},directives:[o.s,o.Z,o.k,o.F,o.j,o.t,o.X,o.n,C.e,o.D,C.d,n.l,o.W,o.lb,a.d,a.g,o.w,C.a,f.a,C.c,C.b,n.m,o.C],styles:["ion-content[_ngcontent-%COMP%]{--overflow:hidden}.container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{height:100%;width:auto;overflow:scroll;min-width:var(--avatar-empty-width)}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.avatarComment[_ngcontent-%COMP%]{height:2rem;width:2rem}.commentArea[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;justify-content:flex-start;flex:1}.commentText[_ngcontent-%COMP%]{color:var(--ion-color-dark);max-height:20%}.candidateSelected[_ngcontent-%COMP%]{background:#d6b8b8;border:#b43434;border-radius:90rem;border-style:solid;border-width:.1rem}.commentBtns[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.closeBtn[_ngcontent-%COMP%]{margin-left:auto;--background:transparent;--color:var(--ion-color-dark)}.savedComments[_ngcontent-%COMP%]{overflow:scroll}"]}),t})()}];let w=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[s.h.forChild(P)],s.h]}),t})();var N=i("ajeZ");let S=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(e){return new(e||t)},imports:[[n.c,a.a,o.bb,w,N.a,C.f]]}),t})()}}]);