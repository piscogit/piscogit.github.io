!function(){function t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,d=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){d=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(d)throw r}}}}function a(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=new Array(a);e<a;e++)n[e]=t[e];return n}function e(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function n(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,a,e){return a&&n(t.prototype,a),e&&n(t,e),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"43kj":function(a,n,s){"use strict";s.d(n,"a",(function(){return R}));var r=s("mrSG"),o=s("Mxx3"),d=s("AytR"),c=s("kLqA"),l=s("fXoL"),u=s("tyNb"),k=s("3LWr"),v=s("zrcv"),b=s("L5fO"),h=s("TEn/"),p=s("ufmx"),f=s("NrBX"),m=s("pQKU"),g=s("ofXK"),y=s("5+WD"),D=s("g1yl");function C(t,a){if(1&t&&(l.Nb(0,"ion-header"),l.Nb(1,"ion-toolbar"),l.Nb(2,"ion-buttons",6),l.Jb(3,"ion-menu-button"),l.Mb(),l.Nb(4,"ion-buttons",7),l.Jb(5,"ion-back-button",8),l.Mb(),l.Nb(6,"ion-title"),l.pc(7),l.Mb(),l.Mb(),l.Mb()),2&t){var e=l.Xb();l.yb(7),l.qc(null==e.taskDesc?null:e.taskDesc.description)}}function w(t,a){if(1&t&&l.Jb(0,"app-candidate-avatar",13),2&t){var e=l.Xb().$implicit;l.dc("candidate",e)}}function M(t,a){if(1&t&&l.Jb(0,"app-candidate-avatar",13),2&t){var e=l.Xb().$implicit;l.dc("candidate",e)}}function B(t,a){if(1&t){var e=l.Ob();l.Nb(0,"ion-item",9),l.Vb("click",(function(){l.ic(e);var t=a.$implicit;return l.Xb().selectCandidate(t)})),l.Jb(1,"app-candidate-avatar",10),l.nc(2,w,1,1,"app-candidate-avatar",11),l.nc(3,M,1,1,"app-candidate-avatar",12),l.Mb()}if(2&t){var n=a.$implicit,i=l.Xb();l.dc("cdkDragStartDelay",i.dragDelay),l.yb(1),l.dc("candidate",n)}}function S(t,a){if(1&t&&l.Jb(0,"app-candidate-avatar",27),2&t){var e=l.Xb().$implicit;l.dc("candidateId",e.candidate)}}function I(t,a){if(1&t&&l.Jb(0,"app-candidate-avatar",27),2&t){var e=l.Xb().$implicit;l.dc("candidateId",e.candidate)}}function O(t,a){if(1&t&&(l.Nb(0,"div",23),l.Jb(1,"app-candidate-avatar",24),l.nc(2,S,1,1,"app-candidate-avatar",25),l.nc(3,I,1,1,"app-candidate-avatar",26),l.Mb()),2&t){var e=a.$implicit,n=l.Xb(4);l.dc("cdkDragStartDelay",n.dragDelay),l.yb(1),l.dc("candidateId",e.candidate)("total",e.total)("isShowTotal",n.taskConfig.isCandidateMultiBasket)}}function x(t,a){if(1&t){var e=l.Ob();l.Nb(0,"div",28),l.Vb("click",(function(){l.ic(e);var t=l.Xb().$implicit;return l.Xb(3).showBasketDetails(t)})),l.Jb(1,"ion-icon",29),l.Nb(2,"ion-badge",30),l.pc(3),l.Mb(),l.Mb()}if(2&t){var n=l.Xb().$implicit,i=l.Xb(3);l.yb(3),l.rc("+",i.taskSavedData.main.baskets[n.name].size-i.previewSize,"")}}function P(t,a){if(1&t){var e=l.Ob();l.Nb(0,"ion-chip",18),l.Vb("click",(function(){l.ic(e);var t=a.$implicit;return l.Xb(3).selectBasket(t.name)}))("cdkDropListDropped",(function(t){l.ic(e);var n=a.$implicit;return l.Xb(3).dropBasket(t,n)})),l.Nb(1,"ion-label",19),l.pc(2),l.Mb(),l.Nb(3,"div",20),l.nc(4,O,4,4,"div",21),l.nc(5,x,4,1,"div",22),l.Mb(),l.Mb()}if(2&t){var n=a.$implicit,i=l.Xb(3);l.mc("direction",i.taskDesc.langDir),l.Ab("selectedBasket",n.name===i.selectedBasket),l.dc("cdkDropListData",i.taskSavedData.main.baskets[n.name].preview),l.yb(2),l.qc(n.name),l.yb(2),l.dc("ngForOf",i.taskSavedData.main.baskets[n.name].preview),l.yb(1),l.dc("ngIf",i.taskSavedData.main.baskets[n.name].size>i.previewSize)}}function N(t,a){if(1&t&&(l.Lb(0),l.nc(1,P,6,8,"ion-chip",17),l.Kb()),2&t){var e=l.Xb(2);l.yb(1),l.dc("ngForOf",e.taskConfig.baskets)}}function T(t,a){if(1&t&&l.Jb(0,"app-candidate-avatar",27),2&t){var e=l.Xb().$implicit;l.dc("candidateId",e.candidate)}}function _(t,a){if(1&t&&l.Jb(0,"app-candidate-avatar",27),2&t){var e=l.Xb().$implicit;l.dc("candidateId",e.candidate)}}var L=function(t){return[t]};function F(t,a){if(1&t){var e=l.Ob();l.Nb(0,"div",38),l.Vb("cdkDropListDropped",(function(t){return l.ic(e),l.Xb(3).dropBasketDetails(t)})),l.Nb(1,"div",39),l.Jb(2,"app-candidate-avatar",24),l.nc(3,T,1,1,"app-candidate-avatar",26),l.nc(4,_,1,1,"app-candidate-avatar",25),l.Mb(),l.Mb()}if(2&t){var n=a.$implicit,i=l.Xb(3);l.dc("id",i.basketDetails.name)("cdkDropListData",l.fc(6,L,n)),l.yb(1),l.dc("cdkDragStartDelay",i.dragDelay),l.yb(1),l.dc("candidateId",n.candidate)("total",n.total)("isShowTotal",i.taskConfig.isCandidateMultiBasket)}}function X(t,a){if(1&t){var e=l.Ob();l.Lb(0),l.Nb(1,"ion-chip",31),l.Vb("click",(function(){l.ic(e);var t=l.Xb(2);return t.selectBasket(t.basketDetails.name)})),l.Nb(2,"div",32),l.Nb(3,"ion-button",33),l.Vb("click",(function(){return l.ic(e),l.Xb(2).changeToBasketMode()})),l.Jb(4,"ion-icon",34),l.Mb(),l.Nb(5,"ion-label",35),l.pc(6),l.Mb(),l.Mb(),l.Nb(7,"div",36),l.nc(8,F,5,8,"div",37),l.Mb(),l.Mb(),l.Kb()}if(2&t){var n=l.Xb(2);l.yb(1),l.mc("direction",n.taskDesc.langDir),l.Ab("selectedBasket",n.basketDetails.name===n.selectedBasket),l.yb(5),l.qc(n.basketDetails.name),l.yb(2),l.dc("ngForOf",n.taskSavedData.main.baskets[n.basketDetails.name].all)}}function A(t,a){if(1&t&&(l.Nb(0,"div",14),l.Lb(1,15),l.nc(2,N,2,1,"ng-container",16),l.nc(3,X,9,6,"ng-container",16),l.Kb(),l.Mb()),2&t){var e=l.Xb();l.yb(1),l.dc("ngSwitch",e.basketsMode),l.yb(1),l.dc("ngSwitchCase","AllBaskets"),l.yb(1),l.dc("ngSwitchCase","DetailedBasket")}}function j(t,a){if(1&t){var e=l.Ob();l.Nb(0,"ion-fab",40),l.Nb(1,"ion-fab-button",41),l.Vb("click",(function(){return l.ic(e),l.Xb().createComment()})),l.Jb(2,"ion-icon",42),l.Mb(),l.Mb()}}var R=function(){var a=function(){function a(t,n,i,s,r,d,c,l,u){e(this,a),this.router=t,this.route=n,this.store=i,this.msgService=s,this.langProvider=r,this.popoverController=d,this.candidatesDelegator=c,this.taskDelegator=l,this.basketDelegator=u,this.dragDelay=o.a.DragDelay,this.previewSize=4,this.basketsMode="AllBaskets"}return i(a,[{key:"ngOnInit",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initTask();case 2:if(this.taskSavedData=t.sent,t.t0=this.integrated,t.t0){t.next=8;break}return t.next=7,this.loadTask();case 7:this.taskSavedData=t.sent;case 8:this.isTaskInit=!0;case 9:case"end":return t.stop()}}),t,this)})))}},{key:"ionViewWillLeave",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.basketDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)){t.next=4;break}this.msgService.showToast(this.langProvider.TaskEmptyDismissed,d.a.taskSavedToastInterval),t.next=9;break;case 4:return t.next=6,this.saveTask();case 6:this.taskSavedData=t.sent,this.msgService.showToast(this.langProvider.TaskSaved,d.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"initTask",value:function(){var a,e,n;return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var s,r,d,c,l;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=null!==(n=null!==(e=null===(a=this.integrated)||void 0===a?void 0:a.parentTaskId)&&void 0!==e?e:this.route.snapshot.paramMap.get(o.a.TaskDescId))&&void 0!==n?n:"t13",i.next=3,this.candidatesDelegator.getCandidatesCopy();case 3:return this.candidates=i.sent,i.next=6,this.taskDelegator.getTaskDesk(s);case 6:return this.taskDesc=i.sent,i.next=9,this.taskDelegator.getTasksConfig(s);case 9:this.taskConfig=i.sent,r={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,candidates:this.candidates.map((function(t){return t._id})),baskets:{}}},d=t(this.taskConfig.baskets);try{for(d.s();!(c=d.n()).done;)l=c.value,r.main.baskets[l.name]={name:l.name,size:0,preview:[],all:[]}}catch(u){d.e(u)}finally{d.f()}return i.abrupt("return",(this.taskConfig.isCandidatesStatic?(this.dropCandidates=this.dropCandidatesStatic,this.handleCandidateAfterBasketDrop=this.handleCandidateStaticAfterBasketDrop):(this.taskConfig.isCandidateMultiBasket=!1,this.dropCandidates=this.dropCandidatesNoneStatic,this.handleCandidateAfterBasketDrop=this.handleCandidateNoneStaticAfterBasketDrop),this.taskConfig.isCandidateMultiBasket?(this.dropBasket=this.dropBasketMulti,this.dropBasketDetails=this.dropBasketDetailsMulti,this.removeCandidateFromBasket=this.removeCandidateFromBasketMulti,this.removeCandidateFromBasketDetails=this.removeCandidateFromBasketDetailsMulti,this.pushCandidateToBasket=this.pushCandidateToBasketMulti):(this.dropBasket=this.dropBasketNoneMulti,this.dropBasketDetails=this.dropBasketDetailsNoneMulti,this.removeCandidateFromBasket=this.removeCandidateFromBasketNoneMulti,this.removeCandidateFromBasketDetails=this.removeCandidateFromBasketDetailsNoneMulti,this.pushCandidateToBasket=this.pushCandidateToBasketNoneMulti),r));case 14:case"end":return i.stop()}}),i,this)})))}},{key:"saveTask",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.basketDelegator.saveTask(this.taskSavedData,this.taskConfig);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"saveTaskIntegrated",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)})))}},{key:"loadTask",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=this.route.snapshot.paramMap.get(o.a.SavedTaskId))){t.next=11;break}return this.isTaskUpdate=!0,t.next=5,this.basketDelegator.loadTask(a);case 5:return e=t.sent,t.next=8,this.candidatesDelegator.getCandidatesByIds(e.main.candidates);case 8:this.candidates=t.sent,this.setLoadedData(e),this.taskSavedData=e;case 11:return t.abrupt("return",this.taskSavedData);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"setLoadedData",value:function(a){var e=this;for(var n in a.main.baskets)if(Object.prototype.hasOwnProperty.call(a.main.baskets,n)){var i,s=a.main.baskets[n],r=[],o=t(s.preview);try{var d=function(){var t=i.value,a=s.all.find((function(a){return a.candidate===t.candidate}));r.push(a)};for(o.s();!(i=o.n()).done;)d()}catch(c){o.e(c)}finally{o.f()}s.preview=r}this.taskConfig.isCandidatesStatic||function(){var n=new Set;for(var i in a.main.baskets)Object.prototype.hasOwnProperty.call(a.main.baskets,i)&&a.main.baskets[i].all.forEach((function(t){return n.add(t.candidate)}));var s,r=t(n);try{var o=function(){var t=s.value;e.candidates=e.candidates.filter((function(a){return a._id!==t}))};for(r.s();!(s=r.n()).done;)o()}catch(c){r.e(c)}finally{r.f()}}()}},{key:"loadTaskIntegrated",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return this.taskSavedData=t,a.next=3,this.setLoadedData(t);case 3:case"end":return a.stop()}}),a,this)})))}},{key:"handleCandidateStaticAfterBasketDrop",value:function(t){}},{key:"handleCandidateNoneStaticAfterBasketDrop",value:function(t){this.candidates=this.candidates.filter((function(a){return a._id!==t._id}))}},{key:"dropCandidatesStatic",value:function(t){if("candidates"!==t.previousContainer.id)if("baskets"===t.previousContainer.id)this.removeCandidateFromBasket(t.previousContainer.data,t.previousIndex);else{var a=this.taskSavedData.main.baskets[t.previousContainer.id].all,e=t.previousContainer.data[t.previousIndex],n=a.findIndex((function(t){return t.candidate===e.candidate}));this.removeCandidateFromBasketDetails(a,n,t.previousContainer.id)}}},{key:"dropCandidatesNoneStatic",value:function(t){if("candidates"!==t.previousContainer.id){var a=this.candidatesDelegator.getCandidatesByIds([t.previousContainer.data[0].candidate])[0];if(this.candidates.push(a),this.candidates.sort((function(t,a){return t.number-a.number})),"baskets"===t.previousContainer.id)this.removeCandidateFromBasket(t.previousContainer.data,t.previousIndex);else{var e=this.taskSavedData.main.baskets[t.previousContainer.id].all,n=t.previousContainer.data[t.previousIndex],i=e.findIndex((function(t){return t.candidate===n.candidate}));this.removeCandidateFromBasketDetails(e,i,t.previousContainer.id)}console.log()}}},{key:"dropBasketNoneMulti",value:function(t,a){if(this.selectedBasket=this.selectedBasket===a.name?a.name:null,t.previousContainer===t.container);else{var e=t.previousContainer.data[t.previousIndex];if("candidates"===t.previousContainer.id){var n=e;this.checkIfCandidateExistInOtherBaskets(a,n)?this.msgService.showToast(this.langProvider.CandidateAlreadyExistInBasket,null,o.b.ToastWarn):(this.pushCandidateToBasketNoneMulti(a.name,n),this.handleCandidateAfterBasketDrop(n))}else{this.removeCandidateFromBasketNoneMulti(t.previousContainer.data,t.previousIndex);var i=this.candidatesDelegator.getCandidatesByIds([e.candidate])[0];this.pushCandidateToBasketNoneMulti(a.name,i)}}}},{key:"dropBasketMulti",value:function(t,a){if(this.selectedBasket=this.selectedBasket===a.name?a.name:null,t.previousContainer===t.container);else{var e=t.previousContainer.data[t.previousIndex];if("candidates"===t.previousContainer.id)this.pushCandidateToBasketMulti(a.name,e),this.handleCandidateAfterBasketDrop(e);else{this.removeCandidateFromBasketMulti(t.previousContainer.data,t.previousIndex);var n=this.candidatesDelegator.getCandidatesByIds([e.candidate])[0];this.pushCandidateToBasketMulti(a.name,n)}}}},{key:"dropBasketDetailsNoneMulti",value:function(t){if(t.previousContainer===t.container);else{var a=this.candidates[t.previousIndex],e=this.taskSavedData.main.baskets[t.container.id],n=this.checkIfCandidateExistInOtherBaskets(e,a);n?this.msgService.showToast("already exist in "+n):(this.pushCandidateToBasketNoneMulti(e.name,a),this.handleCandidateAfterBasketDrop(a))}}},{key:"dropBasketDetailsMulti",value:function(t){t.previousContainer===t.container||this.pushCandidateToBasketMulti(this.taskSavedData.main.baskets[t.container.id].name,this.candidates[t.previousIndex])}},{key:"pushCandidateToBasketNoneMulti",value:function(t,a){var e=this.taskSavedData.main.baskets[t].all.find((function(t){return t.candidate===a._id}));e?this.msgService.showToast(this.langProvider.CandidateAlreadyExistInBasket,null,o.b.ToastWarn):(e={candidate:a._id,total:1},this.taskSavedData.main.baskets[t].all.push(e),this.taskSavedData.main.baskets[t].preview.push(e),this.calcBasketPreview(t),this.handleCandidateAfterBasketDrop(a))}},{key:"pushCandidateToBasketMulti",value:function(t,a){var e=this.taskSavedData.main.baskets[t].all.find((function(t){return t.candidate===a._id}));if(e){e.total++;var n=this.taskSavedData.main.baskets[t].all.findIndex((function(t){return t.candidate===a._id}));n!==this.taskSavedData.main.baskets[t].all.length-1&&(this.taskSavedData.main.baskets[t].all.splice(n,1),this.taskSavedData.main.baskets[t].all.push(e),this.taskSavedData.main.baskets[t].preview.push(e),this.calcBasketPreview(t))}else e={candidate:a._id,total:1},this.taskSavedData.main.baskets[t].all.push(e),this.taskSavedData.main.baskets[t].preview.push(e),this.calcBasketPreview(t)}},{key:"calcBasketPreview",value:function(t){this.taskSavedData.main.baskets[t].preview=this.taskSavedData.main.baskets[t].all.slice(Math.max(0,this.taskSavedData.main.baskets[t].all.length-this.previewSize),this.taskSavedData.main.baskets[t].all.length),this.taskSavedData.main.baskets[t].size=this.taskSavedData.main.baskets[t].all.length}},{key:"findBasket",value:function(t){var a=this;return Object.keys(this.taskSavedData.main.baskets).find((function(e){return a.taskSavedData.main.baskets[e].preview===t}))}},{key:"checkIfCandidateExistInOtherBaskets",value:function(t,a){var e=null;for(var n in this.taskSavedData.main.baskets)if(Object.prototype.hasOwnProperty.call(this.taskSavedData.main.baskets,n)){var i=this.taskSavedData.main.baskets[n];if(i.name!==t.name&&i.all.find((function(t){return t.candidate===a._id}))){e=i.name;break}}return e}},{key:"removeCandidateFromBasketNoneMulti",value:function(t,a,e){e=null!=e?e:this.findBasket(t);var n=this.taskSavedData.main.baskets[e].preview[a];this.taskSavedData.main.baskets[e].preview.splice(a,1);var i=this.taskSavedData.main.baskets[e].all.indexOf(n);this.taskSavedData.main.baskets[e].all.splice(i,1),this.calcBasketPreview(e)}},{key:"removeCandidateFromBasketMulti",value:function(t,a,e){e=null!=e?e:this.findBasket(t);var n=this.taskSavedData.main.baskets[e].preview[a];if(n.total>1)n.total--;else{this.taskSavedData.main.baskets[e].preview.splice(a,1);var i=this.taskSavedData.main.baskets[e].all.indexOf(n);this.taskSavedData.main.baskets[e].all.splice(i,1),this.calcBasketPreview(e)}}},{key:"removeCandidateFromBasketDetailsNoneMulti",value:function(t,a,e){e=null!=e?e:this.findBasket(t);var n=this.taskSavedData.main.baskets[e].all[a];this.taskSavedData.main.baskets[e].all.splice(a,1);var i=this.taskSavedData.main.baskets[e].preview.indexOf(n);this.taskSavedData.main.baskets[e].preview.splice(i,1),this.calcBasketPreview(e)}},{key:"removeCandidateFromBasketDetailsMulti",value:function(t,a,e){e=null!=e?e:this.findBasket(t);var n=this.taskSavedData.main.baskets[e].all[a];if(n.total>1)n.total--;else{this.taskSavedData.main.baskets[e].all.splice(a,1);var i=this.taskSavedData.main.baskets[e].preview.indexOf(n);this.taskSavedData.main.baskets[e].preview.splice(i,1),this.calcBasketPreview(e)}}},{key:"changeToBasketMode",value:function(){this.basketsMode="AllBaskets"}},{key:"showBasketDetails",value:function(t){this.basketsMode="DetailedBasket",this.basketDetails=t}},{key:"selectBasket",value:function(t){this.selectedBasket=this.selectedBasket!==t?t:null}},{key:"selectCandidate",value:function(t){this.selectedBasket&&this.pushCandidateToBasket(this.selectedBasket,t)}},{key:"openBasketPopup",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))}},{key:"createComment",value:function(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:c.Guid.raw()}],{skipLocationChange:!0})}}]),a}();return a.\u0275fac=function(t){return new(t||a)(l.Ib(u.f),l.Ib(u.a),l.Ib(k.a),l.Ib(v.a),l.Ib(b.b),l.Ib(h.ib),l.Ib(p.a),l.Ib(f.a),l.Ib(m.a))},a.\u0275cmp=l.Cb({type:a,selectors:[["app-baskets"]],inputs:{integrated:"integrated"},decls:7,vars:5,consts:[[4,"ngIf"],["cdkDropListGroup","",1,"container"],["lines","none","id","candidates","cdkDropList","","cdkDropListSortingDisabled","",1,"candidates",3,"cdkDropListData","cdkDropListDropped"],["cdkDrag","",3,"cdkDragStartDelay","click",4,"ngFor","ngForOf"],["class","baskets",4,"ngIf"],["horizontal","end","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content",4,"ngIf"],["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],["cdkDrag","",3,"cdkDragStartDelay","click"],[1,"avatar","avatarMargin",3,"candidate"],["class","avatar",3,"candidate",4,"cdkDragPreview"],["class","avatar",3,"candidate",4,"cdkDragPlaceholder"],[1,"avatar",3,"candidate"],[1,"baskets"],[3,"ngSwitch"],[4,"ngSwitchCase"],["id","baskets","class","basket","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",3,"selectedBasket","cdkDropListData","direction","click","cdkDropListDropped",4,"ngFor","ngForOf"],["id","baskets","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",1,"basket",3,"cdkDropListData","click","cdkDropListDropped"],["color","secondary",1,"basketHeader"],[1,"basketItems",2,"direction","ltr"],["class","avatarBasketContainer","cdkDrag","",3,"cdkDragStartDelay",4,"ngFor","ngForOf"],["class","allBasketContainer",3,"click",4,"ngIf"],["cdkDrag","",1,"avatarBasketContainer",3,"cdkDragStartDelay"],[1,"avatarBasket",3,"candidateId","total","isShowTotal"],["class","avatarBasket",3,"candidateId",4,"cdkDragPlaceholder"],["class","avatarBasket",3,"candidateId",4,"cdkDragPreview"],[1,"avatarBasket",3,"candidateId"],[1,"allBasketContainer",3,"click"],["name","people",1,"avatarBasket"],["slot","end","color","primary",1,"allBadge"],[1,"basketDetails",3,"click"],[1,"basketHeader"],["color","light",1,"basketHeaderBtn",3,"click"],["slot","start","name","arrow-back"],["color","secondary"],[1,"basketDetailItems",2,"direction","ltr"],["class","avatarBasketDetailsContainer","cdkDropList","","cdkDropListSortingDisabled","",3,"id","cdkDropListData","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListSortingDisabled","",1,"avatarBasketDetailsContainer",3,"id","cdkDropListData","cdkDropListDropped"],["cdkDrag","",3,"cdkDragStartDelay"],["horizontal","end","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],["color","primary",3,"click"],["name","chatbox-ellipses"]],template:function(t,a){1&t&&(l.nc(0,C,8,1,"ion-header",0),l.Nb(1,"ion-content"),l.Nb(2,"div",1),l.Nb(3,"ion-list",2),l.Vb("cdkDropListDropped",(function(t){return a.dropCandidates(t)})),l.nc(4,B,4,2,"ion-item",3),l.Mb(),l.nc(5,A,4,3,"div",4),l.Mb(),l.nc(6,j,3,0,"ion-fab",5),l.Mb()),2&t&&(l.dc("ngIf",!a.integrated),l.yb(3),l.dc("cdkDropListData",a.candidates),l.yb(1),l.dc("ngForOf",a.candidates),l.yb(1),l.dc("ngIf",a.isTaskInit),l.yb(1),l.dc("ngIf",!a.integrated))},directives:[g.m,h.n,y.e,h.D,y.d,g.l,h.s,h.Z,h.k,h.F,h.g,h.h,h.X,h.w,y.a,D.a,y.c,y.b,g.n,g.o,h.l,h.C,h.t,h.i,h.j,h.o,h.p],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%}.candi[_ngcontent-%COMP%]{height:2rem;width:2rem}.candidates[_ngcontent-%COMP%]{height:100%;overflow:scroll;min-width:var(--avatar-empty-width)}.baskets[_ngcontent-%COMP%]{align-content:flex-start;height:100%;overflow:scroll}.basket[_ngcontent-%COMP%], .baskets[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.basket[_ngcontent-%COMP%]{min-height:6rem}.selectedBasket[_ngcontent-%COMP%]{background-color:rgba(157,186,250,.541)}.basketHeader[_ngcontent-%COMP%]{display:flex;width:100%;margin-bottom:1rem;align-self:flex-start;align-items:center;font-size:1.2rem}.basketHeaderBtn[_ngcontent-%COMP%]{margin-right:auto}.basketItems[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;width:100%;flex-wrap:nowrap}.basketDetails[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.basketDetailItems[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;height:100%}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.avatarBasket[_ngcontent-%COMP%]{height:2rem;width:2rem}.avatarBasketContainer[_ngcontent-%COMP%]{margin-right:.7rem}.avatarBasketDetailsContainer[_ngcontent-%COMP%]{margin-right:1.2rem;margin-bottom:1.2rem}.item-native[_ngcontent-%COMP%]{background:none}.allBasketContainer[_ngcontent-%COMP%]{margin-left:1rem;margin-top:.5rem}.allBadge[_ngcontent-%COMP%]{position:relative;top:-1rem;left:-.4rem;border-radius:100%;margin:0}"]}),a}()},bFAM:function(t,a,n){"use strict";n.r(a),n.d(a,"BasketsPageModule",(function(){return p}));var i,s,r=n("ofXK"),o=n("3Pt+"),d=n("TEn/"),c=n("tyNb"),l=n("43kj"),u=n("fXoL"),k=[{path:"",component:l.a}],v=((i=function t(){e(this,t)}).\u0275mod=u.Gb({type:i}),i.\u0275inj=u.Fb({factory:function(t){return new(t||i)},imports:[[c.h.forChild(k)],c.h]}),i),b=n("5+WD"),h=n("ajeZ"),p=((s=function t(){e(this,t)}).\u0275mod=u.Gb({type:s}),s.\u0275inj=u.Fb({factory:function(t){return new(t||s)},imports:[[r.c,o.a,d.bb,v,b.f,h.a]]}),s)},pQKU:function(a,n,s){"use strict";s.d(n,"a",(function(){return P}));var r=s("mrSG"),o=s("kMc0"),d=s("fXoL"),c=s("L5fO"),l=s("ofXK"),u=s("TEn/");function k(t,a){if(1&t&&(d.Lb(0),d.Nb(1,"span",8),d.pc(2),d.Mb(),d.Nb(3,"span",4),d.pc(4),d.Mb(),d.Nb(5,"span",5),d.pc(6),d.Mb(),d.Nb(7,"span",6),d.pc(8),d.Mb(),d.Kb()),2&t){var e=d.Xb().$implicit;d.yb(2),d.qc(e.key),d.yb(2),d.qc(e.value.value),d.yb(2),d.qc(e.value.avg),d.yb(2),d.qc(e.value.max)}}function v(t,a){if(1&t&&(d.Lb(0),d.nc(1,k,9,4,"ng-container",0),d.Kb()),2&t){var e=a.$implicit;d.yb(1),d.dc("ngIf",e.value.avg>0)}}function b(t,a){if(1&t&&(d.Lb(0),d.Nb(1,"ion-item"),d.Nb(2,"ion-label"),d.Nb(3,"div",1),d.Nb(4,"span"),d.pc(5),d.Mb(),d.Mb(),d.Nb(6,"div",2),d.Nb(7,"span",3),d.pc(8),d.Mb(),d.Nb(9,"span",4),d.pc(10),d.Mb(),d.Nb(11,"span",5),d.pc(12),d.Mb(),d.Nb(13,"span",6),d.pc(14),d.Mb(),d.nc(15,v,2,1,"ng-container",7),d.Yb(16,"keyvalue"),d.Mb(),d.Mb(),d.Mb(),d.Kb()),2&t){var e=d.Xb();d.yb(1),d.mc("direction",e.langProvider.LangDirection),d.yb(4),d.qc(e.taskName),d.yb(3),d.rc("",e.langProvider.Tags,":"),d.yb(2),d.qc(e.langProvider.BasketValue),d.yb(2),d.qc(e.langProvider.BasketAvg),d.yb(2),d.qc(e.langProvider.BasketMax),d.yb(1),d.dc("ngForOf",d.Zb(16,8,e.basketsAggData.basketsTotals))}}var h,p=((h=function(){function t(a,n){e(this,t),this.langProvider=a,this.basketDelegator=n}return i(t,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var a,e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=new o.a).start(),this.taskName=this.tasks[0].name,this.basketsAggData=this.basketDelegator.calcCandidateAggData(this.candidate,this.candidates,this.tasks),e=a.stop(),console.log("BasketsCandidateHistoryAgg ".concat(this.candidate._id," time: ").concat(e)),this.isInit=!0;case 4:case"end":return t.stop()}}),t,this)})))}}]),t}()).\u0275fac=function(t){return new(t||h)(d.Ib(c.b),d.Ib(P))},h.\u0275cmp=d.Cb({type:h,selectors:[["app-baskets-candidate-history-agg"]],inputs:{tasks:"tasks",candidate:"candidate",candidates:"candidates"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[1,"baskets"],[1,"col1","basketsHeader"],[1,"col2"],[1,"col3"],[1,"col4"],[4,"ngFor","ngForOf"],[1,"col1"]],template:function(t,a){1&t&&d.nc(0,b,17,10,"ng-container",0),2&t&&d.dc("ngIf",a.isInit)},directives:[l.m,u.w,u.C,l.l],pipes:[l.g],styles:[".header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;color:var(--ion-color-medium)}.baskets[_ngcontent-%COMP%]{display:grid;margin-top:.2rem}.basketsHeader[_ngcontent-%COMP%]{font-style:italic;font-weight:700}"]}),h);function f(t,a){if(1&t&&(d.Nb(0,"span"),d.pc(1),d.Mb()),2&t){var e=d.Xb().$implicit,n=d.Xb(3);d.yb(1),d.sc(" ",n.langProvider.Total," : ",e.value.total," ")}}function m(t,a){if(1&t&&(d.Nb(0,"div"),d.Nb(1,"span"),d.pc(2),d.Mb(),d.nc(3,f,2,2,"span",0),d.Mb()),2&t){var e=a.$implicit;d.yb(2),d.qc(e.key),d.yb(1),d.dc("ngIf",e.value.total>1)}}function g(t,a){if(1&t&&(d.Lb(0,4),d.Nb(1,"span",5),d.pc(2),d.Mb(),d.nc(3,m,4,2,"div",6),d.Yb(4,"keyvalue"),d.Kb()),2&t){var e=d.Xb(2);d.yb(2),d.rc("",e.langProvider.Tags,":"),d.yb(1),d.dc("ngForOf",d.Zb(4,2,e.item.basketItems))}}function y(t,a){if(1&t&&(d.Lb(0),d.Nb(1,"span"),d.pc(2),d.Mb(),d.Kb()),2&t){var e=d.Xb(2);d.yb(2),d.qc(e.langProvider.NoActivity)}}function D(t,a){if(1&t&&(d.Lb(0),d.Nb(1,"ion-item"),d.Nb(2,"ion-label"),d.Nb(3,"div",1),d.Nb(4,"span"),d.pc(5),d.Mb(),d.Nb(6,"span",2),d.pc(7),d.Yb(8,"date"),d.Mb(),d.Mb(),d.nc(9,g,5,4,"ng-container",3),d.nc(10,y,3,1,"ng-container",0),d.Mb(),d.Mb(),d.Kb()),2&t){var e=d.Xb();d.yb(1),d.mc("direction",e.langProvider.LangDirection),d.yb(4),d.qc(e.task.name),d.yb(2),d.qc(d.ac(8,6,e.item.date,"dd/MM/yy HH:mm:ss")),d.yb(2),d.dc("ngIf",e.item.basketItems),d.yb(1),d.dc("ngIf",!e.item.basketItems)}}var C,w,M,B=((w=function(){function t(a,n){e(this,t),this.taskDelegator=a,this.langProvider=n}return i(t,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){var t=this.taskDelegator.GetBasketsForCandidate(this.candidate._id,this.task),a=Object.keys(t).length>0;this.item={date:new Date(this.task.date),basketItems:a?t:null},this.isInit=!0}}]),t}()).\u0275fac=function(t){return new(t||w)(d.Ib(P),d.Ib(c.b))},w.\u0275cmp=d.Cb({type:w,selectors:[["app-baskets-candidate-history"]],inputs:{task:"task",candidate:"candidate"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[2,"direction","ltr"],["style","white-space: normal;",4,"ngIf"],[2,"white-space","normal"],[1,"basketsHeader"],[4,"ngFor","ngForOf"]],template:function(t,a){1&t&&d.nc(0,D,11,9,"ng-container",0),2&t&&d.dc("ngIf",a.isInit)},directives:[l.m,u.w,u.C,l.l],pipes:[l.e,l.g],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.header[_ngcontent-%COMP%], .order[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.basketsHeader[_ngcontent-%COMP%]{font-style:italic;font-weight:700}"]}),w),S=((C=function(){function t(a){e(this,t),this.langProvider=a}return i(t,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){var t=new Set(this.task.coverage);this.totalCandidates=this.candidates.length,this.candidatesInBaskets=this.candidates.filter((function(t){return"NotActive"!==t.status})).filter((function(a){return t.has(a._id)})).length;var a=this.candidatesInBaskets/this.totalCandidates;this.completedStatus=1===a?"full":a>=.5?"half":"none"}}]),t}()).\u0275fac=function(t){return new(t||C)(d.Ib(c.b))},C.\u0275cmp=d.Cb({type:C,selectors:[["app-baskets-history"]],inputs:{task:"task",candidates:"candidates"},decls:5,vars:11,consts:[[1,"container"]],template:function(t,a){1&t&&(d.Nb(0,"div",0),d.Nb(1,"span"),d.pc(2),d.Mb(),d.Nb(3,"span"),d.pc(4),d.Mb(),d.Mb()),2&t&&(d.mc("direction",a.langProvider.LangDirection),d.Ab("completed","full"===a.completedStatus)("halfCompleted","half"===a.completedStatus)("notCompleted","none"===a.completedStatus),d.yb(2),d.qc(a.langProvider.TotalCanidatesInBaskets),d.yb(2),d.sc("",a.totalCandidates," / ",a.candidatesInBaskets,""))},styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.completed[_ngcontent-%COMP%]{color:green}.halfCompleted[_ngcontent-%COMP%]{color:orange}.notCompleted[_ngcontent-%COMP%]{color:red}"]}),C),I=s("bFAM"),O=s("h7jJ"),x=s("nbnm"),P=((M=function(){function a(t,n,i){e(this,a),this.dataProvider=t,this.entityNamer=n,this.langProvider=i}return i(a,[{key:"getComponent",value:function(){return I.BasketsPageModule}},{key:"getHistoryComponent",value:function(){return S}},{key:"getCandidateHistoryComponent",value:function(){return B}},{key:"getCandidateAggregateComponent",value:function(){return p}},{key:"getTaskName",value:function(){throw new Error("Method not implemented.")}},{key:"getTaskConfig",value:function(t){throw new Error("Method not implemented.")}},{key:"saveTask",value:function(t,a){var e,n;return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=[],t.main._id=null!==(e=t.main._id)&&void 0!==e?e:this.entityNamer.taskPrefixWithUniqueIdAnd(t.main.type,t.main.taskId),t.main._rev=t.main._rev,t.main.date=null!==(n=t.main.date)&&void 0!==n?n:new Date,t.main.updateDate=new Date,t.main.coverage=this.CalcCoverage(t),i.push(t.main),a.next=9,this.dataProvider.saveEntities(i);case 9:return a.abrupt("return",t);case 10:case"end":return a.stop()}}),a,this)})))}},{key:"loadTask",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.dataProvider.loadTask(t);case 2:return a.t0=a.sent,a.abrupt("return",{main:a.t0});case 4:case"end":return a.stop()}}),a,this)})))}},{key:"deleteTask",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var e;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e=[t],a.next=3,this.dataProvider.deleteEntities(e);case 3:case"end":return a.stop()}}),a,this)})))}},{key:"getTaskHistory",value:function(){throw new Error("Method not implemented.")}},{key:"getTasksForCandidates",value:function(t){throw new Error("Method not implemented.")}},{key:"CalcCoverage",value:function(t){var a=new Set;for(var e in t.main.baskets)Object.prototype.hasOwnProperty.call(t.main.baskets,e)&&t.main.baskets[e].all.forEach((function(t){return a.add(t.candidate)}));return Array.from(a)}},{key:"GetBasketsForCandidate",value:function(t,a){var e={};for(var n in a.baskets)if(a.baskets[n]){var i=a.baskets[n].all.find((function(a){return a.candidate===t}));i&&(e[n]=i)}return e}},{key:"checkTaskEmpty",value:function(t,a){return!(t.main._id||Object.keys(t.main.baskets).some((function(a){var e,n;return(null===(n=null===(e=t.main.baskets[a])||void 0===e?void 0:e.all)||void 0===n?void 0:n.length)>0})))}},{key:"calcCandidateAggData",value:function(a,e,n){var i,s,r,o={},d={},c=new Set,l=t(n);try{for(l.s();!(r=l.n()).done;){var u=r.value;for(var k in u.baskets)if(Object.prototype.hasOwnProperty.call(u.baskets,k)){var v=u.baskets[k];c.add(k);var b,h=t(e);try{var p=function(){var t=b.value;d[t._id]=null!==(i=d[t._id])&&void 0!==i?i:{},d[t._id][k]=null!==(s=d[t._id][k])&&void 0!==s?s:0;var a=v.all.find((function(a){return a.candidate===t._id}));a&&(d[t._id][k]+=a.total)};for(h.s();!(b=h.n()).done;)p()}catch(y){h.e(y)}finally{h.f()}}}}catch(y){l.e(y)}finally{l.f()}var f,m=t(c);try{var g=function(){var t=f.value,n=Object.keys(d).map((function(a){return d[a][t]})),i=n.reduce((function(t,a){return Math.max(t,a)})),s=n.reduce((function(t,a){return t+a}))/e.length;o[t]={max:i,avg:s,value:d[a._id][t]}};for(m.s();!(f=m.n()).done;)g()}catch(y){m.e(y)}finally{m.f()}return{basketsTotals:o}}}]),a}()).\u0275fac=function(t){return new(t||M)(d.Rb(O.a),d.Rb(x.a),d.Rb(c.b))},M.\u0275prov=d.Eb({token:M,factory:M.\u0275fac,providedIn:"root"}),M)}}])}();