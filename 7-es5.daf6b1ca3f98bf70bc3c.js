!function(){function e(e,t){var a;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=n(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==a.return||a.return()}finally{if(s)throw o}}}}function t(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[7,26,27],{LTzM:function(e,t,n){"use strict";n.r(t),n.d(t,"CreateCommentPageModule",(function(){return R}));var a=n("ofXK"),i=n("3Pt+"),c=n("TEn/"),s=n("tyNb"),d=n("mrSG"),m=n("Mxx3"),u=n("+Ff3"),l=n("fXoL"),f=n("tEcr"),h=n("h7jJ"),v=n("zrcv"),b=n("L5fO"),p=n("3LWr"),g=n("5+WD"),y=n("g1yl");function k(e,t){if(1&e&&l.Jb(0,"app-candidate-avatar",18),2&e){var n=l.Xb().$implicit;l.dc("candidate",n)}}function C(e,t){if(1&e&&l.Jb(0,"app-candidate-avatar",18),2&e){var n=l.Xb().$implicit;l.dc("candidate",n)}}function w(e,t){if(1&e){var n=l.Ob();l.Nb(0,"ion-item",14),l.Vb("click",(function(){l.ic(n);var e=t.$implicit;return l.Xb().selectCandidate(e)})),l.Jb(1,"app-candidate-avatar",15),l.nc(2,k,1,1,"app-candidate-avatar",16),l.nc(3,C,1,1,"app-candidate-avatar",17),l.Mb()}if(2&e){var a=t.$implicit,r=l.Xb();l.dc("cdkDragStartDelay",r.dragDelay),l.yb(1),l.Ab("candidateSelected",r.selectedCandidates[a._id]),l.dc("candidate",a)}}function M(e,t){if(1&e){var n=l.Ob();l.Nb(0,"ion-item",19),l.Vb("click",(function(){l.ic(n);var e=t.$implicit;return l.Xb().savedCommentSelected(e)})),l.Nb(1,"ion-label"),l.Nb(2,"span"),l.pc(3),l.Mb(),l.Mb(),l.Mb()}if(2&e){var a=t.$implicit;l.yb(3),l.qc(a)}}var D,P,x,T=[{path:"",component:(D=function(){function e(t,n,a,i,o,c,s,d){r(this,e),this.navCtrl=t,this.route=n,this.router=a,this.tasksDelegator=i,this.dataProvider=o,this.msgService=c,this.langProvider=s,this.store=d,this.selectedCandidates={},this.dragDelay=m.a.DragDelay,this.title=this.langProvider.GeneralComment}return o(e,[{key:"ngOnInit",value:function(){var e,t=this;this.candidates=this.dataProvider.getCandidatesCopy(),this.savedComments=u.c;var n=this.route.snapshot.paramMap.get(m.a.TaskDescId);n&&(this.taskDescRef=this.dataProvider.getTaskDesk(n),this.title=this.taskDescRef.description);var a=this.route.snapshot.paramMap.get(m.a.Navigate);a&&this.store.editComment.value.id===a&&(this.editedComment=this.store.editComment.value.data,this.editedComment&&(this.comment=this.editedComment.comment,this.editedComment.candidates.forEach((function(e){return t.selectedCandidates[e._id]=e})),this.taskDescRef=this.editedComment.TaskDescRef,this.title=null===(e=this.editedComment.TaskDescRef)||void 0===e?void 0:e.description))}},{key:"ngOnDestroy",value:function(){}},{key:"selectCandidate",value:function(e){this.selectedCandidates[e._id]=this.selectedCandidates[e._id]?null:e}},{key:"dropCandidates",value:function(e){}},{key:"createComment",value:function(){var e,t;return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,r,i,o,c=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=this.editedComment,!n.t0){n.next=4;break}return n.next=4,this.tasksDelegator.deleteComments(this.editedComment.SavedComments);case 4:if(0!==(a=Object.keys(this.selectedCandidates).filter((function(e){return c.selectedCandidates[e]})).map((function(e){return c.selectedCandidates[e]}))).length){n.next=9;break}this.msgService.showToast(this.langProvider.NoneSelectedCandidates,1e3,"toastWarn"),n.next=25;break;case 9:if(!(null===(e=this.comment)||void 0===e?void 0:e.trim())){n.next=24;break}return r={candidates:a,comment:this.comment,TaskDescRef:this.taskDescRef,date:null===(t=this.editedComment)||void 0===t?void 0:t.date},n.next=13,this.tasksDelegator.createComment(r);case 13:if(i=n.sent,this.store.lastCommentsChangeDateTime.next(i[0].date),this.msgService.showToast(this.langProvider.CommentSaved+"..."),!this.taskDescRef){n.next=20;break}return o=this.store.lastTaskNavData,n.next=18,this.router.navigate([o.value.Path,o.value.Params],o.value.NavigationExtras);case 18:n.next=22;break;case 20:return n.next=22,this.router.navigate(["tabs/comments"],{skipLocationChange:!0});case 22:n.next=25;break;case 24:this.msgService.showToast(this.langProvider.EmptyComment,1e3,"toastWarn");case 25:case"end":return n.stop()}}),n,this)})))}},{key:"savedCommentSelected",value:function(e){this.comment="".concat(this.comment?this.comment+"\n":"").concat(e)}},{key:"addSavedComment",value:function(){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}}]),e}(),D.\u0275fac=function(e){return new(e||D)(l.Ib(c.db),l.Ib(s.a),l.Ib(s.g),l.Ib(f.a),l.Ib(h.a),l.Ib(v.a),l.Ib(b.b),l.Ib(p.a))},D.\u0275cmp=l.Cb({type:D,selectors:[["app-create-comment"]],decls:22,vars:15,consts:[["slot","start"],["slot","end"],["defaultHref","tabs/comments"],[3,"fullscreen"],["cdkDropListGroup","",1,"container"],["lines","none","id","candidates","cdkDropList","","cdkDropListSortingDisabled","",1,"candidates",3,"cdkDropListData","cdkDropListDropped"],["cdkDrag","",3,"cdkDragStartDelay","click",4,"ngFor","ngForOf"],[1,"commentArea"],["autocomplete","on","rows","5",1,"commentText",3,"ngModel","placeholder","ngModelChange"],[1,"commentBtns"],["color","success",3,"click"],[3,"click"],[1,"savedComments"],["button","",3,"click",4,"ngFor","ngForOf"],["cdkDrag","",3,"cdkDragStartDelay","click"],[1,"avatar","avatarMargin",3,"candidate"],["class","avatar",3,"candidate",4,"cdkDragPreview"],["class","avatar",3,"candidate",4,"cdkDragPlaceholder"],[1,"avatar",3,"candidate"],["button","",3,"click"]],template:function(e,t){1&e&&(l.Nb(0,"ion-header"),l.Nb(1,"ion-toolbar"),l.Nb(2,"ion-buttons",0),l.Jb(3,"ion-menu-button"),l.Mb(),l.Nb(4,"ion-buttons",1),l.Jb(5,"ion-back-button",2),l.Mb(),l.Nb(6,"ion-title"),l.pc(7),l.Mb(),l.Mb(),l.Mb(),l.Nb(8,"ion-content",3),l.Nb(9,"div",4),l.Nb(10,"ion-list",5),l.Vb("cdkDropListDropped",(function(e){return t.dropCandidates(e)})),l.nc(11,w,4,4,"ion-item",6),l.Mb(),l.Nb(12,"div",7),l.Nb(13,"ion-textarea",8),l.Vb("ngModelChange",(function(e){return t.comment=e})),l.Mb(),l.Nb(14,"div",9),l.Nb(15,"ion-button",10),l.Vb("click",(function(){return t.addSavedComment()})),l.pc(16),l.Mb(),l.Nb(17,"ion-button",11),l.Vb("click",(function(){return t.createComment()})),l.pc(18),l.Mb(),l.Mb(),l.Nb(19,"div",12),l.Nb(20,"ion-list"),l.nc(21,M,4,1,"ion-item",13),l.Mb(),l.Mb(),l.Mb(),l.Mb(),l.Mb()),2&e&&(l.yb(6),l.mc("direction",t.langProvider.LangDirection),l.yb(1),l.qc(t.title),l.yb(1),l.dc("fullscreen",!0),l.yb(2),l.dc("cdkDropListData",t.candidates),l.yb(1),l.dc("ngForOf",t.candidates),l.yb(2),l.mc("direction",t.langProvider.LangDirection),l.dc("ngModel",t.comment)("placeholder",t.langProvider.CreateComment),l.yb(3),l.qc(t.langProvider.CreateSavedComment),l.yb(2),l.qc(t.langProvider.CreateComment),l.yb(2),l.mc("direction",t.langProvider.LangDirection),l.yb(1),l.dc("ngForOf",t.savedComments))},directives:[c.r,c.W,c.k,c.E,c.g,c.h,c.U,c.n,g.e,c.C,g.d,a.k,c.T,c.hb,i.d,i.g,c.j,c.v,g.a,y.a,g.c,g.b,c.B],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{height:100%;overflow:scroll;min-width:var(--avatar-empty-width)}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.avatarComment[_ngcontent-%COMP%]{height:2rem;width:2rem}.commentArea[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;flex:1}.commentText[_ngcontent-%COMP%]{color:var(--ion-color-dark);flex:0}.candidateSelected[_ngcontent-%COMP%]{background:#f08080}.commentBtns[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;flex:1}.closeBtn[_ngcontent-%COMP%]{margin-left:auto;--background:transparent;--color:var(--ion-color-dark)}.savedComments[_ngcontent-%COMP%]{overflow:scroll}"]}),D)}],O=((P=function e(){r(this,e)}).\u0275mod=l.Gb({type:P}),P.\u0275inj=l.Fb({factory:function(e){return new(e||P)},imports:[[s.i.forChild(T)],s.i]}),P),N=n("ajeZ"),R=((x=function e(){r(this,e)}).\u0275mod=l.Gb({type:x}),x.\u0275inj=l.Fb({factory:function(e){return new(e||x)},imports:[[a.b,i.a,c.Y,O,N.a,g.f]]}),x)},tEcr:function(n,a,i){"use strict";i.d(a,"a",(function(){return k}));var c=i("mrSG"),s=i("kLqA"),d=i("fXoL"),m=i("L5fO"),u=i("TEn/"),l=i("ofXK");function f(e,t){if(1&e&&(d.Nb(0,"span"),d.pc(1),d.Mb()),2&e){var n=d.Xb();d.yb(1),d.sc("",n.langProvider.Comment,": ",n.comment.TaskDescRef.description,"")}}function h(e,t){if(1&e&&(d.Nb(0,"span"),d.pc(1),d.Mb()),2&e){var n=d.Xb();d.yb(1),d.qc(n.langProvider.GeneralComment)}}var v,b,p=((v=function(){function e(t){r(this,e),this.langProvider=t}return o(e,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){this.comment=this.task}}]),e}()).\u0275fac=function(e){return new(e||v)(d.Ib(m.b))},v.\u0275cmp=d.Cb({type:v,selectors:[["app-comment-candidate-history"]],decls:12,vars:9,consts:[[1,"header"],[4,"ngIf","ngIfElse"],["elseNoTaskDesk",""],[2,"direction","ltr"],[1,"commentTxt"]],template:function(e,t){if(1&e&&(d.Lb(0),d.Nb(1,"ion-item"),d.Nb(2,"ion-label"),d.Nb(3,"div",0),d.nc(4,f,2,2,"span",1),d.nc(5,h,2,1,"ng-template",null,2,d.oc),d.Nb(7,"span",3),d.pc(8),d.Yb(9,"date"),d.Mb(),d.Mb(),d.Nb(10,"span",4),d.pc(11),d.Mb(),d.Mb(),d.Mb(),d.Kb()),2&e){var n=d.hc(6);d.yb(1),d.mc("direction",t.langProvider.LangDirection),d.yb(3),d.dc("ngIf",t.comment.TaskDescRef)("ngIfElse",n),d.yb(4),d.qc(d.ac(9,6,t.task.date,"dd/MM/yy HH:mm:ss")),d.yb(3),d.qc(null==t.comment?null:t.comment.comment)}},directives:[u.v,u.B,l.l],pipes:[l.d],styles:[".commentDate[_ngcontent-%COMP%]{font-size:.7rem;margin-bottom:.2rem;display:flex;justify-content:flex-end;color:var(--ion-color-medium)}.commentTxt[_ngcontent-%COMP%]{white-space:normal}.commentTask[_ngcontent-%COMP%]{margin-bottom:.2rem;color:var(--ion-color-tertiary)}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;color:var(--ion-color-medium)}"]}),v),g=i("h7jJ"),y=i("nbnm"),k=((b=function(){function n(e,t){r(this,n),this.dataProvider=e,this.entityNamer=t,this.commentsPrefix="comments"}return o(n,[{key:"getAllTasks",value:function(){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataProvider.getAllTasks();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"mergeTasksAndCandidateComments",value:function(e,n){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",[].concat(t(e),t(n)).sort((function(e,t){return new Date(t.date).getTime()-new Date(e.date).getTime()})));case 1:case"end":return a.stop()}}),a)})))}},{key:"buildTasksGroupsByType",value:function(e){return e.reduce((function(e,t,n){return e[t.type]||(e[t.type]=[]),e[t.type].push(t),e}),{})}},{key:"loadCandidateComments",value:function(e){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="".concat(this.entityNamer.userPrefix(),"@").concat(this.commentsPrefix,"@").concat(e),t.next=3,this.dataProvider.loadEntities(n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"loadComments",value:function(){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(this.entityNamer.userPrefix(),"@").concat(this.commentsPrefix),e.next=3,this.dataProvider.loadEntities(n);case 3:return e.abrupt("return",e.sent.sort((function(e,t){return new Date(t.date).getTime()-new Date(e.date).getTime()})).reduce((function(e,n,r){var i,o=e.length>0?e[e.length-1]:null,c=a.dataProvider.getCandidatesByIds([n.candidateId]);if(o&&n.comment===o.comment&&new Date(n.date).getTime()===o.date.getTime())(i=e[e.length-1].candidates).push.apply(i,t(c)),e[e.length-1].SavedComments.push(n);else{var s={comment:n.comment,candidates:c,date:new Date(n.date),SavedComments:[n],TaskDescRef:n.TaskDescRef};e.push(s)}return e}),[]));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteComments",value:function(e){return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dataProvider.deleteEntities(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"createComment",value:function(t){var n;return Object(c.a)(this,void 0,void 0,regeneratorRuntime.mark((function a(){var r,i,o,c,d,m,u,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r=[],i=null!==(n=t.date)&&void 0!==n?n:new Date,o="".concat(this.entityNamer.userPrefix(),"@").concat(this.commentsPrefix),c=t.TaskDescRef?t.TaskDescRef.type:"general",d=e(t.candidates);try{for(d.s();!(m=d.n()).done;)u=m.value,l={type:"comment",_id:"".concat(o,"@").concat(u._id,"@").concat(c,"@").concat(s.Guid.raw()),date:i,candidateId:u._id,comment:t.comment,tags:t.tags,TaskDescRef:t.TaskDescRef},r.push(l)}catch(f){d.e(f)}finally{d.f()}return a.next=6,this.dataProvider.saveEntities(r);case 6:return a.abrupt("return",a.sent);case 7:case"end":return a.stop()}}),a,this)})))}},{key:"getTaskConfig",value:function(e){throw new Error("Method not implemented.")}},{key:"getTaskName",value:function(){throw new Error("Method not implemented.")}},{key:"saveTask",value:function(e,t){throw new Error("Method not implemented.")}},{key:"loadTask",value:function(e){throw new Error("Method not implemented.")}},{key:"getTaskHistory",value:function(){throw new Error("Method not implemented.")}},{key:"getComponent",value:function(){throw new Error("Method not implemented.")}},{key:"getHistoryComponent",value:function(){throw new Error("Method not implemented.")}},{key:"getCandidateHistoryComponent",value:function(){return p}},{key:"getCandidateAggregateComponent",value:function(){throw new Error("Method not implemented.")}},{key:"deleteTask",value:function(e){throw new Error("Method not implemented.")}},{key:"getTasksForCandidates",value:function(e){throw new Error("Method not implemented.")}},{key:"checkTaskEmpty",value:function(e,t){throw new Error("Method not implemented.")}}]),n}()).\u0275fac=function(e){return new(e||b)(d.Rb(g.a),d.Rb(y.a))},b.\u0275prov=d.Eb({token:b,factory:b.\u0275fac,providedIn:"root"}),b)}}])}();