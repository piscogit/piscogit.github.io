(window.webpackJsonp=window.webpackJsonp||[]).push([[7,26,27],{LTzM:function(t,e,n){"use strict";n.r(e),n.d(e,"CreateCommentPageModule",(function(){return P}));var a=n("ofXK"),i=n("3Pt+"),o=n("TEn/"),r=n("tyNb"),s=n("mrSG"),d=n("Mxx3"),c=n("+Ff3"),m=n("fXoL"),l=n("tEcr"),h=n("h7jJ"),b=n("zrcv"),g=n("L5fO"),u=n("3LWr"),v=n("5+WD"),p=n("g1yl");function f(t,e){if(1&t&&m.Jb(0,"app-candidate-avatar",18),2&t){const t=m.Xb().$implicit;m.dc("candidate",t)}}function C(t,e){if(1&t&&m.Jb(0,"app-candidate-avatar",18),2&t){const t=m.Xb().$implicit;m.dc("candidate",t)}}function y(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-item",14),m.Vb("click",(function(){m.ic(t);const n=e.$implicit;return m.Xb().selectCandidate(n)})),m.Jb(1,"app-candidate-avatar",15),m.nc(2,f,1,1,"app-candidate-avatar",16),m.nc(3,C,1,1,"app-candidate-avatar",17),m.Mb()}if(2&t){const t=e.$implicit,n=m.Xb();m.dc("cdkDragStartDelay",n.dragDelay),m.yb(1),m.Ab("candidateSelected",n.selectedCandidates[t._id]),m.dc("candidate",t)}}function k(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-item",19),m.Vb("click",(function(){m.ic(t);const n=e.$implicit;return m.Xb().savedCommentSelected(n)})),m.Nb(1,"ion-label"),m.Nb(2,"span"),m.pc(3),m.Mb(),m.Mb(),m.Mb()}if(2&t){const t=e.$implicit;m.yb(3),m.qc(t)}}const M=[{path:"",component:(()=>{class t{constructor(t,e,n,a,i,o,r,s){this.navCtrl=t,this.route=e,this.router=n,this.tasksDelegator=a,this.dataProvider=i,this.msgService=o,this.langProvider=r,this.store=s,this.selectedCandidates={},this.dragDelay=d.a.DragDelay,this.title=this.langProvider.GeneralComment}ngOnInit(){var t;this.candidates=this.dataProvider.getCandidatesCopy(),this.savedComments=c.c;const e=this.route.snapshot.paramMap.get(d.a.TaskDescId);e&&(this.taskDescRef=this.dataProvider.getTaskDesk(e),this.title=this.taskDescRef.description);const n=this.route.snapshot.paramMap.get(d.a.Navigate);n&&this.store.editComment.value.id===n&&(this.editedComment=this.store.editComment.value.data,this.editedComment&&(this.comment=this.editedComment.comment,this.editedComment.candidates.forEach(t=>this.selectedCandidates[t._id]=t),this.taskDescRef=this.editedComment.TaskDescRef,this.title=null===(t=this.editedComment.TaskDescRef)||void 0===t?void 0:t.description))}ngOnDestroy(){}selectCandidate(t){this.selectedCandidates[t._id]=this.selectedCandidates[t._id]?null:t}dropCandidates(t){}createComment(){var t,e;return Object(s.a)(this,void 0,void 0,(function*(){this.editedComment&&(yield this.tasksDelegator.deleteComments(this.editedComment.SavedComments));const n=Object.keys(this.selectedCandidates).filter(t=>this.selectedCandidates[t]).map(t=>this.selectedCandidates[t]);if(0===n.length)this.msgService.showToast(this.langProvider.NoneSelectedCandidates,1e3,"toastWarn");else if(null===(t=this.comment)||void 0===t?void 0:t.trim()){const t={candidates:n,comment:this.comment,TaskDescRef:this.taskDescRef,date:null===(e=this.editedComment)||void 0===e?void 0:e.date},a=yield this.tasksDelegator.createComment(t);if(this.store.lastCommentsChangeDateTime.next(a[0].date),this.msgService.showToast(this.langProvider.CommentSaved+"..."),this.taskDescRef){const t=this.store.lastTaskNavData;yield this.router.navigate([t.value.Path,t.value.Params],t.value.NavigationExtras)}else yield this.router.navigate(["tabs/comments"],{skipLocationChange:!0})}else this.msgService.showToast(this.langProvider.EmptyComment,1e3,"toastWarn")}))}savedCommentSelected(t){this.comment=`${this.comment?this.comment+"\n":""}${t}`}addSavedComment(){return Object(s.a)(this,void 0,void 0,(function*(){}))}}return t.\u0275fac=function(e){return new(e||t)(m.Ib(o.cb),m.Ib(r.a),m.Ib(r.f),m.Ib(l.a),m.Ib(h.a),m.Ib(b.a),m.Ib(g.b),m.Ib(u.a))},t.\u0275cmp=m.Cb({type:t,selectors:[["app-create-comment"]],decls:22,vars:15,consts:[["slot","start"],["slot","end"],["defaultHref","tabs/comments"],[3,"fullscreen"],["cdkDropListGroup","",1,"container"],["lines","none","id","candidates","cdkDropList","","cdkDropListSortingDisabled","",1,"candidates",3,"cdkDropListData","cdkDropListDropped"],["cdkDrag","",3,"cdkDragStartDelay","click",4,"ngFor","ngForOf"],[1,"commentArea"],["autocomplete","on","rows","5",1,"commentText",3,"ngModel","placeholder","ngModelChange"],[1,"commentBtns"],["color","success",3,"click"],[3,"click"],[1,"savedComments"],["button","",3,"click",4,"ngFor","ngForOf"],["cdkDrag","",3,"cdkDragStartDelay","click"],[1,"avatar","avatarMargin",3,"candidate"],["class","avatar",3,"candidate",4,"cdkDragPreview"],["class","avatar",3,"candidate",4,"cdkDragPlaceholder"],[1,"avatar",3,"candidate"],["button","",3,"click"]],template:function(t,e){1&t&&(m.Nb(0,"ion-header"),m.Nb(1,"ion-toolbar"),m.Nb(2,"ion-buttons",0),m.Jb(3,"ion-menu-button"),m.Mb(),m.Nb(4,"ion-buttons",1),m.Jb(5,"ion-back-button",2),m.Mb(),m.Nb(6,"ion-title"),m.pc(7),m.Mb(),m.Mb(),m.Mb(),m.Nb(8,"ion-content",3),m.Nb(9,"div",4),m.Nb(10,"ion-list",5),m.Vb("cdkDropListDropped",(function(t){return e.dropCandidates(t)})),m.nc(11,y,4,4,"ion-item",6),m.Mb(),m.Nb(12,"div",7),m.Nb(13,"ion-textarea",8),m.Vb("ngModelChange",(function(t){return e.comment=t})),m.Mb(),m.Nb(14,"div",9),m.Nb(15,"ion-button",10),m.Vb("click",(function(){return e.addSavedComment()})),m.pc(16),m.Mb(),m.Nb(17,"ion-button",11),m.Vb("click",(function(){return e.createComment()})),m.pc(18),m.Mb(),m.Mb(),m.Nb(19,"div",12),m.Nb(20,"ion-list"),m.nc(21,k,4,1,"ion-item",13),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb()),2&t&&(m.yb(6),m.mc("direction",e.langProvider.LangDirection),m.yb(1),m.qc(e.title),m.yb(1),m.dc("fullscreen",!0),m.yb(2),m.dc("cdkDropListData",e.candidates),m.yb(1),m.dc("ngForOf",e.candidates),m.yb(2),m.mc("direction",e.langProvider.LangDirection),m.dc("ngModel",e.comment)("placeholder",e.langProvider.CreateComment),m.yb(3),m.qc(e.langProvider.CreateSavedComment),m.yb(2),m.qc(e.langProvider.CreateComment),m.yb(2),m.mc("direction",e.langProvider.LangDirection),m.yb(1),m.dc("ngForOf",e.savedComments))},directives:[o.r,o.W,o.k,o.E,o.g,o.h,o.U,o.n,v.e,o.C,v.d,a.k,o.T,o.gb,i.d,i.g,o.j,o.v,v.a,p.a,v.c,v.b,o.B],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{height:100%;width:auto;overflow:scroll;min-width:var(--avatar-empty-width)}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.avatarComment[_ngcontent-%COMP%]{height:2rem;width:2rem}.commentArea[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;justify-content:flex-end;flex:1}.commentText[_ngcontent-%COMP%]{color:var(--ion-color-dark);height:20%}.candidateSelected[_ngcontent-%COMP%]{background:#f08080}.commentBtns[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.closeBtn[_ngcontent-%COMP%]{margin-left:auto;--background:transparent;--color:var(--ion-color-dark)}.savedComments[_ngcontent-%COMP%]{overflow:scroll}"]}),t})()}];let D=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[r.h.forChild(M)],r.h]}),t})();var w=n("ajeZ");let P=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[a.b,i.a,o.Y,D,w.a,v.f]]}),t})()},tEcr:function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var a=n("mrSG"),i=n("kLqA"),o=n("fXoL"),r=n("L5fO"),s=n("TEn/"),d=n("ofXK");function c(t,e){if(1&t&&(o.Nb(0,"span"),o.pc(1),o.Mb()),2&t){const t=o.Xb();o.yb(1),o.sc("",t.langProvider.Comment,": ",t.comment.TaskDescRef.description,"")}}function m(t,e){if(1&t&&(o.Nb(0,"span"),o.pc(1),o.Mb()),2&t){const t=o.Xb();o.yb(1),o.qc(t.langProvider.GeneralComment)}}let l=(()=>{class t{constructor(t){this.langProvider=t}ngOnInit(){this.calcHistory()}calcHistory(){this.comment=this.task}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(r.b))},t.\u0275cmp=o.Cb({type:t,selectors:[["app-comment-candidate-history"]],decls:12,vars:9,consts:[[1,"header"],[4,"ngIf","ngIfElse"],["elseNoTaskDesk",""],[2,"direction","ltr"],[1,"commentTxt"]],template:function(t,e){if(1&t&&(o.Lb(0),o.Nb(1,"ion-item"),o.Nb(2,"ion-label"),o.Nb(3,"div",0),o.nc(4,c,2,2,"span",1),o.nc(5,m,2,1,"ng-template",null,2,o.oc),o.Nb(7,"span",3),o.pc(8),o.Yb(9,"date"),o.Mb(),o.Mb(),o.Nb(10,"span",4),o.pc(11),o.Mb(),o.Mb(),o.Mb(),o.Kb()),2&t){const t=o.hc(6);o.yb(1),o.mc("direction",e.langProvider.LangDirection),o.yb(3),o.dc("ngIf",e.comment.TaskDescRef)("ngIfElse",t),o.yb(4),o.qc(o.ac(9,6,e.task.date,"dd/MM/yy HH:mm:ss")),o.yb(3),o.qc(null==e.comment?null:e.comment.comment)}},directives:[s.v,s.B,d.l],pipes:[d.d],styles:[".commentDate[_ngcontent-%COMP%]{font-size:.7rem;margin-bottom:.2rem;display:flex;justify-content:flex-end;color:var(--ion-color-medium)}.commentTxt[_ngcontent-%COMP%]{white-space:normal}.commentTask[_ngcontent-%COMP%]{margin-bottom:.2rem;color:var(--ion-color-tertiary)}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;color:var(--ion-color-medium)}"]}),t})();var h=n("h7jJ"),b=n("nbnm");let g=(()=>{class t{constructor(t,e){this.dataProvider=t,this.entityNamer=e,this.commentsPrefix="comments"}getAllTasks(){return Object(a.a)(this,void 0,void 0,(function*(){return yield this.dataProvider.getAllTasks()}))}mergeTasksAndCandidateComments(t,e){return Object(a.a)(this,void 0,void 0,(function*(){return[...t,...e].sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())}))}buildTasksGroupsByType(t){return t.reduce((t,e,n)=>(t[e.type]||(t[e.type]=[]),t[e.type].push(e),t),{})}loadCandidateComments(t){return Object(a.a)(this,void 0,void 0,(function*(){const e=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}@${t}`;return yield this.dataProvider.loadEntities(e)}))}loadComments(){return Object(a.a)(this,void 0,void 0,(function*(){const t=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}`;return(yield this.dataProvider.loadEntities(t)).sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()).reduce((t,e,n)=>{const a=t.length>0?t[t.length-1]:null,i=this.dataProvider.getCandidatesByIds([e.candidateId]);if(a&&e.comment===a.comment&&new Date(e.date).getTime()===a.date.getTime())t[t.length-1].candidates.push(...i),t[t.length-1].SavedComments.push(e);else{const n={comment:e.comment,candidates:i,date:new Date(e.date),SavedComments:[e],TaskDescRef:e.TaskDescRef};t.push(n)}return t},[])}))}deleteComments(t){return Object(a.a)(this,void 0,void 0,(function*(){yield this.dataProvider.deleteEntities(t)}))}createComment(t){var e;return Object(a.a)(this,void 0,void 0,(function*(){const n=[],a=null!==(e=t.date)&&void 0!==e?e:new Date,o=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}`;let r;r=t.TaskDescRef?t.TaskDescRef.type:"general";for(const e of t.candidates){const s={type:"comment",_id:`${o}@${e._id}@${r}@${i.Guid.raw()}`,date:a,candidateId:e._id,comment:t.comment,tags:t.tags,TaskDescRef:t.TaskDescRef};n.push(s)}return yield this.dataProvider.saveEntities(n)}))}getTaskConfig(t){throw new Error("Method not implemented.")}getTaskName(){throw new Error("Method not implemented.")}saveTask(t,e){throw new Error("Method not implemented.")}loadTask(t){throw new Error("Method not implemented.")}getTaskHistory(){throw new Error("Method not implemented.")}getComponent(){throw new Error("Method not implemented.")}getHistoryComponent(){throw new Error("Method not implemented.")}getCandidateHistoryComponent(){return l}getCandidateAggregateComponent(){throw new Error("Method not implemented.")}deleteTask(t){throw new Error("Method not implemented.")}getTasksForCandidates(t){throw new Error("Method not implemented.")}checkTaskEmpty(t,e){throw new Error("Method not implemented.")}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(h.a),o.Rb(b.a))},t.\u0275prov=o.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);