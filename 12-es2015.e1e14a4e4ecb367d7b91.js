(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{OrUu:function(t,e,s){"use strict";s.r(e),s.d(e,"TasksHistoryPageModule",function(){return A});var n=s("ofXK"),i=s("3Pt+"),o=s("TEn/"),a=s("tyNb"),c=s("mrSG"),r=s("Mxx3"),l=s("fXoL"),d=s("zrcv");let p=(()=>{class t{constructor(t,e){this.popupCtrl=t,this.msgService=e}ngOnInit(){}copy(){const t=JSON.stringify(this.msg);this.msgService.copyToClipboard(t),this.msgService.showToast("Copy to clipboard",1e3),this.popupCtrl.dismiss()}whatsapp(){const t=JSON.stringify(this.msg),e=document.createElement("a");e.href=`whatsapp://send?text=${t}`,e["data-action"]="share/whatsapp/share",e.click(),this.popupCtrl.dismiss()}upload(){return Object(c.a)(this,void 0,void 0,function*(){this.popupCtrl.dismiss("upload")})}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(o.ib),l.Lb(d.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["app-share-data"]],inputs:{msg:"msg"},decls:7,vars:0,consts:[[1,"container"],["color","light",3,"click"],["color","primary","name","copy",1,"sicon"],["color","primary","name","logo-whatsapp",1,"sicon"],["color","primary","name","cloud-upload",1,"sicon"]],template:function(t,e){1&t&&(l.Rb(0,"div",0),l.Rb(1,"ion-button",1),l.Zb("click",function(){return e.copy()}),l.Mb(2,"ion-icon",2),l.Qb(),l.Rb(3,"ion-button",1),l.Zb("click",function(){return e.whatsapp()}),l.Mb(4,"ion-icon",3),l.Qb(),l.Rb(5,"ion-button",1),l.Zb("click",function(){return e.upload()}),l.Mb(6,"ion-icon",4),l.Qb(),l.Qb())},directives:[o.j,o.t],styles:[".container[_ngcontent-%COMP%]{display:flex}.sicon[_ngcontent-%COMP%]{font-size:x-large}"]}),t})();var b=s("3LWr"),h=s("ufmx"),u=s("NrBX"),g=s("o6Vy"),k=s("VYsW"),m=s("L5fO"),f=s("RybT"),y=s("VVJX");function v(t,e){}let T=(()=>{class t{constructor(t,e){this.componentFactoryResolver=t,this.taskDelegatorFactory=e}ngOnInit(){const t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){const e=this.componentFactoryResolver.resolveComponentFactory(t),s=this.taskHost.viewContainerRef;s.clear();const n=s.createComponent(e);n.instance.task=this.task,n.instance.candidates=this.candidates,this.componentRef=n}}ngOnChanges(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(l.k),l.Lb(f.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["app-task-history-host"]],viewQuery:function(t,e){if(1&t&&l.zc(y.a,3),2&t){let t;l.kc(t=l.ac())&&(e.taskHost=t.first)}},inputs:{task:"task",candidates:"candidates"},features:[l.zb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&l.rc(0,v,0,0,"ng-template",0)},directives:[y.a],styles:[""]}),t})();function C(t,e){}let w=(()=>{class t{constructor(t,e){this.componentFactoryResolver=t,this.taskDelegatorFactory=e}ngOnInit(){const t=this.taskDelegatorFactory.getTaskDelegator(this.tasksGroup.taskType).getHistoryAggComponent();if(t){const e=this.componentFactoryResolver.resolveComponentFactory(t),s=this.taskHost.viewContainerRef;s.clear();const n=s.createComponent(e);n.instance.tasksGroup=this.tasksGroup,n.instance.candidates=this.candidates,this.componentRef=n}}ngOnChanges(t){this.componentRef&&(this.componentRef.instance.tasksGroup=this.tasksGroup,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(l.k),l.Lb(f.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["app-task-history-agg-host"]],viewQuery:function(t,e){if(1&t&&l.zc(y.a,3),2&t){let t;l.kc(t=l.ac())&&(e.taskHost=t.first)}},inputs:{tasksGroup:"tasksGroup",candidates:"candidates"},features:[l.zb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&l.rc(0,C,0,0,"ng-template",0)},directives:[y.a],styles:[""]}),t})();function D(t,e){if(1&t){const t=l.Sb();l.Rb(0,"ion-button",7),l.Zb("click",function(){return l.mc(t),l.bc(3).showSearchbar(!0)}),l.Mb(1,"ion-icon",9),l.Qb()}}function R(t,e){if(1&t){const t=l.Sb();l.Pb(0),l.Rb(1,"ion-buttons",4),l.Mb(2,"ion-menu-button"),l.Qb(),l.Rb(3,"ion-title"),l.tc(4),l.Qb(),l.Rb(5,"ion-buttons",5),l.rc(6,D,2,0,"ion-button",6),l.Rb(7,"ion-button",7),l.Zb("click",function(){return l.mc(t),l.bc(2).showTaskFilters()}),l.Mb(8,"ion-icon",8),l.Qb(),l.Qb(),l.Ob()}if(2&t){const t=l.bc(2);l.Bb(3),l.qc("direction",t.langProvider.LangDirection),l.Bb(1),l.uc(t.langProvider.TasksHistory),l.Bb(2),l.hc("ngIf",!t.isShowSearchbar)}}function O(t,e){if(1&t){const t=l.Sb();l.Rb(0,"ion-searchbar",10),l.Zb("ngModelChange",function(e){return l.mc(t),l.bc(2).searchTaskStr=e})("ionChange",function(){return l.mc(t),l.bc(2).updateSearchTask()})("ionCancel",function(){return l.mc(t),l.bc(2).showSearchbar(!1)}),l.Qb()}if(2&t){const t=l.bc(2);l.hc("ngModel",t.searchTaskStr)}}function S(t,e){if(1&t){const t=l.Sb();l.Rb(0,"ion-item"),l.Rb(1,"ion-toggle",11),l.Zb("ionChange",function(e){return l.mc(t),l.bc(2).changeTasksViewMode(e)}),l.cc(2,"async"),l.Qb(),l.Rb(3,"ion-label",4),l.tc(4),l.Qb(),l.Qb()}if(2&t){const t=l.bc(2);l.qc("direction",t.langProvider.LangDirection),l.Bb(1),l.hc("checked",l.dc(2,4,t.store.tasksViewGroupedToggle)),l.Bb(3),l.uc(t.langProvider.TasksGroupedSummerized)}}function P(t,e){1&t&&l.Mb(0,"ion-icon",23)}function B(t,e){if(1&t){const t=l.Sb();l.Rb(0,"ion-item-sliding",null,13),l.cc(2,"lowercase"),l.Rb(3,"ion-item-options",14),l.Rb(4,"ion-item-option",15),l.Zb("click",function(){l.mc(t);const s=e.$implicit,n=l.lc(1);return l.bc(3).onDeleted(s,n)}),l.Mb(5,"ion-icon",16),l.Qb(),l.Rb(6,"ion-item-option",15),l.Zb("click",function(s){l.mc(t);const n=e.$implicit,i=l.lc(1);return l.bc(3).onCopyExport(n,i,s)}),l.Mb(7,"ion-icon",17),l.Qb(),l.Qb(),l.Rb(8,"ion-item",18),l.Zb("click",function(){l.mc(t);const s=e.$implicit;return l.bc(3).onEdit(s)}),l.Rb(9,"ion-label"),l.Rb(10,"h3",19),l.Rb(11,"div",19),l.rc(12,P,1,0,"ion-icon",20),l.Rb(13,"span"),l.tc(14),l.Qb(),l.Qb(),l.Rb(15,"span",21),l.tc(16),l.cc(17,"date"),l.Qb(),l.Qb(),l.Mb(18,"app-task-history-host",22),l.Qb(),l.Qb(),l.Qb()}if(2&t){const t=e.$implicit,s=l.bc(3);l.Cb("track",l.dc(2,8,t.type)),l.Bb(9),l.qc("direction",s.langProvider.LangDirection),l.Bb(3),l.hc("ngIf",t.isExported),l.Bb(2),l.uc(t.name),l.Bb(2),l.uc(l.ec(17,10,t.date,"dd/MM/yy HH:mm:ss")),l.Bb(2),l.hc("task",t)("candidates",s.candidates)}}function Q(t,e){if(1&t&&l.rc(0,B,19,13,"ion-item-sliding",12),2&t){const t=e.$implicit,s=l.bc(2);l.hc("ngForOf",t.tasks)("ngForTrackBy",s.trackByFn)}}const x=function(t){return{tasks:t,isGrouped:!1}},I=function(t){return{$implicit:t}};function F(t,e){if(1&t&&(l.Rb(0,"ion-list"),l.Nb(1,24),l.Qb()),2&t){l.bc();const t=l.lc(8),e=l.bc();l.Bb(1),l.hc("ngTemplateOutlet",t)("ngTemplateOutletContext",l.jc(4,I,l.jc(2,x,e.tasksHistory)))}}function M(t,e){if(1&t&&(l.Pb(0),l.Rb(1,"h3",26),l.Rb(2,"span"),l.tc(3),l.Qb(),l.Qb(),l.Mb(4,"app-task-history-agg-host",27),l.cc(5,"lowercase"),l.Ob()),2&t){const t=l.bc().$implicit,e=l.bc(3);l.Bb(3),l.wc("",t.taskDesc," - ",e.langProvider.Aggregate,""),l.Bb(1),l.hc("tasksGroup",t)("candidates",e.candidates),l.Cb("track",l.dc(5,5,t.taskType))}}const L=function(t){return{tasks:t,isGrouped:!0}};function G(t,e){if(1&t&&(l.Pb(0),l.rc(1,M,6,7,"ng-container",0),l.Nb(2,24),l.Ob()),2&t){const t=e.$implicit;l.bc(2);const s=l.lc(8);l.Bb(1),l.hc("ngIf",t.isShowGroupedAddData),l.Bb(1),l.hc("ngTemplateOutlet",s)("ngTemplateOutletContext",l.jc(5,I,l.jc(3,L,t.tasks)))}}function j(t,e){if(1&t&&(l.Rb(0,"ion-list"),l.rc(1,G,3,7,"ng-container",25),l.Qb()),2&t){const t=l.bc(2);l.Bb(1),l.hc("ngForOf",t.tasksGrouped)}}function H(t,e){if(1&t&&(l.Pb(0),l.Rb(1,"ion-header"),l.Rb(2,"ion-toolbar"),l.rc(3,R,9,4,"ng-container",0),l.rc(4,O,1,1,"ion-searchbar",1),l.Qb(),l.rc(5,S,5,6,"ion-item",2),l.Qb(),l.Rb(6,"ion-content"),l.rc(7,Q,1,2,"ng-template",null,3,l.sc),l.rc(9,F,2,6,"ion-list",0),l.cc(10,"async"),l.rc(11,j,2,1,"ion-list",0),l.cc(12,"async"),l.Qb(),l.Ob()),2&t){const t=l.bc();l.Bb(3),l.hc("ngIf",!t.isShowSearchbar),l.Bb(1),l.hc("ngIf",t.isShowSearchbar),l.Bb(1),l.hc("ngIf",t.isTasksViewGroupedToggleEnabled),l.Bb(4),l.hc("ngIf",!l.dc(10,5,t.store.tasksViewGroupedToggle)),l.Bb(2),l.hc("ngIf",l.dc(12,7,t.store.tasksViewGroupedToggle))}}const E=[{path:"",component:(()=>{class t{constructor(t,e,s,n,i,o,a,c,r,l,d,p){this.router=t,this.store=e,this.candidatesDelegator=s,this.tasksDelegator=n,this.syncService=i,this.appContext=o,this.langProvider=a,this.msgService=c,this.popupCtrl=r,this.loadingCtrl=l,this.alertController=d,this.taskDelegatorFactory=p,this.subscription={},this.isTasksViewGroupedToggleEnabled=!0,this.isInit=!1}ngOnInit(){return Object(c.a)(this,void 0,void 0,function*(){this.candidates=yield this.candidatesDelegator.getCandidatesCopy(),this.subscription.lastTasksChangeTime=this.store.lastTasksChangeTime.subscribe(t=>Object(c.a)(this,void 0,void 0,function*(){this.loadTasks()})),this.isInit=!0})}ngOnDestroy(){for(const t in this.subscription)Object.prototype.hasOwnProperty.call(this.subscription,t)&&this.subscription[t].unsubscribe()}ionViewWillEnter(){return Object(c.a)(this,void 0,void 0,function*(){})}loadTasks(){return Object(c.a)(this,void 0,void 0,function*(){let t;try{t=yield this.msgService.showLoader();const e=yield this.tasksDelegator.getAllTasks(),s=e.sort((t,e)=>{const s=new Date(t.date).getTime();return new Date(e.date).getTime()-s});if(this.tasksHistory=s,this.isTasksViewGroupedToggleEnabled){const t=e.reduce((t,e)=>{let s=t[e.name];return s||(s={taskId:e.taskId,taskType:e.type,taskDesc:e.name,tasks:[]},t[e.name]=s),s.tasks.push(e),s.firstDate=s.tasks.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())[0].date,s.lastDate=s.tasks.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())[0].date,t},{});this.tasksGrouped=Object.keys(t).map(e=>t[e]).map(t=>("Ordered"!==t.taskType&&"Baskets"!==t.taskType||(t.isShowGroupedAddData=!0),t)).sort((t,e)=>new Date(e.lastDate).getTime()-new Date(t.lastDate).getTime())}console.log("")}finally{t.dismiss()}})}onEdit(t){const e=this.taskDelegatorFactory.getTaskDelegator(t.type),s={};s[r.a.TaskDescId]=t.taskId,s[r.a.SavedTaskId]=t._id;const n={Path:`tabs/tasks/${e.getComponentRoute()}`,Params:s,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(n),this.router.navigate([n.Path,n.Params],n.NavigationExtras)}onCopyExport(t,e,s){return Object(c.a)(this,void 0,void 0,function*(){const n=this.taskDelegatorFactory.getTaskDelegator(t.type);try{const e=yield n.exportCopy(t._id,t.taskId),i=yield this.popupCtrl.create({component:p,event:s,componentProps:{msg:e}});yield i.present(),"upload"===(yield i.onWillDismiss()).data&&this.uploadTask(e,t)}catch(i){this.msgService.showToast("Cant export this task",1e3,"toastWarn")}e.closeOpened()})}onDeleted(t,e){return Object(c.a)(this,void 0,void 0,function*(){e.closeOpened();let s=!1;const n=yield this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:()=>s=!0}]});if(yield n.present(),yield n.onWillDismiss(),s){const e=this.taskDelegatorFactory.getTaskDelegator(t.type),s=yield this.loadingCtrl.create({message:"temp delete task"});yield s.present(),yield e.deleteTask(t),yield this.loadTasks(),yield s.dismiss(),yield s.onDidDismiss()}})}showSearchbar(t){}showTaskFilters(){}updateSearchTask(){}trackByFn(t,e){return e?e._id:t}temp(t){console.log(t._id)}changeTasksViewMode(t){this.store.tasksViewGroupedToggle.next(t.detail.checked)}uploadTask(t,e){var s,n,i;return Object(c.a)(this,void 0,void 0,function*(){let o;this.popupCtrl.dismiss("upload");try{let a=!0,c=null;const r=(yield this.tasksDelegator.getCategoryConfig()).isNoTaskUploadWithDesc;if(!r){const t=yield this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.TaskUpload,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"activate",cssClass:"danger"}],inputs:[{name:"taskDesc",type:"text",placeholder:this.langProvider.TaskUploadDesc}]});yield t.present();const e=yield t.onWillDismiss();a="activate"===e.role,c=null===(n=null===(s=e.data)||void 0===s?void 0:s.values)||void 0===n?void 0:n.taskDesc}if(a)if(r||c){o=yield this.msgService.showLoader();const s=this.appContext.getAppContext(),n={ActivationCode:s.activationCode,User:s.user,UserDesc:null!==(i=s.userDesc)&&void 0!==i?i:s.user,TaskDesc:c,Task:t};yield this.syncService.uploadTask(n),e.isExported=!0,yield this.tasksDelegator.saveTask(e),yield this.msgService.showToast(this.langProvider.TaskUploadedSuccessfuly,2e3,"toastSuccess")}else this.msgService.showToast(this.langProvider.TaskUploadDescMissing,1e3,"toastWarn")}catch(a){this.msgService.showMessage(null==a?void 0:a.message,this.langProvider.ErrorUploadTask,"toastWarn"),this.popupCtrl.dismiss()}finally{o.dismiss()}})}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(a.f),l.Lb(b.a),l.Lb(h.a),l.Lb(u.a),l.Lb(g.a),l.Lb(k.a),l.Lb(m.b),l.Lb(d.a),l.Lb(o.ib),l.Lb(o.cb),l.Lb(o.b),l.Lb(f.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["app-tasks-history"]],viewQuery:function(t,e){if(1&t&&l.zc(o.ab,1),2&t){let t;l.kc(t=l.ac())&&(e.virtualScroll=t.first)}},decls:1,vars:1,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[3,"direction",4,"ngIf"],["tasksTemplate",""],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slot","start",3,"checked","ionChange"],[4,"ngFor","ngForOf","ngForTrackBy"],["slide",""],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"],["name","share-social","color","primary",1,"htBtn"],["button","",3,"click"],[1,"taskHistory"],["name","cloud-upload","color","primary","class","exportIcon",4,"ngIf"],[1,"ltr"],[3,"task","candidates"],["name","cloud-upload","color","primary",1,"exportIcon"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngFor","ngForOf"],["id","tasksGroup",1,"rtl"],[3,"tasksGroup","candidates"]],template:function(t,e){1&t&&l.rc(0,H,13,9,"ng-container",0),2&t&&l.hc("ngIf",e.isInit)},directives:[n.m,o.s,o.Z,o.n,o.k,o.F,o.X,o.j,o.t,o.N,o.lb,i.e,i.h,o.w,o.Y,o.c,o.C,n.l,o.B,o.A,o.z,T,o.D,n.p,w],pipes:[n.b,n.k,n.e],styles:[".taskHistory[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.htBtn[_ngcontent-%COMP%]{font-size:x-large}.exportIcon[_ngcontent-%COMP%]{margin-left:.2rem}"]}),t})()}];let V=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Jb({type:t}),t.\u0275inj=l.Ib({imports:[[a.h.forChild(E)],a.h]}),t})();var Z=s("ajeZ");let A=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Jb({type:t}),t.\u0275inj=l.Ib({imports:[[n.c,i.a,o.bb,Z.a,V]]}),t})()}}]);