(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{CIRo:function(t,e,a){"use strict";a.d(e,"a",(function(){return M}));var i=a("mrSG"),s=a("kLqA"),n=a("Mxx3"),o=a("AytR"),c=a("fXoL"),d=a("TEn/"),r=a("L5fO"),l=a("ufmx"),b=a("zrcv"),h=a("ofXK"),k=a("g1yl");function m(t,e){if(1&t){const t=c.Ob();c.Nb(0,"app-candidate-avatar",13),c.Vb("click",(function(){c.ic(t);const a=e.$implicit,i=c.Xb();return i.selectRemoveAction(i.basketItemsEdit[a._id])})),c.Mb()}if(2&t){const t=e.$implicit,a=c.Xb();c.dc("candidate",t)("total",a.basketItemsEdit[t._id].total)("isSelected",a.dirtyItems[t._id])("isShowTotal",!0)("selectedStyle","redBlue")}}let g=(()=>{class t{constructor(t,e,a,i,s){this.modalCtrl=t,this.langProvider=e,this.candidatesDelegator=a,this.msgService=i,this.navCtrl=s,this.dirtyItems={},this.mode="add"}ngOnInit(){this.basketItemsOriginal=this.basketItems.reduce((t,e)=>(t[e.candidate]=e,t),{}),this.candidates=this.candidatesDelegator.getCandidatesByIds(Object.keys(this.basketItemsOriginal)),this.candidates.sort((t,e)=>t.number-e.number),this.basketItemsEdit=JSON.parse(JSON.stringify(this.basketItemsOriginal)),this.selectRemoveAction=this.selectItem}trackByFn(t,e){return e?e._id:t}selectItem(t){!this.taskConfig.isCandidateMultiBasket&&t.total>0?this.msgService.showToast(this.langProvider.CandidateAlreadyExistInBasket,2e3,"toastWarn"):this.taskConfig.maxTotalPerSingleEdit&&t.total-this.basketItemsOriginal[t.candidate].total>=this.taskConfig.maxTotalPerSingleEdit?this.msgService.showToast(this.langProvider.MaxTotalsPerSingleEditBasket,2e3,"toastWarn"):this.basket.maxCandidatesAllowed&&this.basketItems.filter(t=>t.total>0).length>this.basket.maxCandidatesAllowed?this.msgService.showToast(this.langProvider.MaxCandidatesForBasket,2e3,"toastWarn"):(t.total++,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total)}removeItem(t){t.total>0&&t.total--,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total}changeAddMode(){this.mode="add",this.selectRemoveAction=this.selectItem}changeRemoveMode(){this.mode="remove",this.selectRemoveAction=this.removeItem}activate(){const t=Object.keys(this.dirtyItems).filter(t=>this.dirtyItems[t]).map(t=>this.basketItemsEdit[t]);this.modalCtrl.dismiss(t)}back(t){return Object(i.a)(this,void 0,void 0,(function*(){Object.keys(this.dirtyItems).filter(t=>this.dirtyItems[t]).length>0?(yield this.msgService.showAreYouSure(this.langProvider.DataNotSaved))&&this.modalCtrl.dismiss():this.modalCtrl.dismiss()}))}}return t.\u0275fac=function(e){return new(e||t)(c.Ib(d.Eb),c.Ib(r.b),c.Ib(l.a),c.Ib(b.a),c.Ib(d.Fb))},t.\u0275cmp=c.Cb({type:t,selectors:[["app-basketkeyboard"]],inputs:{basketItems:"basketItems",taskConfig:"taskConfig",basket:"basket"},decls:19,vars:5,consts:[["translucent","true"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"options"],[3,"color","click"],["name","add"],["name","remove"],[1,"container"],[1,"candiContainer"],["slot","start","class","candi",3,"candidate","total","isSelected","isShowTotal","selectedStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],["color","secondary",1,"activate",3,"click"],["name","checkmark"],["slot","start",1,"candi",3,"candidate","total","isSelected","isShowTotal","selectedStyle","click"]],template:function(t,e){1&t&&(c.Nb(0,"ion-header",0),c.Nb(1,"ion-toolbar"),c.Nb(2,"ion-title"),c.qc(3),c.Mb(),c.Nb(4,"ion-buttons",1),c.Nb(5,"ion-button",2),c.Vb("click",(function(t){return e.back(t)})),c.Jb(6,"ion-icon",3),c.Mb(),c.Mb(),c.Mb(),c.Nb(7,"ion-toolbar"),c.Nb(8,"div",4),c.Nb(9,"ion-fab-button",5),c.Vb("click",(function(){return e.changeAddMode()})),c.Jb(10,"ion-icon",6),c.Mb(),c.Nb(11,"ion-fab-button",5),c.Vb("click",(function(){return e.changeRemoveMode()})),c.Jb(12,"ion-icon",7),c.Mb(),c.Mb(),c.Mb(),c.Mb(),c.Nb(13,"ion-content"),c.Nb(14,"div",8),c.Nb(15,"div",9),c.oc(16,m,1,5,"app-candidate-avatar",10),c.Mb(),c.Nb(17,"ion-fab-button",11),c.Vb("click",(function(){return e.activate()})),c.Jb(18,"ion-icon",12),c.Mb(),c.Mb(),c.Mb()),2&t&&(c.yb(3),c.sc(" ",e.basket.name," "),c.yb(6),c.dc("color","add"===e.mode?"primary":"light"),c.yb(2),c.dc("color","remove"===e.mode?"danger":"light"),c.yb(5),c.dc("ngForOf",e.candidates)("ngForTrackBy",e.trackByFn))},directives:[d.B,d.zb,d.xb,d.l,d.k,d.C,d.x,d.u,h.s,k.a],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candiContainer[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;overflow:scroll}.options[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{margin:.5rem auto}"],changeDetection:0}),t})();var f=a("tyNb"),v=a("3LWr"),u=a("NrBX"),p=a("pQKU");function y(t,e){if(1&t&&(c.Nb(0,"ion-header"),c.Nb(1,"ion-toolbar"),c.Nb(2,"ion-buttons",1),c.Jb(3,"ion-menu-button"),c.Mb(),c.Nb(4,"ion-buttons",2),c.Jb(5,"ion-back-button",3),c.Mb(),c.Nb(6,"ion-title"),c.qc(7),c.Mb(),c.Mb(),c.Mb()),2&t){const t=c.Xb();c.yb(7),c.rc(null==t.taskDesc?null:t.taskDesc.description)}}function I(t,e){if(1&t&&c.Jb(0,"app-candidate-avatar",12),2&t){const t=c.Xb().$implicit,e=c.Xb(3);c.dc("candidateId",t.candidate)("total",t.total)("isShowTotal",e.taskConfig.isCandidateMultiBasket)}}function C(t,e){if(1&t&&(c.Nb(0,"div"),c.oc(1,I,1,3,"app-candidate-avatar",11),c.Mb()),2&t){const t=e.$implicit;c.yb(1),c.dc("ngIf",t.total>0)}}function w(t,e){if(1&t){const t=c.Ob();c.Nb(0,"ion-chip",7),c.Vb("click",(function(){c.ic(t);const a=e.$implicit;return c.Xb(2).selectBasket(a)})),c.Nb(1,"ion-label",8),c.qc(2),c.Mb(),c.Nb(3,"div",9),c.oc(4,C,2,1,"div",10),c.Mb(),c.Mb()}if(2&t){const t=e.$implicit,a=c.Xb(2);c.nc("direction",a.taskDesc.langDir),c.Ab("selectedBasket",t.name===a.selectedBasket),c.yb(2),c.rc(t.name),c.yb(2),c.dc("ngForOf",a.taskSavedData.main.baskets[t.name].all)}}function D(t,e){if(1&t){const t=c.Ob();c.Nb(0,"ion-fab-button",18),c.Vb("click",(function(){return c.ic(t),c.Xb(3).saveAndNew()})),c.Jb(1,"ion-icon",19),c.Mb()}}function S(t,e){if(1&t){const t=c.Ob();c.Nb(0,"ion-fab",13),c.Nb(1,"div",14),c.Nb(2,"ion-fab-button",15),c.Vb("click",(function(){return c.ic(t),c.Xb(2).createComment()})),c.Jb(3,"ion-icon",16),c.Mb(),c.oc(4,D,2,0,"ion-fab-button",17),c.Mb(),c.Mb()}if(2&t){const t=c.Xb(2);c.yb(4),c.dc("ngIf",t.isSaveAndNew&&t.checkIfBasketsEmpty())}}function O(t,e){if(1&t&&(c.Nb(0,"ion-content"),c.Nb(1,"div",4),c.oc(2,w,5,6,"ion-chip",5),c.Mb(),c.oc(3,S,5,1,"ion-fab",6),c.Mb()),2&t){const t=c.Xb();c.yb(2),c.dc("ngForOf",t.taskConfig.baskets),c.yb(1),c.dc("ngIf",!t.integrated)}}let M=(()=>{class t{constructor(t,e,a,i,s,n,c,d,r,l){this.router=t,this.route=e,this.store=a,this.modalCtrl=i,this.msgService=s,this.langProvider=n,this.popoverController=c,this.candidatesDelegator=d,this.taskDelegator=r,this.basketDelegator=l,this.previewSize=o.a.basketPreviewSize}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){this.taskSavedData=yield this.initTask(),this.integrated||(this.taskSavedData=yield this.loadTask()),this.isTaskInit=!0}))}ionViewWillLeave(){return Object(i.a)(this,void 0,void 0,(function*(){this.basketDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)?this.msgService.showToast(this.langProvider.TaskEmptyDismissed,o.a.taskSavedToastInterval):(this.taskSavedData=yield this.saveTask(),this.msgService.showToast(this.langProvider.TaskSaved,o.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date))}))}initTask(){var t,e,a;return Object(i.a)(this,void 0,void 0,(function*(){let i;i=null!==(a=null!==(e=null===(t=this.integrated)||void 0===t?void 0:t.parentTaskId)&&void 0!==e?e:this.route.snapshot.paramMap.get(n.a.TaskDescId))&&void 0!==a?a:"t13",this.candidates=yield this.candidatesDelegator.getCandidatesCopy(!0),this.taskDesc=yield this.taskDelegator.getTaskDesk(i),this.taskConfig=yield this.taskDelegator.getTasksConfig(i);const s={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,candidates:this.candidates.map(t=>t._id),baskets:{}}};for(const t of this.taskConfig.baskets)s.main.baskets[t.name]={name:t.name,size:0,maxCandidatesAllowed:t.maxCandidatesAllowed,preview:[],all:this.candidates.map(t=>({candidate:t._id,total:0}))};return this.isSaveAndNew=!this.taskConfig.maxItems||this.taskConfig.maxItems>1,s}))}saveTask(){return Object(i.a)(this,void 0,void 0,(function*(){return yield this.basketDelegator.saveTask(this.taskSavedData,this.taskConfig)}))}saveTaskIntegrated(){return Object(i.a)(this,void 0,void 0,(function*(){throw new Error("Method not implemented.")}))}loadTask(){return Object(i.a)(this,void 0,void 0,(function*(){const t=this.route.snapshot.paramMap.get(n.a.SavedTaskId);if(t){this.isTaskUpdate=!0;const e=yield this.basketDelegator.loadTask(t);this.candidates=yield this.candidatesDelegator.getCandidatesByIds(e.main.candidates),this.setLoadedData(e),this.taskSavedData=e}return this.taskSavedData}))}saveAndNew(){return Object(i.a)(this,void 0,void 0,(function*(){if(yield this.msgService.showAreYouSure(this.langProvider.TaskSaveAndNew)){const t={};t[n.a.TaskDescId]=this.taskDesc.id,this.router.navigate(["tabs/task-catalog",t],{replaceUrl:!0,skipLocationChange:!0})}}))}setLoadedData(t){for(const e in t.main.baskets)if(Object.prototype.hasOwnProperty.call(t.main.baskets,e)){const a=t.main.baskets[e],i=[];for(const t of a.preview){const e=a.all.find(e=>e.candidate===t.candidate);i.push(e)}a.preview=i}if(!this.taskConfig.isCandidatesStatic){const e=new Set;for(const a in t.main.baskets)Object.prototype.hasOwnProperty.call(t.main.baskets,a)&&t.main.baskets[a].all.forEach(t=>e.add(t.candidate));for(const t of e)this.candidates=this.candidates.filter(e=>e._id!==t)}}loadTaskIntegrated(t){return Object(i.a)(this,void 0,void 0,(function*(){this.taskSavedData=t,yield this.setLoadedData(t)}))}selectBasket(t){return Object(i.a)(this,void 0,void 0,(function*(){this.selectedBasket=this.selectedBasket!==t.name?t.name:null,yield this.showCanidatesSelection(t)}))}showCanidatesSelection(t){return Object(i.a)(this,void 0,void 0,(function*(){const e=this.taskSavedData.main.baskets[t.name],a=yield this.modalCtrl.create({component:g,componentProps:{basketItems:e.all,taskConfig:this.taskConfig,basket:t}});yield a.present();const i=yield a.onWillDismiss();if(i.data){e.preview=i.data;for(const t of i.data){const a=e.all.find(e=>e.candidate===t.candidate);a&&(a.total=t.total)}}}))}checkIfBasketsEmpty(){return Object.keys(this.taskSavedData.main.baskets).some(t=>{var e;return(null===(e=this.taskSavedData.main.baskets[t].preview)||void 0===e?void 0:e.length)>0})}createComment(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:s.Guid.raw()}],{skipLocationChange:!0})}}return t.\u0275fac=function(e){return new(e||t)(c.Ib(f.f),c.Ib(f.a),c.Ib(v.a),c.Ib(d.Eb),c.Ib(b.a),c.Ib(r.b),c.Ib(d.Jb),c.Ib(l.a),c.Ib(u.a),c.Ib(p.a))},t.\u0275cmp=c.Cb({type:t,selectors:[["app-baskets2"]],inputs:{integrated:"integrated"},decls:2,vars:2,consts:[[4,"ngIf"],["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],[1,"baskets"],["id","baskets","class","basket","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",3,"selectedBasket","direction","click",4,"ngFor","ngForOf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content",4,"ngIf"],["id","baskets","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",1,"basket",3,"click"],["color","secondary",1,"basketHeader"],[1,"basketItems",2,"direction","ltr"],[4,"ngFor","ngForOf"],["class","avatarBasket",3,"candidateId","total","isShowTotal",4,"ngIf"],[1,"avatarBasket",3,"candidateId","total","isShowTotal"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],[2,"display","flex"],["color","primary",3,"click"],["name","chatbox-ellipses"],["style","margin-left: 0.2rem;","color","tertiary",3,"click",4,"ngIf"],["color","tertiary",2,"margin-left","0.2rem",3,"click"],["name","bag-check"]],template:function(t,e){1&t&&(c.oc(0,y,8,1,"ion-header",0),c.oc(1,O,4,2,"ion-content",0)),2&t&&(c.dc("ngIf",!e.integrated),c.yb(1),c.dc("ngIf",e.isTaskInit))},directives:[h.t,d.B,d.zb,d.l,d.R,d.g,d.h,d.xb,d.u,h.s,d.s,d.N,k.a,d.w,d.x,d.C],styles:[".container[_ngcontent-%COMP%]{flex-direction:column;width:100%}.baskets[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{display:flex;height:100%}.baskets[_ngcontent-%COMP%]{align-content:flex-start;overflow:scroll}.basket[_ngcontent-%COMP%], .baskets[_ngcontent-%COMP%]{flex-direction:column;flex:1}.basket[_ngcontent-%COMP%]{min-height:8rem;display:flex}.basketItems[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;width:100%;flex-wrap:wrap;overflow:scroll}.avatarBasket[_ngcontent-%COMP%]{height:2rem;width:2rem;margin:.5rem}"]}),t})()}}]);