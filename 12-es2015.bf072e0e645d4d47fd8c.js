(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{OrUu:function(t,s,e){"use strict";e.r(s),e.d(s,"TasksHistoryPageModule",function(){return M});var i=e("ofXK"),n=e("3Pt+"),o=e("TEn/"),a=e("tyNb"),c=e("mrSG"),r=e("Mxx3"),l=e("fXoL"),d=e("zrcv");let b=(()=>{class t{constructor(t,s){this.popupCtrl=t,this.msgService=s}ngOnInit(){}copy(){const t=JSON.stringify(this.msg);this.msgService.copyToClipboard(t),this.msgService.showToast("Copy to clipboard",1e3),this.popupCtrl.dismiss()}whatsapp(){const t=JSON.stringify(this.msg),s=document.createElement("a");s.href=`whatsapp://send?text=${t}`,s["data-action"]="share/whatsapp/share",s.click(),this.popupCtrl.dismiss()}upload(){return Object(c.a)(this,void 0,void 0,function*(){this.popupCtrl.dismiss("upload")})}}return t.\u0275fac=function(s){return new(s||t)(l.Kb(o.ib),l.Kb(d.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-share-data"]],inputs:{msg:"msg"},decls:7,vars:0,consts:[[1,"container"],["color","light",3,"click"],["color","primary","name","copy",1,"sicon"],["color","primary","name","logo-whatsapp",1,"sicon"],["color","primary","name","cloud-upload",1,"sicon"]],template:function(t,s){1&t&&(l.Pb(0,"div",0),l.Pb(1,"ion-button",1),l.Xb("click",function(){return s.copy()}),l.Lb(2,"ion-icon",2),l.Ob(),l.Pb(3,"ion-button",1),l.Xb("click",function(){return s.whatsapp()}),l.Lb(4,"ion-icon",3),l.Ob(),l.Pb(5,"ion-button",1),l.Xb("click",function(){return s.upload()}),l.Lb(6,"ion-icon",4),l.Ob(),l.Ob())},directives:[o.j,o.t],styles:[".container[_ngcontent-%COMP%]{display:flex}.sicon[_ngcontent-%COMP%]{font-size:x-large}"]}),t})();var p=e("3LWr"),h=e("ufmx"),u=e("NrBX"),g=e("o6Vy"),y=e("VYsW"),f=e("L5fO"),k=e("RybT"),m=e("VVJX");function v(t,s){}let C=(()=>{class t{constructor(t,s){this.componentFactoryResolver=t,this.taskDelegatorFactory=s}ngOnInit(){const t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){const s=this.componentFactoryResolver.resolveComponentFactory(t),e=this.taskHost.viewContainerRef;e.clear();const i=e.createComponent(s);i.instance.task=this.task,i.instance.candidates=this.candidates,this.componentRef=i}}ngOnChanges(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}return t.\u0275fac=function(s){return new(s||t)(l.Kb(l.k),l.Kb(k.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-task-history-host"]],viewQuery:function(t,s){if(1&t&&l.xc(m.a,3),2&t){let t;l.ic(t=l.Yb())&&(s.taskHost=t.first)}},inputs:{task:"task",candidates:"candidates"},features:[l.yb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,s){1&t&&l.pc(0,v,0,0,"ng-template",0)},directives:[m.a],styles:[""]}),t})();function P(t,s){if(1&t){const t=l.Qb();l.Pb(0,"ion-button",6),l.Xb("click",function(){return l.kc(t),l.Zb(3).showSearchbar(!0)}),l.Lb(1,"ion-icon",8),l.Ob()}}function O(t,s){if(1&t){const t=l.Qb();l.Nb(0),l.Pb(1,"ion-buttons",3),l.Lb(2,"ion-menu-button"),l.Ob(),l.Pb(3,"ion-title"),l.rc(4),l.Ob(),l.Pb(5,"ion-buttons",4),l.pc(6,P,2,0,"ion-button",5),l.Pb(7,"ion-button",6),l.Xb("click",function(){return l.kc(t),l.Zb(2).showTaskFilters()}),l.Lb(8,"ion-icon",7),l.Ob(),l.Ob(),l.Mb()}if(2&t){const t=l.Zb(2);l.Ab(3),l.oc("direction",t.langProvider.LangDirection),l.Ab(1),l.sc(t.langProvider.TasksHistory),l.Ab(2),l.fc("ngIf",!t.isShowSearchbar)}}function T(t,s){if(1&t){const t=l.Qb();l.Pb(0,"ion-searchbar",9),l.Xb("ngModelChange",function(s){return l.kc(t),l.Zb(2).searchTaskStr=s})("ionChange",function(){return l.kc(t),l.Zb(2).updateSearchTask()})("ionCancel",function(){return l.kc(t),l.Zb(2).showSearchbar(!1)}),l.Ob()}if(2&t){const t=l.Zb(2);l.fc("ngModel",t.searchTaskStr)}}function w(t,s){1&t&&l.Lb(0,"ion-icon",20)}function D(t,s){if(1&t){const t=l.Qb();l.Pb(0,"ion-item-sliding",null,10),l.ac(2,"lowercase"),l.Pb(3,"ion-item-options",11),l.Pb(4,"ion-item-option",12),l.Xb("click",function(){l.kc(t);const e=s.$implicit,i=l.jc(1);return l.Zb(2).onDeleted(e,i)}),l.Lb(5,"ion-icon",13),l.Ob(),l.Pb(6,"ion-item-option",12),l.Xb("click",function(e){l.kc(t);const i=s.$implicit,n=l.jc(1);return l.Zb(2).onCopyExport(i,n,e)}),l.Lb(7,"ion-icon",14),l.Ob(),l.Ob(),l.Pb(8,"ion-item",15),l.Xb("click",function(){l.kc(t);const e=s.$implicit;return l.Zb(2).onEdit(e)}),l.Pb(9,"ion-label"),l.Pb(10,"h3",16),l.Pb(11,"div",16),l.pc(12,w,1,0,"ion-icon",17),l.Pb(13,"span"),l.rc(14),l.Ob(),l.Ob(),l.Pb(15,"span",18),l.rc(16),l.ac(17,"date"),l.Ob(),l.Ob(),l.Lb(18,"app-task-history-host",19),l.Ob(),l.Ob(),l.Ob()}if(2&t){const t=s.$implicit,e=l.Zb(2);l.Bb("track",l.bc(2,8,t.type)),l.Ab(9),l.oc("direction",e.langProvider.LangDirection),l.Ab(3),l.fc("ngIf",t.isExported),l.Ab(2),l.sc(t.name),l.Ab(2),l.sc(l.cc(17,10,t.date,"dd/MM/yy HH:mm:ss")),l.Ab(2),l.fc("task",t)("candidates",e.candidates)}}function S(t,s){if(1&t&&(l.Nb(0),l.Pb(1,"ion-header"),l.Pb(2,"ion-toolbar"),l.pc(3,O,9,4,"ng-container",0),l.pc(4,T,1,1,"ion-searchbar",1),l.Ob(),l.Ob(),l.Pb(5,"ion-content"),l.Pb(6,"ion-list"),l.pc(7,D,19,13,"ion-item-sliding",2),l.Ob(),l.Ob(),l.Mb()),2&t){const t=l.Zb();l.Ab(3),l.fc("ngIf",!t.isShowSearchbar),l.Ab(1),l.fc("ngIf",t.isShowSearchbar),l.Ab(3),l.fc("ngForOf",t.tasksHistory)("ngForTrackBy",t.trackByFn)}}const x=[{path:"",component:(()=>{class t{constructor(t,s,e,i,n,o,a,c,r,l,d,b){this.router=t,this.store=s,this.candidatesDelegator=e,this.tasksDelegator=i,this.syncService=n,this.appContext=o,this.langProvider=a,this.msgService=c,this.popupCtrl=r,this.loadingCtrl=l,this.alertController=d,this.taskDelegatorFactory=b,this.subscription={},this.isInit=!1}ngOnInit(){return Object(c.a)(this,void 0,void 0,function*(){this.candidates=yield this.candidatesDelegator.getCandidatesCopy(),this.subscription.lastTasksChangeTime=this.store.lastTasksChangeTime.subscribe(t=>Object(c.a)(this,void 0,void 0,function*(){this.loadTasks()})),this.isInit=!0})}ngOnDestroy(){for(const t in this.subscription)Object.prototype.hasOwnProperty.call(this.subscription,t)&&this.subscription[t].unsubscribe()}ionViewWillEnter(){return Object(c.a)(this,void 0,void 0,function*(){})}loadTasks(){return Object(c.a)(this,void 0,void 0,function*(){let t;try{t=yield this.msgService.showLoader();const s=(yield this.tasksDelegator.getAllTasks()).sort((t,s)=>{const e=new Date(t.date).getTime();return new Date(s.date).getTime()-e});this.tasksHistory=s}finally{t.dismiss()}})}onEdit(t){const s=this.taskDelegatorFactory.getTaskDelegator(t.type),e={};e[r.a.TaskDescId]=t.taskId,e[r.a.SavedTaskId]=t._id;const i={Path:`tabs/tasks/${s.getComponentRoute()}`,Params:e,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(i),this.router.navigate([i.Path,i.Params],i.NavigationExtras)}onCopyExport(t,s,e){return Object(c.a)(this,void 0,void 0,function*(){const i=this.taskDelegatorFactory.getTaskDelegator(t.type);try{const s=yield i.exportCopy(t._id,t.taskId),n=yield this.popupCtrl.create({component:b,event:e,componentProps:{msg:s}});yield n.present(),"upload"===(yield n.onWillDismiss()).data&&this.uploadTask(s,t)}catch(n){this.msgService.showToast("Cant export this task",1e3,"toastWarn")}s.closeOpened()})}onDeleted(t,s){return Object(c.a)(this,void 0,void 0,function*(){s.closeOpened();let e=!1;const i=yield this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:()=>e=!0}]});if(yield i.present(),yield i.onWillDismiss(),e){const s=this.taskDelegatorFactory.getTaskDelegator(t.type),e=yield this.loadingCtrl.create({message:"temp delete task"});yield e.present(),yield s.deleteTask(t),yield this.loadTasks(),yield e.dismiss(),yield e.onDidDismiss()}})}showSearchbar(t){}showTaskFilters(){}updateSearchTask(){}trackByFn(t,s){return s?s._id:t}temp(t){console.log(t._id)}uploadTask(t,s){var e,i,n;return Object(c.a)(this,void 0,void 0,function*(){let o;this.popupCtrl.dismiss("upload");try{let a=!0,c=null;const r=(yield this.tasksDelegator.getCategoryConfig()).isNoTaskUploadWithDesc;if(!r){const t=yield this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.TaskUpload,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"activate",cssClass:"danger"}],inputs:[{name:"taskDesc",type:"text",placeholder:this.langProvider.TaskUploadDesc}]});yield t.present();const s=yield t.onWillDismiss();a="activate"===s.role,c=null===(i=null===(e=s.data)||void 0===e?void 0:e.values)||void 0===i?void 0:i.taskDesc}if(a)if(r||c){o=yield this.msgService.showLoader();const e=this.appContext.getAppContext(),i={ActivationCode:e.activationCode,User:e.user,UserDesc:null!==(n=e.userDesc)&&void 0!==n?n:e.user,TaskDesc:c,Task:t};yield this.syncService.uploadTask(i),s.isExported=!0,yield this.tasksDelegator.saveTask(s),yield this.msgService.showToast(this.langProvider.TaskUploadedSuccessfuly,2e3,"toastSuccess")}else this.msgService.showToast(this.langProvider.TaskUploadDescMissing,1e3,"toastWarn")}catch(a){this.msgService.showMessage(null==a?void 0:a.message,this.langProvider.ErrorUploadTask,"toastWarn"),this.popupCtrl.dismiss()}finally{o.dismiss()}})}}return t.\u0275fac=function(s){return new(s||t)(l.Kb(a.f),l.Kb(p.a),l.Kb(h.a),l.Kb(u.a),l.Kb(g.a),l.Kb(y.a),l.Kb(f.b),l.Kb(d.a),l.Kb(o.ib),l.Kb(o.cb),l.Kb(o.b),l.Kb(k.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-tasks-history"]],viewQuery:function(t,s){if(1&t&&l.xc(o.ab,1),2&t){let t;l.ic(t=l.Yb())&&(s.virtualScroll=t.first)}},decls:1,vars:1,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slide",""],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"],["name","share-social","color","primary",1,"htBtn"],["button","",3,"click"],[1,"taskHistory"],["name","cloud-upload","color","primary","class","exportIcon",4,"ngIf"],[2,"direction","ltr"],[3,"task","candidates"],["name","cloud-upload","color","primary",1,"exportIcon"]],template:function(t,s){1&t&&l.pc(0,S,8,4,"ng-container",0),2&t&&l.fc("ngIf",s.isInit)},directives:[i.m,o.s,o.Z,o.n,o.D,i.l,o.k,o.F,o.X,o.j,o.t,o.N,o.lb,n.e,n.h,o.B,o.A,o.z,o.w,o.C,C],pipes:[i.k,i.e],styles:[".taskHistory[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.htBtn[_ngcontent-%COMP%]{font-size:x-large}.exportIcon[_ngcontent-%COMP%]{margin-left:.2rem}"]}),t})()}];let I=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({imports:[[a.h.forChild(x)],a.h]}),t})();var L=e("ajeZ");let M=(()=>{class t{}return t.\u0275fac=function(s){return new(s||t)},t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({imports:[[i.c,n.a,o.bb,L.a,I]]}),t})()}}]);