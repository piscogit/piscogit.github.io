(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{OrUu:function(t,s,i){"use strict";i.r(s),i.d(s,"TasksHistoryPageModule",(function(){return P}));var e=i("ofXK"),n=i("3Pt+"),o=i("TEn/"),a=i("tyNb"),c=i("mrSG"),r=i("Mxx3"),l=i("fXoL"),b=i("zrcv");let d=(()=>{class t{constructor(t,s){this.popupCtrl=t,this.msgService=s}ngOnInit(){}copy(){const t=JSON.stringify(this.msg);this.msgService.copyToClipboard(t),this.msgService.showToast("Copy to clipboard",1e3),this.popupCtrl.dismiss()}whatsapp(){const t=JSON.stringify(this.msg),s=document.createElement("a");s.href="whatsapp://send?text="+t,s["data-action"]="share/whatsapp/share",s.click(),this.popupCtrl.dismiss()}upload(){return Object(c.a)(this,void 0,void 0,(function*(){this.popupCtrl.dismiss("upload")}))}}return t.\u0275fac=function(s){return new(s||t)(l.Ib(o.Jb),l.Ib(b.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-share-data"]],inputs:{msg:"msg"},decls:7,vars:0,consts:[[1,"container"],["color","light",3,"click"],["color","primary","name","copy",1,"sicon"],["color","primary","name","logo-whatsapp",1,"sicon"],["color","primary","name","cloud-upload",1,"sicon"]],template:function(t,s){1&t&&(l.Nb(0,"div",0),l.Nb(1,"ion-button",1),l.Vb("click",(function(){return s.copy()})),l.Jb(2,"ion-icon",2),l.Mb(),l.Nb(3,"ion-button",1),l.Vb("click",(function(){return s.whatsapp()})),l.Jb(4,"ion-icon",3),l.Mb(),l.Nb(5,"ion-button",1),l.Vb("click",(function(){return s.upload()})),l.Jb(6,"ion-icon",4),l.Mb(),l.Mb())},directives:[o.k,o.C],styles:[".container[_ngcontent-%COMP%]{display:flex}.sicon[_ngcontent-%COMP%]{font-size:x-large}"]}),t})();var h=i("3LWr"),p=i("ufmx"),u=i("NrBX"),g=i("o6Vy"),y=i("VYsW"),m=i("L5fO"),f=i("RybT"),k=i("VVJX");function v(t,s){}let C=(()=>{class t{constructor(t,s){this.componentFactoryResolver=t,this.taskDelegatorFactory=s}ngOnInit(){const t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){const s=this.componentFactoryResolver.resolveComponentFactory(t),i=this.taskHost.viewContainerRef;i.clear();const e=i.createComponent(s);e.instance.task=this.task,e.instance.candidates=this.candidates,this.componentRef=e}}ngOnChanges(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}return t.\u0275fac=function(s){return new(s||t)(l.Ib(l.j),l.Ib(f.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-task-history-host"]],viewQuery:function(t,s){var i;1&t&&l.mc(k.a,!0),2&t&&l.gc(i=l.Wb())&&(s.taskHost=i.first)},inputs:{task:"task",candidates:"candidates"},features:[l.wb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,s){1&t&&l.oc(0,v,0,0,"ng-template",0)},directives:[k.a],styles:[""]}),t})();function w(t,s){if(1&t){const t=l.Ob();l.Nb(0,"ion-button",6),l.Vb("click",(function(){return l.ic(t),l.Xb(3).showSearchbar(!0)})),l.Jb(1,"ion-icon",8),l.Mb()}}function T(t,s){if(1&t){const t=l.Ob();l.Lb(0),l.Nb(1,"ion-buttons",3),l.Jb(2,"ion-menu-button"),l.Mb(),l.Nb(3,"ion-title"),l.qc(4),l.Mb(),l.Nb(5,"ion-buttons",4),l.oc(6,w,2,0,"ion-button",5),l.Nb(7,"ion-button",6),l.Vb("click",(function(){return l.ic(t),l.Xb(2).showTaskFilters()})),l.Jb(8,"ion-icon",7),l.Mb(),l.Mb(),l.Kb()}if(2&t){const t=l.Xb(2);l.yb(3),l.nc("direction",t.langProvider.LangDirection),l.yb(1),l.rc(t.langProvider.TasksHistory),l.yb(2),l.dc("ngIf",!t.isShowSearchbar)}}function M(t,s){if(1&t){const t=l.Ob();l.Nb(0,"ion-searchbar",9),l.Vb("ngModelChange",(function(s){return l.ic(t),l.Xb(2).searchTaskStr=s}))("ionChange",(function(){return l.ic(t),l.Xb(2).updateSearchTask()}))("ionCancel",(function(){return l.ic(t),l.Xb(2).showSearchbar(!1)})),l.Mb()}if(2&t){const t=l.Xb(2);l.dc("ngModel",t.searchTaskStr)}}function I(t,s){if(1&t){const t=l.Ob();l.Nb(0,"ion-item-sliding",null,10),l.Yb(2,"lowercase"),l.Nb(3,"ion-item-options",11),l.Nb(4,"ion-item-option",12),l.Vb("click",(function(){l.ic(t);const i=s.$implicit,e=l.hc(1);return l.Xb(2).onDeleted(i,e)})),l.Jb(5,"ion-icon",13),l.Mb(),l.Nb(6,"ion-item-option",12),l.Vb("click",(function(i){l.ic(t);const e=s.$implicit,n=l.hc(1);return l.Xb(2).onCopyExport(e,n,i)})),l.Jb(7,"ion-icon",14),l.Mb(),l.Mb(),l.Nb(8,"ion-item",15),l.Vb("click",(function(){l.ic(t);const i=s.$implicit;return l.Xb(2).onEdit(i)})),l.Nb(9,"ion-label"),l.Nb(10,"h3",16),l.Nb(11,"span"),l.qc(12),l.Mb(),l.Nb(13,"span",17),l.qc(14),l.Yb(15,"date"),l.Mb(),l.Mb(),l.Jb(16,"app-task-history-host",18),l.Mb(),l.Mb(),l.Mb()}if(2&t){const t=s.$implicit,i=l.Xb(2);l.zb("track",l.Zb(2,7,t.type)),l.yb(9),l.nc("direction",i.langProvider.LangDirection),l.yb(3),l.rc(t.name),l.yb(2),l.rc(l.ac(15,9,t.date,"dd/MM/yy HH:mm:ss")),l.yb(2),l.dc("task",t)("candidates",i.candidates)}}function N(t,s){if(1&t&&(l.Lb(0),l.Nb(1,"ion-header"),l.Nb(2,"ion-toolbar"),l.oc(3,T,9,4,"ng-container",0),l.oc(4,M,1,1,"ion-searchbar",1),l.Mb(),l.Mb(),l.Nb(5,"ion-content"),l.Nb(6,"ion-list"),l.oc(7,I,17,12,"ion-item-sliding",2),l.Mb(),l.Mb(),l.Kb()),2&t){const t=l.Xb();l.yb(3),l.dc("ngIf",!t.isShowSearchbar),l.yb(1),l.dc("ngIf",t.isShowSearchbar),l.yb(3),l.dc("ngForOf",t.tasksHistory)("ngForTrackBy",t.trackByFn)}}const O=[{path:"",component:(()=>{class t{constructor(t,s,i,e,n,o,a,c,r,l,b,d){this.router=t,this.store=s,this.candidatesDelegator=i,this.tasksDelegator=e,this.syncService=n,this.appContext=o,this.langProvider=a,this.msgService=c,this.popupCtrl=r,this.loadingCtrl=l,this.alertController=b,this.taskDelegatorFactory=d,this.subscription={},this.isInit=!1}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){this.candidates=yield this.candidatesDelegator.getCandidatesCopy(),this.subscription.lastTasksChangeTime=this.store.lastTasksChangeTime.subscribe(t=>Object(c.a)(this,void 0,void 0,(function*(){this.loadTasks()}))),this.isInit=!0}))}ngOnDestroy(){for(const t in this.subscription)Object.prototype.hasOwnProperty.call(this.subscription,t)&&this.subscription[t].unsubscribe()}ionViewWillEnter(){return Object(c.a)(this,void 0,void 0,(function*(){}))}loadTasks(){return Object(c.a)(this,void 0,void 0,(function*(){let t;try{t=yield this.msgService.showLoader();const s=(yield this.tasksDelegator.getAllTasks()).sort((t,s)=>{const i=new Date(t.date).getTime();return new Date(s.date).getTime()-i});this.tasksHistory=s}finally{t.dismiss()}}))}onEdit(t){const s=this.taskDelegatorFactory.getTaskDelegator(t.type),i={};i[r.a.TaskDescId]=t.taskId,i[r.a.SavedTaskId]=t._id;const e={Path:"tabs/tasks/"+s.getComponentRoute(),Params:i,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(e),this.router.navigate([e.Path,e.Params],e.NavigationExtras)}onCopyExport(t,s,i){return Object(c.a)(this,void 0,void 0,(function*(){const e=this.taskDelegatorFactory.getTaskDelegator(t.type);try{const s=yield e.exportCopy(t._id,t.taskId),n=yield this.popupCtrl.create({component:d,event:i,componentProps:{msg:s}});yield n.present(),"upload"===(yield n.onWillDismiss()).data&&this.uploadTask(s)}catch(n){this.msgService.showToast("Cant export this task type to clipboard",1e3,"toastWarn")}s.closeOpened()}))}onDeleted(t,s){return Object(c.a)(this,void 0,void 0,(function*(){s.closeOpened();let i=!1;const e=yield this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:()=>i=!0}]});if(yield e.present(),yield e.onWillDismiss(),i){const s=this.taskDelegatorFactory.getTaskDelegator(t.type),i=yield this.loadingCtrl.create({message:"temp delete task"});yield i.present(),yield s.deleteTask(t),yield this.loadTasks(),yield i.dismiss(),yield i.onDidDismiss()}}))}showSearchbar(t){}showTaskFilters(){}updateSearchTask(){}trackByFn(t,s){return s?s._id:t}temp(t){console.log(t._id)}uploadTask(t){return Object(c.a)(this,void 0,void 0,(function*(){let s;this.popupCtrl.dismiss("upload");try{s=yield this.msgService.showLoader();const i=this.appContext.getAppContext(),e={ActivationCode:i.activationCode,User:i.user,Task:t};yield this.syncService.uploadTask(e),yield this.msgService.showToast(this.langProvider.TaskUploadedSuccessfuly,2e3,"toastSuccess")}catch(i){this.msgService.showMessage(null==i?void 0:i.message,this.langProvider.ErrorUploadTask,"toastWarn"),this.popupCtrl.dismiss()}finally{s.dismiss()}}))}}return t.\u0275fac=function(s){return new(s||t)(l.Ib(a.f),l.Ib(h.a),l.Ib(p.a),l.Ib(u.a),l.Ib(g.a),l.Ib(y.a),l.Ib(m.b),l.Ib(b.a),l.Ib(o.Jb),l.Ib(o.Cb),l.Ib(o.b),l.Ib(f.a))},t.\u0275cmp=l.Cb({type:t,selectors:[["app-tasks-history"]],viewQuery:function(t,s){var i;1&t&&l.wc(o.Ab,!0),2&t&&l.gc(i=l.Wb())&&(s.virtualScroll=i.first)},decls:1,vars:1,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slide",""],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"],["name","share-social","color","primary",1,"htBtn"],["button","",3,"click"],[1,"taskHistory"],[2,"direction","ltr"],[3,"task","candidates"]],template:function(t,s){1&t&&l.oc(0,N,8,4,"ng-container",0),2&t&&l.dc("ngIf",s.isInit)},directives:[e.t,o.B,o.zb,o.u,o.O,e.s,o.l,o.R,o.xb,o.k,o.C,o.hb,o.Nb,n.j,n.m,o.M,o.L,o.K,o.H,o.N,C],pipes:[e.p,e.f],styles:[".taskHistory[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.htBtn[_ngcontent-%COMP%]{font-size:x-large}"]}),t})()}];let S=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(s){return new(s||t)},imports:[[a.j.forChild(O)],a.j]}),t})();var D=i("ajeZ");let P=(()=>{class t{}return t.\u0275mod=l.Gb({type:t}),t.\u0275inj=l.Fb({factory:function(s){return new(s||t)},imports:[[e.c,n.e,o.Bb,D.a,S]]}),t})()}}]);