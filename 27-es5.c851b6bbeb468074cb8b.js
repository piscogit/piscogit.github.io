!function(){function t(t,n){var a;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(a=function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(t,n)}(t))||n&&t&&"number"==typeof t.length){a&&(t=a);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return o=t.done,t},e:function(t){c=!0,s=t},f:function(){try{o||null==a.return||a.return()}finally{if(c)throw s}}}}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function i(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{CIRo:function(e,a,r){"use strict";r.d(a,"a",(function(){return P}));var s=r("mrSG"),o=r("kLqA"),c=r("fXoL"),d=r("TEn/"),l=r("L5fO"),u=r("ufmx"),b=r("zrcv"),f=r("ofXK"),h=r("g1yl");function k(t,e){if(1&t){var n=c.Ob();c.Nb(0,"app-candidate-avatar",13),c.Vb("click",(function(){c.ic(n);var t=e.$implicit,a=c.Xb();return a.selectRemoveAction(a.basketItemsEdit[t._id])})),c.Mb()}if(2&t){var a=e.$implicit,i=c.Xb();c.dc("candidate",a)("total",i.basketItemsEdit[a._id].total)("isSelected",i.dirtyItems[a._id])("isShowTotal",!0)}}var m,v=((m=function(){function t(e,a,i,r,s){n(this,t),this.modalCtrl=e,this.langProvider=a,this.candidatesDelegator=i,this.msgService=r,this.navCtrl=s,this.dirtyItems={},this.mode="add"}return i(t,[{key:"ngOnInit",value:function(){this.basketItemsOriginal=this.basketItems.reduce((function(t,e){return t[e.candidate]=e,t}),{}),this.candidates=this.candidatesDelegator.getCandidatesByIds(Object.keys(this.basketItemsOriginal)),this.candidates.sort((function(t,e){return t.number-e.number})),this.basketItemsEdit=JSON.parse(JSON.stringify(this.basketItemsOriginal)),this.selectRemoveAction=this.selectItem}},{key:"trackByFn",value:function(t,e){return e?e._id:t}},{key:"selectItem",value:function(t){!this.taskConfig.isCandidateMultiBasket&&t.total>0?this.msgService.showToast(this.langProvider.CandidateAlreadyExistInBasket):this.taskConfig.maxTotalPerSingleEdit&&t.total-this.basketItemsOriginal[t.candidate].total>=this.taskConfig.maxTotalPerSingleEdit?this.msgService.showToast(this.langProvider.MaxTotalsPerSingleEditBasket):(t.total++,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total)}},{key:"removeItem",value:function(t){t.total>0&&t.total--,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total}},{key:"changeAddMode",value:function(){this.mode="add",this.selectRemoveAction=this.selectItem}},{key:"changeRemoveMode",value:function(){this.mode="remove",this.selectRemoveAction=this.removeItem}},{key:"activate",value:function(){var t=this,e=Object.keys(this.dirtyItems).filter((function(e){return t.dirtyItems[e]})).map((function(e){return t.basketItemsEdit[e]}));this.modalCtrl.dismiss(e)}},{key:"back",value:function(t){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(Object.keys(this.dirtyItems).filter((function(t){return e.dirtyItems[t]})).length>0)){t.next=8;break}return t.next=3,this.msgService.showAreYouSure(this.langProvider.CommentNotSaved);case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.modalCtrl.dismiss();case 6:t.next=9;break;case 8:this.modalCtrl.dismiss();case 9:case"end":return t.stop()}}),t,this)})))}}]),t}()).\u0275fac=function(t){return new(t||m)(c.Ib(d.eb),c.Ib(l.b),c.Ib(u.a),c.Ib(b.a),c.Ib(d.fb))},m.\u0275cmp=c.Cb({type:m,selectors:[["app-candikeyboard"]],inputs:{basketItems:"basketItems",taskConfig:"taskConfig"},decls:17,vars:4,consts:[["translucent","true"],[1,"options"],[3,"color","click"],["name","add"],["name","remove"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"container"],[1,"candiContainer"],["slot","start","class","candi",3,"candidate","total","isSelected","isShowTotal","click",4,"ngFor","ngForOf","ngForTrackBy"],["color","secondary",1,"activate",3,"click"],["name","send"],["slot","start",1,"candi",3,"candidate","total","isSelected","isShowTotal","click"]],template:function(t,e){1&t&&(c.Nb(0,"ion-header",0),c.Nb(1,"ion-toolbar"),c.Nb(2,"ion-title"),c.Nb(3,"div",1),c.Nb(4,"ion-fab-button",2),c.Vb("click",(function(){return e.changeAddMode()})),c.Jb(5,"ion-icon",3),c.Mb(),c.Nb(6,"ion-fab-button",2),c.Vb("click",(function(){return e.changeRemoveMode()})),c.Jb(7,"ion-icon",4),c.Mb(),c.Mb(),c.Mb(),c.Nb(8,"ion-buttons",5),c.Nb(9,"ion-button",6),c.Vb("click",(function(t){return e.back(t)})),c.Jb(10,"ion-icon",7),c.Mb(),c.Mb(),c.Mb(),c.Mb(),c.Nb(11,"ion-content"),c.Nb(12,"div",8),c.Nb(13,"div",9),c.nc(14,k,1,4,"app-candidate-avatar",10),c.Mb(),c.Nb(15,"ion-fab-button",11),c.Vb("click",(function(){return e.activate()})),c.Jb(16,"ion-icon",12),c.Mb(),c.Mb(),c.Mb()),2&t&&(c.yb(4),c.dc("color","add"===e.mode?"primary":"light"),c.yb(2),c.dc("color","remove"===e.mode?"danger":"light"),c.yb(8),c.dc("ngForOf",e.candidates)("ngForTrackBy",e.trackByFn))},directives:[d.s,d.Z,d.X,d.p,d.t,d.k,d.j,d.n,f.l,h.a],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candiContainer[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;overflow:scroll}.options[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{transform:rotate(180deg);margin:.5rem auto}"],changeDetection:0}),m),g=r("Mxx3"),p=r("AytR"),y=r("tyNb"),w=r("3LWr"),I=r("NrBX"),C=r("pQKU");function x(t,e){if(1&t&&(c.Nb(0,"ion-header"),c.Nb(1,"ion-toolbar"),c.Nb(2,"ion-buttons",1),c.Jb(3,"ion-menu-button"),c.Mb(),c.Nb(4,"ion-buttons",2),c.Jb(5,"ion-back-button",3),c.Mb(),c.Nb(6,"ion-title"),c.pc(7),c.Mb(),c.Mb(),c.Mb()),2&t){var n=c.Xb();c.yb(7),c.qc(null==n.taskDesc?null:n.taskDesc.description)}}function O(t,e){if(1&t&&c.Jb(0,"app-candidate-avatar",12),2&t){var n=c.Xb().$implicit,a=c.Xb(3);c.dc("candidateId",n.candidate)("total",n.total)("isShowTotal",a.taskConfig.isCandidateMultiBasket)}}function D(t,e){if(1&t&&(c.Nb(0,"div"),c.nc(1,O,1,3,"app-candidate-avatar",11),c.Mb()),2&t){var n=e.$implicit;c.yb(1),c.dc("ngIf",n.total>0)}}function M(t,e){if(1&t){var n=c.Ob();c.Nb(0,"ion-chip",7),c.Vb("click",(function(){c.ic(n);var t=e.$implicit;return c.Xb(2).selectBasket(t.name)})),c.Nb(1,"ion-label",8),c.pc(2),c.Mb(),c.Nb(3,"div",9),c.nc(4,D,2,1,"div",10),c.Mb(),c.Mb()}if(2&t){var a=e.$implicit,i=c.Xb(2);c.mc("direction",i.taskDesc.langDir),c.Ab("selectedBasket",a.name===i.selectedBasket),c.yb(2),c.qc(a.name),c.yb(2),c.dc("ngForOf",i.taskSavedData.main.baskets[a.name].all)}}function S(t,e){if(1&t){var n=c.Ob();c.Nb(0,"ion-fab",13),c.Nb(1,"ion-fab-button",14),c.Vb("click",(function(){return c.ic(n),c.Xb(2).createComment()})),c.Jb(2,"ion-icon",15),c.Mb(),c.Mb()}}function T(t,e){if(1&t&&(c.Nb(0,"ion-content"),c.Nb(1,"div",4),c.nc(2,M,5,6,"ion-chip",5),c.Mb(),c.nc(3,S,3,0,"ion-fab",6),c.Mb()),2&t){var n=c.Xb();c.yb(2),c.dc("ngForOf",n.taskConfig.baskets),c.yb(1),c.dc("ngIf",!n.integrated)}}var N,P=((N=function(){function e(t,a,i,r,s,o,c,d,l,u){n(this,e),this.router=t,this.route=a,this.store=i,this.modalCtrl=r,this.msgService=s,this.langProvider=o,this.popoverController=c,this.candidatesDelegator=d,this.taskDelegator=l,this.basketDelegator=u,this.previewSize=p.a.basketPreviewSize}return i(e,[{key:"ngOnInit",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initTask();case 2:if(this.taskSavedData=t.sent,t.t0=this.integrated,t.t0){t.next=8;break}return t.next=7,this.loadTask();case 7:this.taskSavedData=t.sent;case 8:this.isTaskInit=!0;case 9:case"end":return t.stop()}}),t,this)})))}},{key:"ionViewWillLeave",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.basketDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)){t.next=4;break}this.msgService.showToast(this.langProvider.TaskEmptyDismissed,p.a.taskSavedToastInterval),t.next=9;break;case 4:return t.next=6,this.saveTask();case 6:this.taskSavedData=t.sent,this.msgService.showToast(this.langProvider.TaskSaved,p.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"initTask",value:function(){var e,n,a;return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var r,s,o,c,d;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return r=null!==(a=null!==(n=null===(e=this.integrated)||void 0===e?void 0:e.parentTaskId)&&void 0!==n?n:this.route.snapshot.paramMap.get(g.a.TaskDescId))&&void 0!==a?a:"t13",i.next=3,this.candidatesDelegator.getCandidatesCopy(!0);case 3:return this.candidates=i.sent,i.next=6,this.taskDelegator.getTaskDesk(r);case 6:return this.taskDesc=i.sent,i.next=9,this.taskDelegator.getTasksConfig(r);case 9:this.taskConfig=i.sent,s={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,candidates:this.candidates.map((function(t){return t._id})),baskets:{}}},o=t(this.taskConfig.baskets);try{for(o.s();!(c=o.n()).done;)d=c.value,s.main.baskets[d.name]={name:d.name,size:0,preview:[],all:this.candidates.map((function(t){return{candidate:t._id,total:0}}))}}catch(l){o.e(l)}finally{o.f()}return i.abrupt("return",s);case 14:case"end":return i.stop()}}),i,this)})))}},{key:"saveTask",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.basketDelegator.saveTask(this.taskSavedData,this.taskConfig);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"saveTaskIntegrated",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)})))}},{key:"loadTask",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.route.snapshot.paramMap.get(g.a.SavedTaskId))){t.next=11;break}return this.isTaskUpdate=!0,t.next=5,this.basketDelegator.loadTask(e);case 5:return n=t.sent,t.next=8,this.candidatesDelegator.getCandidatesByIds(n.main.candidates);case 8:this.candidates=t.sent,this.setLoadedData(n),this.taskSavedData=n;case 11:return t.abrupt("return",this.taskSavedData);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"setLoadedData",value:function(e){var n=this;for(var a in e.main.baskets)if(Object.prototype.hasOwnProperty.call(e.main.baskets,a)){var i,r=e.main.baskets[a],s=[],o=t(r.preview);try{var c=function(){var t=i.value,e=r.all.find((function(e){return e.candidate===t.candidate}));s.push(e)};for(o.s();!(i=o.n()).done;)c()}catch(d){o.e(d)}finally{o.f()}r.preview=s}this.taskConfig.isCandidatesStatic||function(){var a=new Set;for(var i in e.main.baskets)Object.prototype.hasOwnProperty.call(e.main.baskets,i)&&e.main.baskets[i].all.forEach((function(t){return a.add(t.candidate)}));var r,s=t(a);try{var o=function(){var t=r.value;n.candidates=n.candidates.filter((function(e){return e._id!==t}))};for(s.s();!(r=s.n()).done;)o()}catch(d){s.e(d)}finally{s.f()}}()}},{key:"loadTaskIntegrated",value:function(t){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.taskSavedData=t,e.next=3,this.setLoadedData(t);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"selectBasket",value:function(t){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.selectedBasket=this.selectedBasket!==t?t:null,e.next=3,this.showCanidatesSelection(t);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"showCanidatesSelection",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,i,r,s,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=this.taskSavedData.main.baskets[e],n.next=3,this.modalCtrl.create({component:v,componentProps:{basketItems:a.all,taskConfig:this.taskConfig}});case 3:return i=n.sent,n.next=6,i.present();case 6:return n.next=8,i.onWillDismiss();case 8:if((r=n.sent).data){a.preview=r.data,s=t(r.data);try{for(c=function(){var t=o.value,e=a.all.find((function(e){return e.candidate===t.candidate}));e&&(e.total=t.total)},s.s();!(o=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}}case 10:case"end":return n.stop()}}),n,this)})))}},{key:"createComment",value:function(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:o.Guid.raw()}],{skipLocationChange:!0})}}]),e}()).\u0275fac=function(t){return new(t||N)(c.Ib(y.f),c.Ib(y.a),c.Ib(w.a),c.Ib(d.eb),c.Ib(b.a),c.Ib(l.b),c.Ib(d.ib),c.Ib(u.a),c.Ib(I.a),c.Ib(C.a))},N.\u0275cmp=c.Cb({type:N,selectors:[["app-baskets2"]],inputs:{integrated:"integrated"},decls:2,vars:2,consts:[[4,"ngIf"],["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],[1,"baskets"],["id","baskets","class","basket","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",3,"selectedBasket","direction","click",4,"ngFor","ngForOf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content",4,"ngIf"],["id","baskets","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",1,"basket",3,"click"],["color","secondary",1,"basketHeader"],[1,"basketItems",2,"direction","ltr"],[4,"ngFor","ngForOf"],["class","avatarBasket",3,"candidateId","total","isShowTotal",4,"ngIf"],[1,"avatarBasket",3,"candidateId","total","isShowTotal"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],["color","primary",3,"click"],["name","chatbox-ellipses"]],template:function(t,e){1&t&&(c.nc(0,x,8,1,"ion-header",0),c.nc(1,T,4,2,"ion-content",0)),2&t&&(c.dc("ngIf",!e.integrated),c.yb(1),c.dc("ngIf",e.isTaskInit))},directives:[f.m,d.s,d.Z,d.k,d.F,d.g,d.h,d.X,d.n,f.l,d.l,d.C,h.a,d.o,d.p,d.t],styles:[".container[_ngcontent-%COMP%]{flex-direction:column;width:100%}.baskets[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{display:flex;height:100%}.baskets[_ngcontent-%COMP%]{align-content:flex-start;overflow:scroll}.basket[_ngcontent-%COMP%], .baskets[_ngcontent-%COMP%]{flex-direction:column;flex:1}.basket[_ngcontent-%COMP%]{min-height:8rem;display:flex}.basketItems[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;width:100%;flex-wrap:wrap;overflow:scroll}.avatarBasket[_ngcontent-%COMP%]{height:2rem;width:2rem;margin:.5rem}"]}),N)}}])}();