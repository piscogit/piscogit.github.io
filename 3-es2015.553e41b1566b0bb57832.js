(window.webpackJsonp=window.webpackJsonp||[]).push([[3,25],{"2lKs":function(t,e,a){"use strict";a.d(e,"a",function(){return Q});var i=a("mrSG"),n=a("fXoL"),s=a("5+WD"),o=a("Mxx3"),d=a("pQKU"),c=a("AytR"),r=a("kLqA"),l=a("CIRo"),b=a("tyNb"),h=a("3LWr"),g=a("zrcv"),u=a("L5fO"),k=a("TEn/"),p=a("ufmx"),m=a("NrBX"),v=a("TtBN"),f=a("3Pt+"),y=a("ofXK"),C=a("OZ4V"),D=a("g1yl");const O=["candidatesOrder"];function P(t,e){if(1&t&&n.Mb(0,"app-candidate-avatar",30),2&t){const t=n.bc().$implicit;n.hc("candidate",t)}}function B(t,e){if(1&t&&n.Mb(0,"app-candidate-avatar",30),2&t){const t=n.bc().$implicit;n.hc("candidate",t)}}function I(t,e){1&t&&n.Mb(0,"span",31)}function w(t,e){if(1&t&&(n.Rb(0,"div",22),n.Rb(1,"ion-item",23),n.Rb(2,"div",24),n.Rb(3,"span",25),n.tc(4),n.Qb(),n.Mb(5,"app-candidate-avatar",26),n.Qb(),n.rc(6,P,1,1,"app-candidate-avatar",27),n.rc(7,B,1,1,"app-candidate-avatar",28),n.Qb(),n.rc(8,I,1,0,"span",29),n.Qb()),2&t){const t=e.$implicit,a=e.index,i=n.bc(2);n.Bb(1),n.ic("id","order_",t._id,""),n.hc("cdkDragStartDelay",i.dragDelay),n.Bb(3),n.vc("",a+1,"."),n.Bb(1),n.hc("candidate",t),n.Bb(3),n.hc("ngIf",i.store.isIos)}}function S(t,e){if(1&t){const t=n.Sb();n.Rb(0,"div",16),n.Rb(1,"app-candidate-selection",17),n.Zb("candidateSelected",function(e){return n.mc(t),n.bc().selectCandidate(e)})("cdkDropListDropped",function(e){return n.mc(t),n.bc().dropCandidates(e)}),n.Qb(),n.Rb(2,"ion-chip",18),n.Rb(3,"ion-list",19,20),n.Zb("cdkDropListDropped",function(e){return n.mc(t),n.bc().dropCandidatesOrder(e)}),n.rc(5,w,9,5,"div",21),n.Qb(),n.Qb(),n.Qb()}if(2&t){const t=n.bc();n.hc("hidden","ordered"!==t.segment),n.Bb(1),n.hc("candidates",t.candidates)("selectedCandidates",t.selectedCandidates)("cdkDropListData",t.candidates),n.Bb(2),n.hc("cdkDropListData",t.orderedCandidates),n.Bb(2),n.hc("ngForOf",t.orderedCandidates)("ngForTrackBy",t.trackByFn)}}function R(t,e){if(1&t){const t=n.Sb();n.Rb(0,"ion-fab-button",32),n.Zb("click",function(){return n.mc(t),n.bc().saveAndNew()}),n.Mb(1,"ion-icon",33),n.Qb()}}let Q=(()=>{class t{constructor(t,e,a,i,n,s,d,c,r,l){this.router=t,this.route=e,this.store=a,this.msgService=i,this.langProvider=n,this.popoverController=s,this.candidatesDelegator=d,this.taskDelegator=c,this.basketDelegator=r,this.orderedDelegator=l,this.orderedCandidates=[],this.selectedCandidates={},this.dragDelay=o.a.DragDelay,this.segment="ordered",this.integratedBaskets={parentId:null,parentTaskId:null,parentTaskType:null}}ngOnInit(){return Object(i.a)(this,void 0,void 0,function*(){this.taskSavedData=yield this.initTask(),this.taskSavedData=yield this.loadTask(),this.isTaskInit=!0})}initTask(){var t;return Object(i.a)(this,void 0,void 0,function*(){const e=null!==(t=this.route.snapshot.paramMap.get(o.a.TaskDescId))&&void 0!==t?t:"t13";this.candidates=yield this.candidatesDelegator.getCandidatesCopy(!0),this.taskDesc=yield this.taskDelegator.getTaskDesk(e),this.taskConfig=yield this.taskDelegator.getTasksConfig(e);const a={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,orderedCandidates:[],candidates:this.candidates.map(t=>t._id),childIds:{}},basketsSaveData:null};return this.integratedBaskets={parentId:null,parentTaskId:this.taskDesc.id,parentTaskType:this.taskDesc.type},this.isSaveAndNew=!this.taskConfig.maxItems||this.taskConfig.maxItems>1,a})}ionViewWillLeave(){var t;return Object(i.a)(this,void 0,void 0,function*(){this.taskSavedData.main.orderedCandidates=this.orderedCandidates.map(t=>t._id),this.taskSavedData.basketsSaveData=null===(t=this.basketPage)||void 0===t?void 0:t.taskSavedData,this.orderedDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)?this.msgService.showToast(this.langProvider.TaskEmptyDismissed,c.a.taskSavedToastInterval):(this.taskSavedData=yield this.saveTask(),yield this.basketPage.ionViewWillLeave(),this.msgService.showToast(this.langProvider.TaskSaved,c.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date))})}saveTask(){return Object(i.a)(this,void 0,void 0,function*(){return yield this.orderedDelegator.saveTask(this.taskSavedData,this.taskConfig)})}loadTask(){return Object(i.a)(this,void 0,void 0,function*(){const t=this.route.snapshot.paramMap.get(o.a.SavedTaskId);let e=this.taskSavedData;if(t){this.isTaskUpdate=!0,e=yield this.orderedDelegator.loadTask(t),this.candidates=yield this.candidatesDelegator.getCandidatesByIds(e.main.candidates);for(const t of e.main.orderedCandidates){const e=this.candidates.find(e=>e._id===t);e&&this.selectCandidate(e)}this.basketPage.loadTaskIntegrated(e.basketsSaveData)}return e})}saveAndNew(){return Object(i.a)(this,void 0,void 0,function*(){if(yield this.msgService.showAreYouSure(this.langProvider.TaskSaveAndNew)){const t={};t[o.a.TaskDescId]=this.taskDesc.id,this.router.navigate(["tabs/task-catalog",t],{replaceUrl:!0,skipLocationChange:!0})}})}dropCandidates(t){if(t.previousContainer===t.container);else{const e=this.orderedCandidates.splice(t.previousIndex,1);this.candidates=this.candidates.sort((t,e)=>t.number-e.number),this.selectedCandidates[e[0]._id]=!1}}dropCandidatesOrder(t){t.previousContainer===t.container?Object(s.g)(t.container.data,t.previousIndex,t.currentIndex):(Object(s.h)(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex),this.selectedCandidates[t.previousContainer.data[t.previousIndex]._id]=!0)}selectCandidate(t){var e;this.selectedCandidates[t._id]||(this.selectedCandidates[t._id]=!0,this.orderedCandidates.push(t),(null===(e=this.candidatesOrder)||void 0===e?void 0:e.nativeElement)&&setTimeout(()=>{const t=this.candidatesOrder.nativeElement.children;t[t.length-1].scrollIntoView({behaviour:"smooth",block:"end"})},50))}changeOrder(){return Object(i.a)(this,void 0,void 0,function*(){(yield this.msgService.showAreYouSure(this.langProvider.OrderedReversedAreYouSure))&&(this.orderedCandidates.reverse(),this.msgService.showToast(this.langProvider.OrderedReversed,2e3))})}createComment(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:r.Guid.raw()}],{skipLocationChange:!0})}trackByFn(t,e){return e?e._id:t}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(b.f),n.Lb(b.a),n.Lb(h.a),n.Lb(g.a),n.Lb(u.b),n.Lb(k.ib),n.Lb(p.a),n.Lb(m.a),n.Lb(d.a),n.Lb(v.a))},t.\u0275cmp=n.Fb({type:t,selectors:[["app-ordered2"]],viewQuery:function(t,e){if(1&t&&(n.zc(l.a,3),n.zc(O,1,n.m)),2&t){let t;n.kc(t=n.ac())&&(e.basketPage=t.first),n.kc(t=n.ac())&&(e.candidatesOrder=t.first)}},features:[n.Ab([d.a])],decls:24,vars:8,consts:[["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],[3,"ngModel","ngModelChange"],["value","ordered"],["value","baskets"],[1,"content"],[1,"container",3,"hidden","integrated"],["class","container","cdkDropListGroup","",3,"hidden",4,"ngIf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],[2,"display","flex"],["color","primary",3,"click"],["name","chatbox-ellipses"],["color","secondary",2,"margin-left","0.2rem",3,"click"],["name","repeat"],["style","margin-left: 0.2rem;","color","tertiary",3,"click",4,"ngIf"],["cdkDropListGroup","",1,"container",3,"hidden"],["id","candidates","cdkDropList","",1,"candidatesSelection",3,"candidates","selectedCandidates","cdkDropListData","candidateSelected","cdkDropListDropped"],[1,"candidatesOrder"],["lines","none","id","candidatesOrder","cdkDropList","",1,"candidates",3,"cdkDropListData","cdkDropListDropped"],["candidatesOrder",""],["class","iosDndFixItem",4,"ngFor","ngForOf","ngForTrackBy"],[1,"iosDndFixItem"],["cdkDrag","",1,"orderItem",3,"cdkDragStartDelay","id"],[1,"avatarOrderContainer"],[1,"avatarOrder"],[1,"avatar","avatarMargin",3,"candidate"],["class","avatar",3,"candidate",4,"cdkDragPreview"],["class","avatar",3,"candidate",4,"cdkDragPlaceholder"],["class","iosDndFixGap",4,"ngIf"],[1,"avatar",3,"candidate"],[1,"iosDndFixGap"],["color","tertiary",2,"margin-left","0.2rem",3,"click"],["name","bag-check"]],template:function(t,e){1&t&&(n.Rb(0,"ion-header"),n.Rb(1,"ion-toolbar"),n.Rb(2,"ion-buttons",0),n.Mb(3,"ion-menu-button"),n.Qb(),n.Rb(4,"ion-title"),n.tc(5),n.Qb(),n.Rb(6,"ion-buttons",1),n.Mb(7,"ion-back-button",2),n.Qb(),n.Qb(),n.Rb(8,"ion-toolbar"),n.Rb(9,"ion-segment",3),n.Zb("ngModelChange",function(t){return e.segment=t}),n.Rb(10,"ion-segment-button",4),n.tc(11),n.Qb(),n.Rb(12,"ion-segment-button",5),n.tc(13),n.Qb(),n.Qb(),n.Qb(),n.Qb(),n.Rb(14,"ion-content",6),n.Mb(15,"app-baskets2",7),n.rc(16,S,6,7,"div",8),n.Rb(17,"ion-fab",9),n.Rb(18,"div",10),n.Rb(19,"ion-fab-button",11),n.Zb("click",function(){return e.createComment()}),n.Mb(20,"ion-icon",12),n.Qb(),n.Rb(21,"ion-fab-button",13),n.Zb("click",function(){return e.changeOrder()}),n.Mb(22,"ion-icon",14),n.Qb(),n.rc(23,R,2,0,"ion-fab-button",15),n.Qb(),n.Qb(),n.Qb()),2&t&&(n.Bb(5),n.uc(null==e.taskDesc?null:e.taskDesc.description),n.Bb(4),n.hc("ngModel",e.segment),n.Bb(2),n.vc(" ",e.langProvider.Ordered," "),n.Bb(2),n.vc(" ",e.langProvider.Baskets," "),n.Bb(2),n.hc("hidden","baskets"!==e.segment)("integrated",e.integratedBaskets),n.Bb(1),n.hc("ngIf",e.isTaskInit),n.Bb(7),n.hc("ngIf",e.isSaveAndNew&&e.orderedCandidates.length>0))},directives:[k.s,k.Z,k.k,k.F,k.X,k.g,k.h,k.O,k.kb,f.e,f.h,k.P,k.n,l.a,y.m,k.o,s.a,k.p,k.t,s.e,C.a,s.d,k.l,k.D,y.l,k.w,D.a,s.c,s.b],styles:[".content[_ngcontent-%COMP%]{height:100%;width:100%;display:flex}ion-chip[_ngcontent-%COMP%]{padding:0}.container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{height:100%;width:100%;overflow:scroll;min-width:var(--avatar-empty-width);background:transparent}.avatarContainer[_ngcontent-%COMP%]{--background:transparent}.candidatesSelection[_ngcontent-%COMP%]{height:80%;--background:rgba(160,165,177,.541)}.candidatesOrder[_ngcontent-%COMP%]{height:100%;min-width:30%;--background:rgba(157,186,250,.541)}.avatarOrderContainer[_ngcontent-%COMP%]{display:flex;align-items:center}.avatarOrder[_ngcontent-%COMP%]{margin-right:.2rem}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.reverseOrder[_ngcontent-%COMP%]{margin-top:20%}.orderItem[_ngcontent-%COMP%]{--background:transparent;--padding-start:0.2rem}"]}),t})()},CIRo:function(t,e,a){"use strict";a.d(e,"a",function(){return w});var i=a("mrSG"),n=a("kLqA"),s=a("Mxx3"),o=a("AytR"),d=a("fXoL"),c=a("TEn/"),r=a("L5fO"),l=a("ufmx"),b=a("zrcv"),h=a("ofXK"),g=a("g1yl");function u(t,e){if(1&t){const t=d.Sb();d.Rb(0,"app-candidate-avatar",13),d.Zb("click",function(){d.mc(t);const a=e.$implicit,i=d.bc();return i.selectRemoveAction(i.basketItemsEdit[a._id])}),d.Qb()}if(2&t){const t=e.$implicit,a=d.bc();d.hc("candidate",t)("total",a.basketItemsEdit[t._id].total)("isSelected",a.dirtyItems[t._id])("isShowTotal",!0)("selectedStyle","redBlue")}}let k=(()=>{class t{constructor(t,e,a,i,n){this.modalCtrl=t,this.langProvider=e,this.candidatesDelegator=a,this.msgService=i,this.navCtrl=n,this.dirtyItems={},this.mode="add"}ngOnInit(){this.basketItemsOriginal=this.basketItems.reduce((t,e)=>(t[e.candidate]=e,t),{}),this.candidates=this.candidatesDelegator.getCandidatesByIds(Object.keys(this.basketItemsOriginal)),this.candidates.sort((t,e)=>t.number-e.number),this.basketItemsEdit=JSON.parse(JSON.stringify(this.basketItemsOriginal)),this.selectRemoveAction=this.selectItem}trackByFn(t,e){return e?e._id:t}selectItem(t){!this.taskConfig.isCandidateMultiBasket&&t.total>0?this.msgService.showToast(this.langProvider.CandidateAlreadyExistInBasket,2e3,"toastWarn"):this.taskConfig.maxTotalPerSingleEdit&&t.total-this.basketItemsOriginal[t.candidate].total>=this.taskConfig.maxTotalPerSingleEdit?this.msgService.showToast(this.langProvider.MaxTotalsPerSingleEditBasket,2e3,"toastWarn"):this.basket.maxCandidatesAllowed&&this.basketItems.filter(t=>t.total>0).length>this.basket.maxCandidatesAllowed?this.msgService.showToast(this.langProvider.MaxCandidatesForBasket,2e3,"toastWarn"):(t.total++,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total)}removeItem(t){t.total>0&&t.total--,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total}changeAddMode(){this.mode="add",this.selectRemoveAction=this.selectItem}changeRemoveMode(){this.mode="remove",this.selectRemoveAction=this.removeItem}activate(){const t=Object.keys(this.dirtyItems).filter(t=>this.dirtyItems[t]).map(t=>this.basketItemsEdit[t]);this.modalCtrl.dismiss(t)}back(t){return Object(i.a)(this,void 0,void 0,function*(){Object.keys(this.dirtyItems).filter(t=>this.dirtyItems[t]).length>0?(yield this.msgService.showAreYouSure(this.langProvider.DataNotSaved))&&this.modalCtrl.dismiss():this.modalCtrl.dismiss()})}}return t.\u0275fac=function(e){return new(e||t)(d.Lb(c.eb),d.Lb(r.b),d.Lb(l.a),d.Lb(b.a),d.Lb(c.fb))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-basketkeyboard"]],inputs:{basketItems:"basketItems",taskConfig:"taskConfig",basket:"basket"},decls:19,vars:5,consts:[["translucent","true"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"options"],[3,"color","click"],["name","add"],["name","remove"],[1,"container"],[1,"candiContainer"],["slot","start","class","candi",3,"candidate","total","isSelected","isShowTotal","selectedStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],["color","secondary",1,"activate",3,"click"],["name","checkmark"],["slot","start",1,"candi",3,"candidate","total","isSelected","isShowTotal","selectedStyle","click"]],template:function(t,e){1&t&&(d.Rb(0,"ion-header",0),d.Rb(1,"ion-toolbar"),d.Rb(2,"ion-title"),d.tc(3),d.Qb(),d.Rb(4,"ion-buttons",1),d.Rb(5,"ion-button",2),d.Zb("click",function(t){return e.back(t)}),d.Mb(6,"ion-icon",3),d.Qb(),d.Qb(),d.Qb(),d.Rb(7,"ion-toolbar"),d.Rb(8,"div",4),d.Rb(9,"ion-fab-button",5),d.Zb("click",function(){return e.changeAddMode()}),d.Mb(10,"ion-icon",6),d.Qb(),d.Rb(11,"ion-fab-button",5),d.Zb("click",function(){return e.changeRemoveMode()}),d.Mb(12,"ion-icon",7),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.Rb(13,"ion-content"),d.Rb(14,"div",8),d.Rb(15,"div",9),d.rc(16,u,1,5,"app-candidate-avatar",10),d.Qb(),d.Rb(17,"ion-fab-button",11),d.Zb("click",function(){return e.activate()}),d.Mb(18,"ion-icon",12),d.Qb(),d.Qb(),d.Qb()),2&t&&(d.Bb(3),d.vc(" ",e.basket.name," "),d.Bb(6),d.hc("color","add"===e.mode?"primary":"light"),d.Bb(2),d.hc("color","remove"===e.mode?"danger":"light"),d.Bb(5),d.hc("ngForOf",e.candidates)("ngForTrackBy",e.trackByFn))},directives:[c.s,c.Z,c.X,c.k,c.j,c.t,c.p,c.n,h.l,g.a],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candiContainer[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;overflow:scroll}.options[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{margin:.5rem auto}"],changeDetection:0}),t})();var p=a("tyNb"),m=a("3LWr"),v=a("NrBX"),f=a("pQKU");function y(t,e){if(1&t&&(d.Rb(0,"ion-header"),d.Rb(1,"ion-toolbar"),d.Rb(2,"ion-buttons",1),d.Mb(3,"ion-menu-button"),d.Qb(),d.Rb(4,"ion-buttons",2),d.Mb(5,"ion-back-button",3),d.Qb(),d.Rb(6,"ion-title"),d.tc(7),d.Qb(),d.Qb(),d.Qb()),2&t){const t=d.bc();d.Bb(7),d.uc(null==t.taskDesc?null:t.taskDesc.description)}}function C(t,e){if(1&t&&d.Mb(0,"app-candidate-avatar",12),2&t){const t=d.bc().$implicit,e=d.bc(3);d.hc("candidateId",t.candidate)("total",t.total)("isShowTotal",e.taskConfig.isCandidateMultiBasket)}}function D(t,e){if(1&t&&(d.Rb(0,"div"),d.rc(1,C,1,3,"app-candidate-avatar",11),d.Qb()),2&t){const t=e.$implicit;d.Bb(1),d.hc("ngIf",t.total>0)}}function O(t,e){if(1&t){const t=d.Sb();d.Rb(0,"ion-chip",7),d.Zb("click",function(){d.mc(t);const a=e.$implicit;return d.bc(2).selectBasket(a)}),d.Rb(1,"ion-label",8),d.tc(2),d.Qb(),d.Rb(3,"div",9),d.rc(4,D,2,1,"div",10),d.Qb(),d.Qb()}if(2&t){const t=e.$implicit,a=d.bc(2);d.qc("direction",a.taskDesc.langDir),d.Db("selectedBasket",t.name===a.selectedBasket),d.Bb(2),d.uc(t.name),d.Bb(2),d.hc("ngForOf",a.taskSavedData.main.baskets[t.name].all)}}function P(t,e){if(1&t){const t=d.Sb();d.Rb(0,"ion-fab-button",18),d.Zb("click",function(){return d.mc(t),d.bc(3).saveAndNew()}),d.Mb(1,"ion-icon",19),d.Qb()}}function B(t,e){if(1&t){const t=d.Sb();d.Rb(0,"ion-fab",13),d.Rb(1,"div",14),d.Rb(2,"ion-fab-button",15),d.Zb("click",function(){return d.mc(t),d.bc(2).createComment()}),d.Mb(3,"ion-icon",16),d.Qb(),d.rc(4,P,2,0,"ion-fab-button",17),d.Qb(),d.Qb()}if(2&t){const t=d.bc(2);d.Bb(4),d.hc("ngIf",t.isSaveAndNew&&t.checkIfBasketsEmpty())}}function I(t,e){if(1&t&&(d.Rb(0,"ion-content"),d.Rb(1,"div",4),d.rc(2,O,5,6,"ion-chip",5),d.Qb(),d.rc(3,B,5,1,"ion-fab",6),d.Qb()),2&t){const t=d.bc();d.Bb(2),d.hc("ngForOf",t.taskConfig.baskets),d.Bb(1),d.hc("ngIf",!t.integrated)}}let w=(()=>{class t{constructor(t,e,a,i,n,s,d,c,r,l){this.router=t,this.route=e,this.store=a,this.modalCtrl=i,this.msgService=n,this.langProvider=s,this.popoverController=d,this.candidatesDelegator=c,this.taskDelegator=r,this.basketDelegator=l,this.previewSize=o.a.basketPreviewSize}ngOnInit(){return Object(i.a)(this,void 0,void 0,function*(){this.taskSavedData=yield this.initTask(),this.integrated||(this.taskSavedData=yield this.loadTask()),this.isTaskInit=!0})}ionViewWillLeave(){return Object(i.a)(this,void 0,void 0,function*(){this.basketDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)?this.msgService.showToast(this.langProvider.TaskEmptyDismissed,o.a.taskSavedToastInterval):(this.taskSavedData=yield this.saveTask(),this.msgService.showToast(this.langProvider.TaskSaved,o.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date))})}initTask(){var t,e,a;return Object(i.a)(this,void 0,void 0,function*(){let i;i=null!==(a=null!==(e=null===(t=this.integrated)||void 0===t?void 0:t.parentTaskId)&&void 0!==e?e:this.route.snapshot.paramMap.get(s.a.TaskDescId))&&void 0!==a?a:"t13",this.candidates=yield this.candidatesDelegator.getCandidatesCopy(!0),this.taskDesc=yield this.taskDelegator.getTaskDesk(i),this.taskConfig=yield this.taskDelegator.getTasksConfig(i);const n={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,candidates:this.candidates.map(t=>t._id),baskets:{}}};for(const t of this.taskConfig.baskets)n.main.baskets[t.name]={name:t.name,size:0,maxCandidatesAllowed:t.maxCandidatesAllowed,preview:[],all:this.candidates.map(t=>({candidate:t._id,total:0}))};return this.isSaveAndNew=!this.taskConfig.maxItems||this.taskConfig.maxItems>1,n})}saveTask(){return Object(i.a)(this,void 0,void 0,function*(){return yield this.basketDelegator.saveTask(this.taskSavedData,this.taskConfig)})}saveTaskIntegrated(){return Object(i.a)(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}loadTask(){return Object(i.a)(this,void 0,void 0,function*(){const t=this.route.snapshot.paramMap.get(s.a.SavedTaskId);if(t){this.isTaskUpdate=!0;const e=yield this.basketDelegator.loadTask(t);this.candidates=yield this.candidatesDelegator.getCandidatesByIds(e.main.candidates),this.setLoadedData(e),this.taskSavedData=e}return this.taskSavedData})}saveAndNew(){return Object(i.a)(this,void 0,void 0,function*(){if(yield this.msgService.showAreYouSure(this.langProvider.TaskSaveAndNew)){const t={};t[s.a.TaskDescId]=this.taskDesc.id,this.router.navigate(["tabs/task-catalog",t],{replaceUrl:!0,skipLocationChange:!0})}})}setLoadedData(t){for(const e in t.main.baskets)if(Object.prototype.hasOwnProperty.call(t.main.baskets,e)){const a=t.main.baskets[e],i=[];for(const t of a.preview){const e=a.all.find(e=>e.candidate===t.candidate);i.push(e)}a.preview=i}if(!this.taskConfig.isCandidatesStatic){const e=new Set;for(const a in t.main.baskets)Object.prototype.hasOwnProperty.call(t.main.baskets,a)&&t.main.baskets[a].all.forEach(t=>e.add(t.candidate));for(const t of e)this.candidates=this.candidates.filter(e=>e._id!==t)}}loadTaskIntegrated(t){return Object(i.a)(this,void 0,void 0,function*(){this.taskSavedData=t,yield this.setLoadedData(t)})}selectBasket(t){return Object(i.a)(this,void 0,void 0,function*(){this.selectedBasket=this.selectedBasket!==t.name?t.name:null,yield this.showCanidatesSelection(t)})}showCanidatesSelection(t){return Object(i.a)(this,void 0,void 0,function*(){const e=this.taskSavedData.main.baskets[t.name],a=yield this.modalCtrl.create({component:k,componentProps:{basketItems:e.all,taskConfig:this.taskConfig,basket:t}});yield a.present();const i=yield a.onWillDismiss();if(i.data){e.preview=i.data;for(const t of i.data){const a=e.all.find(e=>e.candidate===t.candidate);a&&(a.total=t.total)}e.all=e.all.sort((t,e)=>e.total-t.total)}})}checkIfBasketsEmpty(){return Object.keys(this.taskSavedData.main.baskets).some(t=>{var e;return(null===(e=this.taskSavedData.main.baskets[t].preview)||void 0===e?void 0:e.length)>0})}createComment(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:n.Guid.raw()}],{skipLocationChange:!0})}}return t.\u0275fac=function(e){return new(e||t)(d.Lb(p.f),d.Lb(p.a),d.Lb(m.a),d.Lb(c.eb),d.Lb(b.a),d.Lb(r.b),d.Lb(c.ib),d.Lb(l.a),d.Lb(v.a),d.Lb(f.a))},t.\u0275cmp=d.Fb({type:t,selectors:[["app-baskets2"]],inputs:{integrated:"integrated"},decls:2,vars:2,consts:[[4,"ngIf"],["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],[1,"baskets"],["id","baskets","class","basket","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",3,"selectedBasket","direction","click",4,"ngFor","ngForOf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content",4,"ngIf"],["id","baskets","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",1,"basket",3,"click"],["color","secondary",1,"basketHeader"],[1,"basketItems",2,"direction","ltr"],[4,"ngFor","ngForOf"],["class","avatarBasket",3,"candidateId","total","isShowTotal",4,"ngIf"],[1,"avatarBasket",3,"candidateId","total","isShowTotal"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],[2,"display","flex"],["color","primary",3,"click"],["name","chatbox-ellipses"],["style","margin-left: 0.2rem;","color","tertiary",3,"click",4,"ngIf"],["color","tertiary",2,"margin-left","0.2rem",3,"click"],["name","bag-check"]],template:function(t,e){1&t&&(d.rc(0,y,8,1,"ion-header",0),d.rc(1,I,4,2,"ion-content",0)),2&t&&(d.hc("ngIf",!e.integrated),d.Bb(1),d.hc("ngIf",e.isTaskInit))},directives:[h.m,c.s,c.Z,c.k,c.F,c.g,c.h,c.X,c.n,h.l,c.l,c.C,g.a,c.o,c.p,c.t],styles:[".container[_ngcontent-%COMP%]{width:100%}.baskets[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.baskets[_ngcontent-%COMP%]{align-content:flex-start;overflow:scroll;flex:1}.basket[_ngcontent-%COMP%]{min-height:8rem;display:flex;flex-direction:column;flex:1}.basketItems[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;width:100%;flex-wrap:wrap;overflow:scroll}.avatarBasket[_ngcontent-%COMP%]{height:2rem;width:2rem;margin:.5rem}"]}),t})()},OZ4V:function(t,e,a){"use strict";a.d(e,"a",function(){return p});var i=a("mrSG"),n=a("fXoL"),s=a("TEn/"),o=a("zrcv"),d=a("L5fO"),c=a("ofXK"),r=a("g1yl");function l(t,e){if(1&t){const t=n.Sb();n.Rb(0,"ion-header",3),n.Rb(1,"ion-toolbar"),n.Rb(2,"ion-title"),n.tc(3),n.Qb(),n.Rb(4,"ion-buttons",4),n.Rb(5,"ion-button",5),n.Zb("click",function(e){return n.mc(t),n.bc().back(e)}),n.Mb(6,"ion-icon",6),n.Qb(),n.Qb(),n.Qb(),n.Qb()}if(2&t){const t=n.bc();n.Bb(3),n.vc(" ",t.langProvider.Select," ")}}function b(t,e){if(1&t){const t=n.Sb();n.Rb(0,"app-candidate-avatar",11),n.Zb("click",function(){n.mc(t);const a=e.$implicit;return n.bc(2).select(a)}),n.Qb()}if(2&t){const t=e.$implicit,a=n.bc(2);n.hc("candidate",t)("isSelected",a.selectedCandidatesCopy[t._id])}}function h(t,e){if(1&t){const t=n.Sb();n.Rb(0,"ion-fab-button",12),n.Zb("click",function(){return n.mc(t),n.bc(2).activate()}),n.Mb(1,"ion-icon",13),n.Qb()}}function g(t,e){if(1&t&&(n.Pb(0),n.Rb(1,"ion-content"),n.Rb(2,"div",7),n.Rb(3,"div",8),n.rc(4,b,1,2,"app-candidate-avatar",9),n.Qb(),n.rc(5,h,2,0,"ion-fab-button",10),n.Qb(),n.Qb(),n.Ob()),2&t){const t=n.bc();n.Bb(4),n.hc("ngForOf",t.candidates)("ngForTrackBy",t.trackByFn),n.Bb(1),n.hc("ngIf",t.isModal)}}function u(t,e){if(1&t){const t=n.Sb();n.Rb(0,"app-candidate-avatar",11),n.Zb("click",function(){n.mc(t);const a=e.$implicit;return n.bc(2).select(a)}),n.Qb()}if(2&t){const t=e.$implicit,a=n.bc(2);n.hc("candidate",t)("isSelected",a.selectedCandidatesCopy[t._id])}}function k(t,e){if(1&t&&(n.Rb(0,"div",14),n.rc(1,u,1,2,"app-candidate-avatar",9),n.Qb()),2&t){const t=n.bc();n.Bb(1),n.hc("ngForOf",t.candidates)("ngForTrackBy",t.trackByFn)}}let p=(()=>{class t{constructor(t,e,a){this.modalCtrl=t,this.msgService=e,this.langProvider=a,this.candidateSelected=new n.o}ngOnInit(){this.isModal?(this.select=this.selectModal,this.selectedCandidates?this.selectedCandidatesCopy=JSON.parse(JSON.stringify(this.selectedCandidates)):this.selectedCandidates={}):(this.select=this.selectNoneModal,this.selectedCandidatesCopy=this.selectedCandidates)}selectNoneModal(t){this.candidateSelected.emit(t)}selectModal(t){this.selectedCandidatesCopy[t._id]=!this.selectedCandidatesCopy[t._id]}activate(){this.modalCtrl.dismiss(this.selectedCandidatesCopy)}trackByFn(t,e){return e?e._id:t}back(t){return Object(i.a)(this,void 0,void 0,function*(){this.candidates.filter(t=>this.selectedCandidates[t._id]!=this.selectedCandidatesCopy[t._id]).length>0?(yield this.msgService.showAreYouSure(this.langProvider.DataNotSaved))&&this.modalCtrl.dismiss():this.modalCtrl.dismiss()})}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(s.eb),n.Lb(o.a),n.Lb(d.b))},t.\u0275cmp=n.Fb({type:t,selectors:[["app-candidate-selection"]],inputs:{candidates:"candidates",selectedCandidates:"selectedCandidates",isModal:"isModal"},outputs:{candidateSelected:"candidateSelected"},decls:4,vars:3,consts:[["translucent","true",4,"ngIf"],[4,"ngIf","ngIfElse"],["noModal",""],["translucent","true"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"container"],[1,"candidates"],["class","candi",3,"candidate","isSelected","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","activate","color","secondary",3,"click",4,"ngIf"],[1,"candi",3,"candidate","isSelected","click"],["color","secondary",1,"activate",3,"click"],["name","checkmark"],[1,"candidates","candidatesNonModal"]],template:function(t,e){if(1&t&&(n.rc(0,l,7,1,"ion-header",0),n.rc(1,g,6,3,"ng-container",1),n.rc(2,k,2,2,"ng-template",null,2,n.sc)),2&t){const t=n.lc(3);n.hc("ngIf",e.isModal),n.Bb(1),n.hc("ngIf",e.isModal)("ngIfElse",t)}},directives:[c.m,s.s,s.Z,s.X,s.k,s.j,s.t,s.n,c.l,r.a,s.p],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-content:flex-start;overflow:scroll}.candidatesNonModal[_ngcontent-%COMP%]{height:100%}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{margin:.5rem auto}"]}),t})()},TtBN:function(t,e,a){"use strict";a.d(e,"a",function(){return R});var i=a("mrSG"),n=a("kMc0"),s=a("fXoL"),o=a("L5fO"),d=a("pQKU"),c=a("ofXK"),r=a("TEn/");function l(t,e){if(1&t&&(s.Pb(0),s.Rb(1,"span",3),s.tc(2),s.Qb(),s.Rb(3,"span",5),s.tc(4),s.Qb(),s.Ob()),2&t){const t=s.bc(2);s.Bb(2),s.uc(t.langProvider.TotalTasksNotParticipate),s.Bb(2),s.uc(t.orderedAggData.totalNotParticipated)}}function b(t,e){if(1&t&&(s.Pb(0),s.Rb(1,"span",3),s.tc(2),s.Qb(),s.Rb(3,"span",5),s.tc(4),s.Qb(),s.Rb(5,"span",8),s.tc(6),s.Qb(),s.Rb(7,"span",9),s.tc(8),s.Qb(),s.Ob()),2&t){const t=s.bc().$implicit;s.Bb(2),s.uc(t.key),s.Bb(2),s.uc(t.value.value),s.Bb(2),s.uc(t.value.avg),s.Bb(2),s.uc(t.value.max)}}function h(t,e){if(1&t&&(s.Pb(0),s.rc(1,b,9,4,"ng-container",0),s.Ob()),2&t){const t=e.$implicit;s.Bb(1),s.hc("ngIf",t.value.avg>0)}}function g(t,e){if(1&t&&(s.Pb(0),s.Rb(1,"ion-item"),s.Rb(2,"ion-label"),s.Rb(3,"div",1),s.Rb(4,"span"),s.tc(5),s.Qb(),s.Qb(),s.Rb(6,"div",2),s.Pb(7),s.Rb(8,"span",3),s.tc(9),s.Qb(),s.Rb(10,"span",4),s.tc(11),s.cc(12,"date"),s.Qb(),s.Ob(),s.Pb(13),s.Rb(14,"span",3),s.tc(15),s.Qb(),s.Rb(16,"span",4),s.tc(17),s.cc(18,"date"),s.Qb(),s.Ob(),s.Pb(19),s.Rb(20,"span",3),s.tc(21),s.Qb(),s.Rb(22,"span",5),s.tc(23),s.Qb(),s.Ob(),s.rc(24,l,5,2,"ng-container",0),s.Pb(25),s.Rb(26,"span",3),s.tc(27),s.Qb(),s.Rb(28,"span",5),s.tc(29),s.Qb(),s.Ob(),s.Pb(30),s.Rb(31,"span",3),s.tc(32),s.Qb(),s.Rb(33,"span",5),s.tc(34),s.Qb(),s.Ob(),s.Pb(35),s.Rb(36,"span",3),s.tc(37),s.Qb(),s.Rb(38,"span",5),s.tc(39),s.Qb(),s.Ob(),s.Pb(40),s.Rb(41,"span",3),s.tc(42),s.Qb(),s.Rb(43,"span",5),s.tc(44),s.Qb(),s.Ob(),s.Qb(),s.Rb(45,"div",6),s.Rb(46,"span",7),s.tc(47),s.Qb(),s.Rb(48,"span",5),s.tc(49),s.Qb(),s.Rb(50,"span",8),s.tc(51),s.Qb(),s.Rb(52,"span",9),s.tc(53),s.Qb(),s.rc(54,h,2,1,"ng-container",10),s.cc(55,"keyvalue"),s.Qb(),s.Qb(),s.Qb(),s.Ob()),2&t){const t=s.bc();s.Bb(1),s.qc("direction",t.langProvider.LangDirection),s.Bb(4),s.uc(t.taskName),s.Bb(4),s.uc(t.langProvider.TaskFirstDate),s.Bb(2),s.uc(s.ec(12,23,t.orderedAggData.firstTaskDate,"dd/MM/yy HH:mm:ss")),s.Bb(4),s.uc(t.langProvider.TaskLastDate),s.Bb(2),s.uc(s.ec(18,26,t.orderedAggData.lastTaskDate,"dd/MM/yy HH:mm:ss")),s.Bb(4),s.uc(t.langProvider.TotalTasks),s.Bb(2),s.uc(t.totalTasks),s.Bb(1),s.hc("ngIf",t.orderedAggData.totalNotParticipated>0),s.Bb(3),s.uc(t.langProvider.OrderedAvgPosition),s.Bb(2),s.uc(t.orderedAggData.avgPosition),s.Bb(3),s.uc(t.langProvider.HighPosition),s.Bb(2),s.uc(t.orderedAggData.highPosition),s.Bb(3),s.uc(t.langProvider.LowPosition),s.Bb(2),s.uc(t.orderedAggData.lowPosition),s.Bb(3),s.uc(t.langProvider.MeanPosition),s.Bb(2),s.uc(t.orderedAggData.meanPosition),s.Bb(3),s.vc("",t.langProvider.Tags,":"),s.Bb(2),s.uc(t.langProvider.BasketValue),s.Bb(2),s.uc(t.langProvider.BasketAvg),s.Bb(2),s.uc(t.langProvider.BasketMax),s.Bb(1),s.hc("ngForOf",s.dc(55,29,t.basketsAggData.basketsTotals))}}let u=(()=>{class t{constructor(t,e,a){this.langProvider=t,this.orderedDelegtor=e,this.basketDelegator=a}ngOnInit(){this.calcHistory()}calcHistory(){return Object(i.a)(this,void 0,void 0,function*(){this.taskName=this.tasks[0].name,this.totalTasks=this.tasks.length;const t=new n.a;t.start(),this.orderedAggData=this.orderedDelegtor.calcCandidateAggDataForTask(this.candidate,this.tasks);const e=yield this.orderedDelegtor.loadTasksBaskets(this.tasks);this.basketsAggData=this.basketDelegator.calcCandidateAggData(this.candidate,this.candidates,e);const a=t.stop();console.log(`OrderedCandidateHistoryAgg ${this.candidate._id} time: ${a}`),this.isInit=!0})}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(o.b),s.Lb(R),s.Lb(d.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-ordered-candidate-history-agg"]],inputs:{tasks:"tasks",candidate:"candidate",candidates:"candidates"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[1,"orderStats"],[1,"col1"],[1,"col2","ltr","ml-auto"],[1,"col2"],[1,"orderBaskets"],[1,"col1","basketsHeader"],[1,"col3"],[1,"col4"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&s.rc(0,g,56,31,"ng-container",0),2&t&&s.hc("ngIf",e.isInit)},directives:[c.m,r.w,r.C,c.l],pipes:[c.e,c.g],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.header[_ngcontent-%COMP%], .row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.orderStats[_ngcontent-%COMP%]{display:grid}.orderBaskets[_ngcontent-%COMP%]{display:grid;margin-top:.2rem}.basketsHeader[_ngcontent-%COMP%]{font-style:italic;font-weight:700}"]}),t})();function k(t,e){if(1&t&&(s.Rb(0,"span"),s.tc(1),s.Qb()),2&t){const t=s.bc(2);s.Bb(1),s.wc("",t.langProvider.Position," : ",t.item.position,"")}}function p(t,e){if(1&t&&(s.Rb(0,"span"),s.tc(1),s.Qb()),2&t){const t=s.bc(2);s.Bb(1),s.uc(t.langProvider.NotParticipate)}}function m(t,e){if(1&t&&(s.Pb(0),s.Rb(1,"span",7),s.tc(2),s.Qb(),s.Rb(3,"span",8),s.tc(4),s.Qb(),s.Ob()),2&t){const t=s.bc().$implicit;s.Bb(2),s.uc(t.key),s.Bb(2),s.uc(t.value.total)}}function v(t,e){if(1&t&&(s.Pb(0),s.rc(1,m,5,2,"ng-container",0),s.Ob()),2&t){const t=e.$implicit;s.Bb(1),s.hc("ngIf",t.value.total>0)}}function f(t,e){if(1&t&&(s.Rb(0,"div",5),s.Rb(1,"div",6),s.Rb(2,"span",7),s.tc(3),s.Qb(),s.Rb(4,"span",8),s.tc(5),s.Qb(),s.rc(6,v,2,1,"ng-container",9),s.cc(7,"keyvalue"),s.Qb(),s.Qb()),2&t){const t=s.bc(2);s.Bb(3),s.uc(t.langProvider.Tags),s.Bb(2),s.uc(t.langProvider.Total),s.Bb(1),s.hc("ngForOf",s.dc(7,3,t.item.basketItems))}}function y(t,e){if(1&t&&(s.Pb(0),s.Rb(1,"ion-item"),s.Rb(2,"ion-label"),s.Rb(3,"div",1),s.Rb(4,"span"),s.tc(5),s.Qb(),s.Rb(6,"span",2),s.tc(7),s.cc(8,"date"),s.Qb(),s.Qb(),s.Rb(9,"div",3),s.Rb(10,"span"),s.tc(11),s.Qb(),s.rc(12,k,2,2,"span",0),s.rc(13,p,2,1,"span",0),s.Qb(),s.rc(14,f,8,5,"div",4),s.Qb(),s.Qb(),s.Ob()),2&t){const t=s.bc();s.Bb(1),s.qc("direction",t.langProvider.LangDirection),s.Bb(4),s.uc(t.task.name),s.Bb(2),s.uc(s.ec(8,11,t.task.date,"dd/MM/yy HH:mm:ss")),s.Bb(2),s.qc("direction",t.langProvider.LangDirection),s.Bb(2),s.wc("",t.langProvider.TotalParticipants," : ",t.item.total,""),s.Bb(1),s.hc("ngIf",t.item.position>0),s.Bb(1),s.hc("ngIf",0===t.item.position),s.Bb(1),s.hc("ngIf",t.item.basketItems)}}let C=(()=>{class t{constructor(t,e,a){this.taskDelegator=t,this.basketsDelegator=e,this.langProvider=a}ngOnInit(){return Object(i.a)(this,void 0,void 0,function*(){this.calcHistory()})}calcHistory(){return Object(i.a)(this,void 0,void 0,function*(){this.taskSaveData=yield this.taskDelegator.loadTask(this.task._id),this.item={total:this.task.orderedCandidates.length,position:this.task.orderedCandidates.findIndex(t=>t===this.candidate._id)+1,date:new Date(this.task.date)};const t=this.basketsDelegator.GetBasketsForCandidate(this.candidate._id,this.taskSaveData.basketsSaveData.main);Object.keys(t).length>0&&(this.item.basketItems=t),this.isInit=!0})}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(R),s.Lb(d.a),s.Lb(o.b))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-ordered-candidate-history"]],inputs:{task:"task",candidate:"candidate"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[2,"direction","ltr"],[1,"order"],["class","orderBaskets",4,"ngIf"],[1,"orderBaskets"],[1,"baskets"],[1,"col1"],[1,"col2"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&s.rc(0,y,15,14,"ng-container",0),2&t&&s.hc("ngIf",e.isInit)},directives:[c.m,r.w,r.C,c.l],pipes:[c.e,c.g],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.header[_ngcontent-%COMP%], .order[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.order[_ngcontent-%COMP%], .orderBaskets[_ngcontent-%COMP%]{margin-top:.2rem}.basketsHeader[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.baskets[_ngcontent-%COMP%]{display:grid}"]}),t})();function D(t,e){if(1&t&&(s.Pb(0),s.Pb(1),s.Rb(2,"span",1),s.tc(3),s.Qb(),s.Rb(4,"span",2),s.tc(5),s.Qb(),s.Rb(6,"span",3),s.tc(7),s.Qb(),s.Rb(8,"span",4),s.tc(9),s.Qb(),s.Rb(10,"span",5),s.tc(11),s.Qb(),s.Rb(12,"span",6),s.tc(13),s.Qb(),s.Ob(),s.Ob()),2&t){const t=e.$implicit;s.Bb(3),s.uc(t.candidate),s.Bb(2),s.uc(t.avg),s.Bb(2),s.uc(t.total),s.Bb(2),s.uc(t.max),s.Bb(2),s.uc(t.low),s.Bb(2),s.uc(t.mean)}}let O=(()=>{class t{constructor(t,e){this.taskDelegator=t,this.langProvider=e}ngOnInit(){this.calcHistory()}calcHistory(){this.items=this.taskDelegator.calcAllCandidatesAggDataForTask(this.candidates,this.tasksGroup)}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(R),s.Lb(o.b))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-ordered-history-agg"]],inputs:{tasksGroup:"tasksGroup",candidates:"candidates"},decls:14,vars:3,consts:[[1,"ordered-task-grouped"],[1,"col1"],[1,"col2"],[1,"col3"],[1,"col4"],[1,"col5"],[1,"col6"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(s.Rb(0,"div",0),s.Rb(1,"span",1),s.tc(2,"\u05de\u05e1\u05e4\u05e8"),s.Qb(),s.Rb(3,"span",2),s.tc(4,"\u05de\u05de\u05d5\u05e6\u05e2"),s.Qb(),s.Rb(5,"span",3),s.tc(6,"\u05de\u05e7\u05e6\u05d9\u05dd"),s.Qb(),s.Rb(7,"span",4),s.tc(8,"\u05de\u05e7\u05e1"),s.Qb(),s.Rb(9,"span",5),s.tc(10,"\u05de\u05d9\u05e0"),s.Qb(),s.Rb(11,"span",6),s.tc(12,'\u05e1"\u05ea'),s.Qb(),s.rc(13,D,14,6,"ng-container",7),s.Qb()),2&t&&(s.qc("direction",e.langProvider.LangDirection),s.Bb(13),s.hc("ngForOf",e.items))},directives:[c.l],styles:[".ordered-task-grouped[_ngcontent-%COMP%]{display:grid}"]}),t})(),P=(()=>{class t{constructor(t){this.langProvider=t}ngOnInit(){this.calcHistory()}calcHistory(){this.totalParticipated=this.task.orderedCandidates.length,this.totalCandidates=this.candidates.filter(t=>t.isActive).length;const t=this.totalParticipated/this.totalCandidates;this.completedStatus=t>=1?"full":t>=.5?"half":"none"}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(o.b))},t.\u0275cmp=s.Fb({type:t,selectors:[["app-ordered-history"]],inputs:{task:"task",candidates:"candidates"},decls:5,vars:11,consts:[[1,"container"]],template:function(t,e){1&t&&(s.Rb(0,"div",0),s.Rb(1,"span"),s.tc(2),s.Qb(),s.Rb(3,"span"),s.tc(4),s.Qb(),s.Qb()),2&t&&(s.qc("direction",e.langProvider.LangDirection),s.Db("completed","full"===e.completedStatus)("halfCompleted","half"===e.completedStatus)("notCompleted","none"===e.completedStatus),s.Bb(2),s.uc(e.langProvider.TotalParticipants),s.Bb(2),s.wc("",e.totalCandidates," / ",e.totalParticipated,""))},styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.completed[_ngcontent-%COMP%]{color:green}.halfCompleted[_ngcontent-%COMP%]{color:orange}.notCompleted[_ngcontent-%COMP%]{color:red}"]}),t})();var B=a("2lKs"),I=a("nbnm"),w=a("ufmx"),S=a("h7jJ");let R=(()=>{class t{constructor(t,e,a){this.entityNamer=t,this.candidatesDelegator=e,this.dataProvider=a}getTaskConfig(t){throw new Error("Method not implemented.")}getTaskName(){throw new Error("Method not implemented.")}exportCopy(t,e){return Object(i.a)(this,void 0,void 0,function*(){const e=yield this.loadTask(t),a=this.candidatesDelegator.getCandidatesByIdsMap(e.basketsSaveData.main.candidates);e.main.exportOrder=[];let i=1;for(const t of e.main.orderedCandidates){const n=a[t],s={candidateNum:n.number,candidateGroup:n.group,order:i++};e.main.exportOrder.push(s)}delete e.main.orderedCandidates,delete e.main.childIds;const n=this.candidatesDelegator.getCandidatesByIdsMap(e.basketsSaveData.main.candidates);for(const t in e.basketsSaveData.main.baskets)if(Object.prototype.hasOwnProperty.call(e.basketsSaveData.main.baskets,t)){const a=e.basketsSaveData.main.baskets[t];delete a.preview;for(const t of a.all){const e=n[t.candidate];t.exportData={candidateNum:e.number,candidateGroup:e.group}}}return e})}saveTask(t,e){var a,n,s,o;return Object(i.a)(this,void 0,void 0,function*(){const e=[];return t.main._id=null!==(a=t.main._id)&&void 0!==a?a:this.entityNamer.taskPrefixWithUniqueIdAnd(t.main.type,t.main.taskId),t.main._rev=t.main._rev,t.main.date=null!==(n=t.main.date)&&void 0!==n?n:new Date,t.main.updateDate=new Date,e.push(t.main),t.basketsSaveData.main._id=null!==(s=t.basketsSaveData.main._id)&&void 0!==s?s:`${t.main._id.replace("main","baskets")}`,t.basketsSaveData.main._rev=t.basketsSaveData.main._rev,t.basketsSaveData.main.date=null!==(o=t.basketsSaveData.main.date)&&void 0!==o?o:new Date,t.basketsSaveData.main.updateDate=new Date,t.main.childIds.baskets=[t.basketsSaveData.main._id],e.push(t.basketsSaveData.main),yield this.dataProvider.saveEntities(e),t})}loadTask(t){return Object(i.a)(this,void 0,void 0,function*(){const e=yield this.dataProvider.loadTask(t),a=e._id.replace("main","baskets");return{main:e,basketsSaveData:{main:(yield this.dataProvider.loadEntitiesByPrefix(a))[0]}}})}deleteTask(t){return Object(i.a)(this,void 0,void 0,function*(){const e=[t],a=t._id.replace("main","baskets");(yield this.dataProvider.loadEntitiesByPrefix(a,{includeDocs:!1})).forEach(t=>e.push(t)),yield this.dataProvider.deleteEntities(e)})}getTaskHistory(){throw new Error("Method not implemented.")}getComponentRoute(){return"ordered"}getComponent(){return B.a}getHistoryComponent(){return P}getHistoryAggComponent(){return O}getCandidateHistoryComponent(){return C}getCandidateAggregateComponent(){return u}getTasksForCandidates(t){throw new Error("Method not implemented.")}checkTaskEmpty(t,e){var a;const i=(null===(a=t.main.orderedCandidates)||void 0===a?void 0:a.length)>0,n=Object.keys(t.basketsSaveData.main.baskets).some(e=>{var a,i;return null===(i=null===(a=t.basketsSaveData.main.baskets[e])||void 0===a?void 0:a.all)||void 0===i?void 0:i.some(t=>t.total>0)});return!(t.main._id||i||n)}loadTasksBaskets(t){return Object(i.a)(this,void 0,void 0,function*(){const e=t.reduce((t,e,a)=>(t.push(...e.childIds.baskets),t),[]);return yield this.dataProvider.loadEntitiesByIds(e)})}calcCandidateAggDataForAll(t,e){const a=e.reduce((t,e)=>(t[e.taskId]||(t[e.taskId]=[]),t[e.taskId].push(e),t),{}),i=[];for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n)){const a=this.calcCandidateAggDataForTask(t,e);i.push(a)}return i}calcCandidateAggDataForTask(t,e){const a=[],i=e.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime()),n=i[0].date,s=i[e.length-1].date;for(const k of e){const e={total:k.orderedCandidates.length,position:k.orderedCandidates.findIndex(e=>e===t._id)+1,date:k.date};a.push(e)}const o=a.filter(t=>0===t.position).length,d=a.length-o,c=(a.filter(t=>t.position>-1).map(t=>t.position).reduce((t,e)=>t+e)/d).toFixed(1),r=a.map(t=>t.position).filter(t=>t>0),l=r.reduce((t,e)=>e<=t?e:t),b=r.reduce((t,e)=>e>=t?e:t),h=r.map(t=>Math.pow(t-Number(c),2)).reduce((t,e)=>t+e)/e.length,g=Math.sqrt(h),u=Number(g.toFixed(1));return{firstTaskDate:n,lastTaskDate:s,totalParticipated:d,totalNotParticipated:o,avgPosition:c,highPosition:l,lowPosition:b,meanPosition:u}}calcAllCandidatesAggDataForTask(t,e){const a=this.candidatesDelegator.getCandidatesByIdsMap(t.map(t=>t._id)),i=e.tasks.reduce((t,e)=>{for(let a=0;a<e.orderedCandidates.length;a++){const i=e.orderedCandidates[a];let n=t[i];n||(n=[],t[i]=n),n.push(a+1)}return t},{});return Object.keys(i).map(t=>{const e=a[t].number,n=a[t].isActive,s=i[t],o=s.length,d=Number((s.reduce((t,e)=>t+e)/o).toFixed(1)),c=s.reduce((t,e)=>e<=t?e:t),r=s.reduce((t,e)=>e>=t?e:t),l=s.map(t=>Math.pow(t-d,2)).reduce((t,e)=>t+e)/o,b=Math.sqrt(l),h=Number(b.toFixed(1));return{candidate:e,total:o,avg:d,max:c,low:r,mean:h,isActive:n}}).filter(t=>t.isActive).sort((t,e)=>{let a=0;return t.total>e.total?a=-1:e.total>t.total||t.avg>e.avg?a=1:e.avg>t.avg&&(a=-1),a})}}return t.\u0275fac=function(e){return new(e||t)(s.Vb(I.a),s.Vb(w.a),s.Vb(S.a))},t.\u0275prov=s.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);