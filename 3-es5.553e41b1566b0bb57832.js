!function(){function t(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){c=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw s}}}}function a(t,e){if(t){if("string"==typeof t)return n(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,a){return e&&r(t.prototype,e),a&&r(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[3,25],{"2lKs":function(t,a,n){"use strict";n.d(a,"a",function(){return M});var r=n("mrSG"),o=n("fXoL"),c=n("5+WD"),d=n("Mxx3"),u=n("pQKU"),l=n("AytR"),b=n("kLqA"),h=n("CIRo"),v=n("tyNb"),f=n("3LWr"),g=n("zrcv"),k=n("L5fO"),p=n("TEn/"),m=n("ufmx"),y=n("NrBX"),C=n("TtBN"),D=n("3Pt+"),w=n("ofXK"),R=n("OZ4V"),O=n("g1yl"),x=["candidatesOrder"];function P(t,e){if(1&t&&o.Mb(0,"app-candidate-avatar",30),2&t){var a=o.bc().$implicit;o.hc("candidate",a)}}function I(t,e){if(1&t&&o.Mb(0,"app-candidate-avatar",30),2&t){var a=o.bc().$implicit;o.hc("candidate",a)}}function S(t,e){1&t&&o.Mb(0,"span",31)}function B(t,e){if(1&t&&(o.Rb(0,"div",22),o.Rb(1,"ion-item",23),o.Rb(2,"div",24),o.Rb(3,"span",25),o.tc(4),o.Qb(),o.Mb(5,"app-candidate-avatar",26),o.Qb(),o.rc(6,P,1,1,"app-candidate-avatar",27),o.rc(7,I,1,1,"app-candidate-avatar",28),o.Qb(),o.rc(8,S,1,0,"span",29),o.Qb()),2&t){var a=e.$implicit,n=e.index,i=o.bc(2);o.Bb(1),o.ic("id","order_",a._id,""),o.hc("cdkDragStartDelay",i.dragDelay),o.Bb(3),o.vc("",n+1,"."),o.Bb(1),o.hc("candidate",a),o.Bb(3),o.hc("ngIf",i.store.isIos)}}function T(t,e){if(1&t){var a=o.Sb();o.Rb(0,"div",16),o.Rb(1,"app-candidate-selection",17),o.Zb("candidateSelected",function(t){return o.mc(a),o.bc().selectCandidate(t)})("cdkDropListDropped",function(t){return o.mc(a),o.bc().dropCandidates(t)}),o.Qb(),o.Rb(2,"ion-chip",18),o.Rb(3,"ion-list",19,20),o.Zb("cdkDropListDropped",function(t){return o.mc(a),o.bc().dropCandidatesOrder(t)}),o.rc(5,B,9,5,"div",21),o.Qb(),o.Qb(),o.Qb()}if(2&t){var n=o.bc();o.hc("hidden","ordered"!==n.segment),o.Bb(1),o.hc("candidates",n.candidates)("selectedCandidates",n.selectedCandidates)("cdkDropListData",n.candidates),o.Bb(2),o.hc("cdkDropListData",n.orderedCandidates),o.Bb(2),o.hc("ngForOf",n.orderedCandidates)("ngForTrackBy",n.trackByFn)}}function Q(t,e){if(1&t){var a=o.Sb();o.Rb(0,"ion-fab-button",32),o.Zb("click",function(){return o.mc(a),o.bc().saveAndNew()}),o.Mb(1,"ion-icon",33),o.Qb()}}var M=function(){var t=function(){function t(e,a,n,r,s,o,c,u,l,b){i(this,t),this.router=e,this.route=a,this.store=n,this.msgService=r,this.langProvider=s,this.popoverController=o,this.candidatesDelegator=c,this.taskDelegator=u,this.basketDelegator=l,this.orderedDelegator=b,this.orderedCandidates=[],this.selectedCandidates={},this.dragDelay=d.a.DragDelay,this.segment="ordered",this.integratedBaskets={parentId:null,parentTaskId:null,parentTaskType:null}}return s(t,[{key:"ngOnInit",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initTask();case 2:return this.taskSavedData=t.sent,t.next=5,this.loadTask();case 5:this.taskSavedData=t.sent,this.isTaskInit=!0;case 7:case"end":return t.stop()}},t,this)}))}},{key:"initTask",value:function(){var t;return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=null!==(t=this.route.snapshot.paramMap.get(d.a.TaskDescId))&&void 0!==t?t:"t13",e.next=3,this.candidatesDelegator.getCandidatesCopy(!0);case 3:return this.candidates=e.sent,e.next=6,this.taskDelegator.getTaskDesk(a);case 6:return this.taskDesc=e.sent,e.next=9,this.taskDelegator.getTasksConfig(a);case 9:return this.taskConfig=e.sent,n={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,orderedCandidates:[],candidates:this.candidates.map(function(t){return t._id}),childIds:{}},basketsSaveData:null},e.abrupt("return",(this.integratedBaskets={parentId:null,parentTaskId:this.taskDesc.id,parentTaskType:this.taskDesc.type},this.isSaveAndNew=!this.taskConfig.maxItems||this.taskConfig.maxItems>1,n));case 12:case"end":return e.stop()}},e,this)}))}},{key:"ionViewWillLeave",value:function(){var t;return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.taskSavedData.main.orderedCandidates=this.orderedCandidates.map(function(t){return t._id}),this.taskSavedData.basketsSaveData=null===(t=this.basketPage)||void 0===t?void 0:t.taskSavedData,!this.orderedDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)){e.next=6;break}this.msgService.showToast(this.langProvider.TaskEmptyDismissed,l.a.taskSavedToastInterval),e.next=13;break;case 6:return e.next=8,this.saveTask();case 8:return this.taskSavedData=e.sent,e.next=11,this.basketPage.ionViewWillLeave();case 11:this.msgService.showToast(this.langProvider.TaskSaved,l.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date);case 13:case"end":return e.stop()}},e,this)}))}},{key:"saveTask",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.orderedDelegator.saveTask(this.taskSavedData,this.taskConfig);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"loadTask",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var a,n,i,r,s,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.route.snapshot.paramMap.get(d.a.SavedTaskId),n=this.taskSavedData,!a){t.next=13;break}return this.isTaskUpdate=!0,t.next=6,this.orderedDelegator.loadTask(a);case 6:return n=t.sent,t.next=9,this.candidatesDelegator.getCandidatesByIds(n.main.candidates);case 9:this.candidates=t.sent,i=e(n.main.orderedCandidates);try{for(s=function(){var t=r.value,e=o.candidates.find(function(e){return e._id===t});e&&o.selectCandidate(e)},i.s();!(r=i.n()).done;)s()}catch(c){i.e(c)}finally{i.f()}this.basketPage.loadTaskIntegrated(n.basketsSaveData);case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}},t,this)}))}},{key:"saveAndNew",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.msgService.showAreYouSure(this.langProvider.TaskSaveAndNew);case 2:if(!t.sent){t.next=5;break}(e={})[d.a.TaskDescId]=this.taskDesc.id,this.router.navigate(["tabs/task-catalog",e],{replaceUrl:!0,skipLocationChange:!0});case 5:case"end":return t.stop()}},t,this)}))}},{key:"dropCandidates",value:function(t){if(t.previousContainer===t.container);else{var e=this.orderedCandidates.splice(t.previousIndex,1);this.candidates=this.candidates.sort(function(t,e){return t.number-e.number}),this.selectedCandidates[e[0]._id]=!1}}},{key:"dropCandidatesOrder",value:function(t){t.previousContainer===t.container?Object(c.g)(t.container.data,t.previousIndex,t.currentIndex):(Object(c.h)(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex),this.selectedCandidates[t.previousContainer.data[t.previousIndex]._id]=!0)}},{key:"selectCandidate",value:function(t){var e,a=this;this.selectedCandidates[t._id]||(this.selectedCandidates[t._id]=!0,this.orderedCandidates.push(t),(null===(e=this.candidatesOrder)||void 0===e?void 0:e.nativeElement)&&setTimeout(function(){var t=a.candidatesOrder.nativeElement.children;t[t.length-1].scrollIntoView({behaviour:"smooth",block:"end"})},50))}},{key:"changeOrder",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.msgService.showAreYouSure(this.langProvider.OrderedReversedAreYouSure);case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}this.orderedCandidates.reverse(),this.msgService.showToast(this.langProvider.OrderedReversed,2e3);case 5:case"end":return t.stop()}},t,this)}))}},{key:"createComment",value:function(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:b.Guid.raw()}],{skipLocationChange:!0})}},{key:"trackByFn",value:function(t,e){return e?e._id:t}}]),t}();return t.\u0275fac=function(e){return new(e||t)(o.Lb(v.f),o.Lb(v.a),o.Lb(f.a),o.Lb(g.a),o.Lb(k.b),o.Lb(p.ib),o.Lb(m.a),o.Lb(y.a),o.Lb(u.a),o.Lb(C.a))},t.\u0275cmp=o.Fb({type:t,selectors:[["app-ordered2"]],viewQuery:function(t,e){var a;(1&t&&(o.zc(h.a,3),o.zc(x,1,o.m)),2&t)&&(o.kc(a=o.ac())&&(e.basketPage=a.first),o.kc(a=o.ac())&&(e.candidatesOrder=a.first))},features:[o.Ab([u.a])],decls:24,vars:8,consts:[["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],[3,"ngModel","ngModelChange"],["value","ordered"],["value","baskets"],[1,"content"],[1,"container",3,"hidden","integrated"],["class","container","cdkDropListGroup","",3,"hidden",4,"ngIf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],[2,"display","flex"],["color","primary",3,"click"],["name","chatbox-ellipses"],["color","secondary",2,"margin-left","0.2rem",3,"click"],["name","repeat"],["style","margin-left: 0.2rem;","color","tertiary",3,"click",4,"ngIf"],["cdkDropListGroup","",1,"container",3,"hidden"],["id","candidates","cdkDropList","",1,"candidatesSelection",3,"candidates","selectedCandidates","cdkDropListData","candidateSelected","cdkDropListDropped"],[1,"candidatesOrder"],["lines","none","id","candidatesOrder","cdkDropList","",1,"candidates",3,"cdkDropListData","cdkDropListDropped"],["candidatesOrder",""],["class","iosDndFixItem",4,"ngFor","ngForOf","ngForTrackBy"],[1,"iosDndFixItem"],["cdkDrag","",1,"orderItem",3,"cdkDragStartDelay","id"],[1,"avatarOrderContainer"],[1,"avatarOrder"],[1,"avatar","avatarMargin",3,"candidate"],["class","avatar",3,"candidate",4,"cdkDragPreview"],["class","avatar",3,"candidate",4,"cdkDragPlaceholder"],["class","iosDndFixGap",4,"ngIf"],[1,"avatar",3,"candidate"],[1,"iosDndFixGap"],["color","tertiary",2,"margin-left","0.2rem",3,"click"],["name","bag-check"]],template:function(t,e){1&t&&(o.Rb(0,"ion-header"),o.Rb(1,"ion-toolbar"),o.Rb(2,"ion-buttons",0),o.Mb(3,"ion-menu-button"),o.Qb(),o.Rb(4,"ion-title"),o.tc(5),o.Qb(),o.Rb(6,"ion-buttons",1),o.Mb(7,"ion-back-button",2),o.Qb(),o.Qb(),o.Rb(8,"ion-toolbar"),o.Rb(9,"ion-segment",3),o.Zb("ngModelChange",function(t){return e.segment=t}),o.Rb(10,"ion-segment-button",4),o.tc(11),o.Qb(),o.Rb(12,"ion-segment-button",5),o.tc(13),o.Qb(),o.Qb(),o.Qb(),o.Qb(),o.Rb(14,"ion-content",6),o.Mb(15,"app-baskets2",7),o.rc(16,T,6,7,"div",8),o.Rb(17,"ion-fab",9),o.Rb(18,"div",10),o.Rb(19,"ion-fab-button",11),o.Zb("click",function(){return e.createComment()}),o.Mb(20,"ion-icon",12),o.Qb(),o.Rb(21,"ion-fab-button",13),o.Zb("click",function(){return e.changeOrder()}),o.Mb(22,"ion-icon",14),o.Qb(),o.rc(23,Q,2,0,"ion-fab-button",15),o.Qb(),o.Qb(),o.Qb()),2&t&&(o.Bb(5),o.uc(null==e.taskDesc?null:e.taskDesc.description),o.Bb(4),o.hc("ngModel",e.segment),o.Bb(2),o.vc(" ",e.langProvider.Ordered," "),o.Bb(2),o.vc(" ",e.langProvider.Baskets," "),o.Bb(2),o.hc("hidden","baskets"!==e.segment)("integrated",e.integratedBaskets),o.Bb(1),o.hc("ngIf",e.isTaskInit),o.Bb(7),o.hc("ngIf",e.isSaveAndNew&&e.orderedCandidates.length>0))},directives:[p.s,p.Z,p.k,p.F,p.X,p.g,p.h,p.O,p.kb,D.e,D.h,p.P,p.n,h.a,w.m,p.o,c.a,p.p,p.t,c.e,R.a,c.d,p.l,p.D,w.l,p.w,O.a,c.c,c.b],styles:[".content[_ngcontent-%COMP%]{height:100%;width:100%;display:flex}ion-chip[_ngcontent-%COMP%]{padding:0}.container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{height:100%;width:100%;overflow:scroll;min-width:var(--avatar-empty-width);background:transparent}.avatarContainer[_ngcontent-%COMP%]{--background:transparent}.candidatesSelection[_ngcontent-%COMP%]{height:80%;--background:rgba(160,165,177,.541)}.candidatesOrder[_ngcontent-%COMP%]{height:100%;min-width:30%;--background:rgba(157,186,250,.541)}.avatarOrderContainer[_ngcontent-%COMP%]{display:flex;align-items:center}.avatarOrder[_ngcontent-%COMP%]{margin-right:.2rem}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.reverseOrder[_ngcontent-%COMP%]{margin-top:20%}.orderItem[_ngcontent-%COMP%]{--background:transparent;--padding-start:0.2rem}"]}),t}()},CIRo:function(t,a,n){"use strict";n.d(a,"a",function(){return Q});var r=n("mrSG"),o=n("kLqA"),c=n("Mxx3"),d=n("AytR"),u=n("fXoL"),l=n("TEn/"),b=n("L5fO"),h=n("ufmx"),v=n("zrcv"),f=n("ofXK"),g=n("g1yl");function k(t,e){if(1&t){var a=u.Sb();u.Rb(0,"app-candidate-avatar",13),u.Zb("click",function(){u.mc(a);var t=e.$implicit,n=u.bc();return n.selectRemoveAction(n.basketItemsEdit[t._id])}),u.Qb()}if(2&t){var n=e.$implicit,i=u.bc();u.hc("candidate",n)("total",i.basketItemsEdit[n._id].total)("isSelected",i.dirtyItems[n._id])("isShowTotal",!0)("selectedStyle","redBlue")}}var p,m=((p=function(){function t(e,a,n,r,s){i(this,t),this.modalCtrl=e,this.langProvider=a,this.candidatesDelegator=n,this.msgService=r,this.navCtrl=s,this.dirtyItems={},this.mode="add"}return s(t,[{key:"ngOnInit",value:function(){this.basketItemsOriginal=this.basketItems.reduce(function(t,e){return t[e.candidate]=e,t},{}),this.candidates=this.candidatesDelegator.getCandidatesByIds(Object.keys(this.basketItemsOriginal)),this.candidates.sort(function(t,e){return t.number-e.number}),this.basketItemsEdit=JSON.parse(JSON.stringify(this.basketItemsOriginal)),this.selectRemoveAction=this.selectItem}},{key:"trackByFn",value:function(t,e){return e?e._id:t}},{key:"selectItem",value:function(t){!this.taskConfig.isCandidateMultiBasket&&t.total>0?this.msgService.showToast(this.langProvider.CandidateAlreadyExistInBasket,2e3,"toastWarn"):this.taskConfig.maxTotalPerSingleEdit&&t.total-this.basketItemsOriginal[t.candidate].total>=this.taskConfig.maxTotalPerSingleEdit?this.msgService.showToast(this.langProvider.MaxTotalsPerSingleEditBasket,2e3,"toastWarn"):this.basket.maxCandidatesAllowed&&this.basketItems.filter(function(t){return t.total>0}).length>this.basket.maxCandidatesAllowed?this.msgService.showToast(this.langProvider.MaxCandidatesForBasket,2e3,"toastWarn"):(t.total++,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total)}},{key:"removeItem",value:function(t){t.total>0&&t.total--,this.dirtyItems[t.candidate]=t.total!==this.basketItemsOriginal[t.candidate].total}},{key:"changeAddMode",value:function(){this.mode="add",this.selectRemoveAction=this.selectItem}},{key:"changeRemoveMode",value:function(){this.mode="remove",this.selectRemoveAction=this.removeItem}},{key:"activate",value:function(){var t=this,e=Object.keys(this.dirtyItems).filter(function(e){return t.dirtyItems[e]}).map(function(e){return t.basketItemsEdit[e]});this.modalCtrl.dismiss(e)}},{key:"back",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(Object.keys(this.dirtyItems).filter(function(t){return e.dirtyItems[t]}).length>0)){t.next=8;break}return t.next=3,this.msgService.showAreYouSure(this.langProvider.DataNotSaved);case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.modalCtrl.dismiss();case 6:t.next=9;break;case 8:this.modalCtrl.dismiss();case 9:case"end":return t.stop()}},t,this)}))}}]),t}()).\u0275fac=function(t){return new(t||p)(u.Lb(l.eb),u.Lb(b.b),u.Lb(h.a),u.Lb(v.a),u.Lb(l.fb))},p.\u0275cmp=u.Fb({type:p,selectors:[["app-basketkeyboard"]],inputs:{basketItems:"basketItems",taskConfig:"taskConfig",basket:"basket"},decls:19,vars:5,consts:[["translucent","true"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"options"],[3,"color","click"],["name","add"],["name","remove"],[1,"container"],[1,"candiContainer"],["slot","start","class","candi",3,"candidate","total","isSelected","isShowTotal","selectedStyle","click",4,"ngFor","ngForOf","ngForTrackBy"],["color","secondary",1,"activate",3,"click"],["name","checkmark"],["slot","start",1,"candi",3,"candidate","total","isSelected","isShowTotal","selectedStyle","click"]],template:function(t,e){1&t&&(u.Rb(0,"ion-header",0),u.Rb(1,"ion-toolbar"),u.Rb(2,"ion-title"),u.tc(3),u.Qb(),u.Rb(4,"ion-buttons",1),u.Rb(5,"ion-button",2),u.Zb("click",function(t){return e.back(t)}),u.Mb(6,"ion-icon",3),u.Qb(),u.Qb(),u.Qb(),u.Rb(7,"ion-toolbar"),u.Rb(8,"div",4),u.Rb(9,"ion-fab-button",5),u.Zb("click",function(){return e.changeAddMode()}),u.Mb(10,"ion-icon",6),u.Qb(),u.Rb(11,"ion-fab-button",5),u.Zb("click",function(){return e.changeRemoveMode()}),u.Mb(12,"ion-icon",7),u.Qb(),u.Qb(),u.Qb(),u.Qb(),u.Rb(13,"ion-content"),u.Rb(14,"div",8),u.Rb(15,"div",9),u.rc(16,k,1,5,"app-candidate-avatar",10),u.Qb(),u.Rb(17,"ion-fab-button",11),u.Zb("click",function(){return e.activate()}),u.Mb(18,"ion-icon",12),u.Qb(),u.Qb(),u.Qb()),2&t&&(u.Bb(3),u.vc(" ",e.basket.name," "),u.Bb(6),u.hc("color","add"===e.mode?"primary":"light"),u.Bb(2),u.hc("color","remove"===e.mode?"danger":"light"),u.Bb(5),u.hc("ngForOf",e.candidates)("ngForTrackBy",e.trackByFn))},directives:[l.s,l.Z,l.X,l.k,l.j,l.t,l.p,l.n,f.l,g.a],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candiContainer[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;overflow:scroll}.options[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{margin:.5rem auto}"],changeDetection:0}),p),y=n("tyNb"),C=n("3LWr"),D=n("NrBX"),w=n("pQKU");function R(t,e){if(1&t&&(u.Rb(0,"ion-header"),u.Rb(1,"ion-toolbar"),u.Rb(2,"ion-buttons",1),u.Mb(3,"ion-menu-button"),u.Qb(),u.Rb(4,"ion-buttons",2),u.Mb(5,"ion-back-button",3),u.Qb(),u.Rb(6,"ion-title"),u.tc(7),u.Qb(),u.Qb(),u.Qb()),2&t){var a=u.bc();u.Bb(7),u.uc(null==a.taskDesc?null:a.taskDesc.description)}}function O(t,e){if(1&t&&u.Mb(0,"app-candidate-avatar",12),2&t){var a=u.bc().$implicit,n=u.bc(3);u.hc("candidateId",a.candidate)("total",a.total)("isShowTotal",n.taskConfig.isCandidateMultiBasket)}}function x(t,e){if(1&t&&(u.Rb(0,"div"),u.rc(1,O,1,3,"app-candidate-avatar",11),u.Qb()),2&t){var a=e.$implicit;u.Bb(1),u.hc("ngIf",a.total>0)}}function P(t,e){if(1&t){var a=u.Sb();u.Rb(0,"ion-chip",7),u.Zb("click",function(){u.mc(a);var t=e.$implicit;return u.bc(2).selectBasket(t)}),u.Rb(1,"ion-label",8),u.tc(2),u.Qb(),u.Rb(3,"div",9),u.rc(4,x,2,1,"div",10),u.Qb(),u.Qb()}if(2&t){var n=e.$implicit,i=u.bc(2);u.qc("direction",i.taskDesc.langDir),u.Db("selectedBasket",n.name===i.selectedBasket),u.Bb(2),u.uc(n.name),u.Bb(2),u.hc("ngForOf",i.taskSavedData.main.baskets[n.name].all)}}function I(t,e){if(1&t){var a=u.Sb();u.Rb(0,"ion-fab-button",18),u.Zb("click",function(){return u.mc(a),u.bc(3).saveAndNew()}),u.Mb(1,"ion-icon",19),u.Qb()}}function S(t,e){if(1&t){var a=u.Sb();u.Rb(0,"ion-fab",13),u.Rb(1,"div",14),u.Rb(2,"ion-fab-button",15),u.Zb("click",function(){return u.mc(a),u.bc(2).createComment()}),u.Mb(3,"ion-icon",16),u.Qb(),u.rc(4,I,2,0,"ion-fab-button",17),u.Qb(),u.Qb()}if(2&t){var n=u.bc(2);u.Bb(4),u.hc("ngIf",n.isSaveAndNew&&n.checkIfBasketsEmpty())}}function B(t,e){if(1&t&&(u.Rb(0,"ion-content"),u.Rb(1,"div",4),u.rc(2,P,5,6,"ion-chip",5),u.Qb(),u.rc(3,S,5,1,"ion-fab",6),u.Qb()),2&t){var a=u.bc();u.Bb(2),u.hc("ngForOf",a.taskConfig.baskets),u.Bb(1),u.hc("ngIf",!a.integrated)}}var T,Q=((T=function(){function t(e,a,n,r,s,o,c,u,l,b){i(this,t),this.router=e,this.route=a,this.store=n,this.modalCtrl=r,this.msgService=s,this.langProvider=o,this.popoverController=c,this.candidatesDelegator=u,this.taskDelegator=l,this.basketDelegator=b,this.previewSize=d.a.basketPreviewSize}return s(t,[{key:"ngOnInit",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initTask();case 2:if(this.taskSavedData=t.sent,t.t0=this.integrated,t.t0){t.next=8;break}return t.next=7,this.loadTask();case 7:this.taskSavedData=t.sent;case 8:this.isTaskInit=!0;case 9:case"end":return t.stop()}},t,this)}))}},{key:"ionViewWillLeave",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.basketDelegator.checkTaskEmpty(this.taskSavedData,this.taskConfig)){t.next=4;break}this.msgService.showToast(this.langProvider.TaskEmptyDismissed,d.a.taskSavedToastInterval),t.next=9;break;case 4:return t.next=6,this.saveTask();case 6:this.taskSavedData=t.sent,this.msgService.showToast(this.langProvider.TaskSaved,d.a.taskSavedToastInterval),this.store.lastTasksChangeTime.next(new Date);case 9:case"end":return t.stop()}},t,this)}))}},{key:"initTask",value:function(){var t,a,n;return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var r,s,o,d,u;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=null!==(n=null!==(a=null===(t=this.integrated)||void 0===t?void 0:t.parentTaskId)&&void 0!==a?a:this.route.snapshot.paramMap.get(c.a.TaskDescId))&&void 0!==n?n:"t13",i.next=3,this.candidatesDelegator.getCandidatesCopy(!0);case 3:return this.candidates=i.sent,i.next=6,this.taskDelegator.getTaskDesk(r);case 6:return this.taskDesc=i.sent,i.next=9,this.taskDelegator.getTasksConfig(r);case 9:this.taskConfig=i.sent,s={main:{taskId:this.taskDesc.id,type:this.taskDesc.type,name:this.taskDesc.description,candidates:this.candidates.map(function(t){return t._id}),baskets:{}}},o=e(this.taskConfig.baskets);try{for(o.s();!(d=o.n()).done;)u=d.value,s.main.baskets[u.name]={name:u.name,size:0,maxCandidatesAllowed:u.maxCandidatesAllowed,preview:[],all:this.candidates.map(function(t){return{candidate:t._id,total:0}})}}catch(l){o.e(l)}finally{o.f()}return i.abrupt("return",(this.isSaveAndNew=!this.taskConfig.maxItems||this.taskConfig.maxItems>1,s));case 14:case"end":return i.stop()}},i,this)}))}},{key:"saveTask",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.basketDelegator.saveTask(this.taskSavedData,this.taskConfig);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"saveTaskIntegrated",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}},t)}))}},{key:"loadTask",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.route.snapshot.paramMap.get(c.a.SavedTaskId))){t.next=11;break}return this.isTaskUpdate=!0,t.next=5,this.basketDelegator.loadTask(e);case 5:return a=t.sent,t.next=8,this.candidatesDelegator.getCandidatesByIds(a.main.candidates);case 8:this.candidates=t.sent,this.setLoadedData(a),this.taskSavedData=a;case 11:return t.abrupt("return",this.taskSavedData);case 12:case"end":return t.stop()}},t,this)}))}},{key:"saveAndNew",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.msgService.showAreYouSure(this.langProvider.TaskSaveAndNew);case 2:if(!t.sent){t.next=5;break}(e={})[c.a.TaskDescId]=this.taskDesc.id,this.router.navigate(["tabs/task-catalog",e],{replaceUrl:!0,skipLocationChange:!0});case 5:case"end":return t.stop()}},t,this)}))}},{key:"setLoadedData",value:function(t){var a=this;for(var n in t.main.baskets)if(Object.prototype.hasOwnProperty.call(t.main.baskets,n)){var i,r=t.main.baskets[n],s=[],o=e(r.preview);try{var c=function(){var t=i.value,e=r.all.find(function(e){return e.candidate===t.candidate});s.push(e)};for(o.s();!(i=o.n()).done;)c()}catch(d){o.e(d)}finally{o.f()}r.preview=s}this.taskConfig.isCandidatesStatic||function(){var n=new Set;for(var i in t.main.baskets)Object.prototype.hasOwnProperty.call(t.main.baskets,i)&&t.main.baskets[i].all.forEach(function(t){return n.add(t.candidate)});var r,s=e(n);try{var o=function(){var t=r.value;a.candidates=a.candidates.filter(function(e){return e._id!==t})};for(s.s();!(r=s.n()).done;)o()}catch(d){s.e(d)}finally{s.f()}}()}},{key:"loadTaskIntegrated",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.taskSavedData=t,e.next=3,this.setLoadedData(t);case 3:case"end":return e.stop()}},e,this)}))}},{key:"selectBasket",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.selectedBasket=this.selectedBasket!==t.name?t.name:null,e.next=3,this.showCanidatesSelection(t);case 3:case"end":return e.stop()}},e,this)}))}},{key:"showCanidatesSelection",value:function(t){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark(function a(){var n,i,r,s,o,c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=this.taskSavedData.main.baskets[t.name],a.next=3,this.modalCtrl.create({component:m,componentProps:{basketItems:n.all,taskConfig:this.taskConfig,basket:t}});case 3:return i=a.sent,a.next=6,i.present();case 6:return a.next=8,i.onWillDismiss();case 8:if((r=a.sent).data){n.preview=r.data,s=e(r.data);try{for(c=function(){var t=o.value,e=n.all.find(function(e){return e.candidate===t.candidate});e&&(e.total=t.total)},s.s();!(o=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}n.all=n.all.sort(function(t,e){return e.total-t.total})}case 10:case"end":return a.stop()}},a,this)}))}},{key:"checkIfBasketsEmpty",value:function(){var t=this;return Object.keys(this.taskSavedData.main.baskets).some(function(e){var a;return(null===(a=t.taskSavedData.main.baskets[e].preview)||void 0===a?void 0:a.length)>0})}},{key:"createComment",value:function(){this.router.navigate(["tabs/comments/create-comment",{taskDescId:this.taskDesc.id,unique:o.Guid.raw()}],{skipLocationChange:!0})}}]),t}()).\u0275fac=function(t){return new(t||T)(u.Lb(y.f),u.Lb(y.a),u.Lb(C.a),u.Lb(l.eb),u.Lb(v.a),u.Lb(b.b),u.Lb(l.ib),u.Lb(h.a),u.Lb(D.a),u.Lb(w.a))},T.\u0275cmp=u.Fb({type:T,selectors:[["app-baskets2"]],inputs:{integrated:"integrated"},decls:2,vars:2,consts:[[4,"ngIf"],["slot","start"],["slot","end"],["defaultHref","tabs/tasks"],[1,"baskets"],["id","baskets","class","basket","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",3,"selectedBasket","direction","click",4,"ngFor","ngForOf"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content",4,"ngIf"],["id","baskets","cdkDropList","","cdkDropListOrientation","horizontal","cdkDropListSortingDisabled","",1,"basket",3,"click"],["color","secondary",1,"basketHeader"],[1,"basketItems",2,"direction","ltr"],[4,"ngFor","ngForOf"],["class","avatarBasket",3,"candidateId","total","isShowTotal",4,"ngIf"],[1,"avatarBasket",3,"candidateId","total","isShowTotal"],["horizontal","start","vertical","bottom","slot","fixed","cdkDrag","","cdkDragBoundary",".content"],[2,"display","flex"],["color","primary",3,"click"],["name","chatbox-ellipses"],["style","margin-left: 0.2rem;","color","tertiary",3,"click",4,"ngIf"],["color","tertiary",2,"margin-left","0.2rem",3,"click"],["name","bag-check"]],template:function(t,e){1&t&&(u.rc(0,R,8,1,"ion-header",0),u.rc(1,B,4,2,"ion-content",0)),2&t&&(u.hc("ngIf",!e.integrated),u.Bb(1),u.hc("ngIf",e.isTaskInit))},directives:[f.m,l.s,l.Z,l.k,l.F,l.g,l.h,l.X,l.n,f.l,l.l,l.C,g.a,l.o,l.p,l.t],styles:[".container[_ngcontent-%COMP%]{width:100%}.baskets[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.baskets[_ngcontent-%COMP%]{align-content:flex-start;overflow:scroll;flex:1}.basket[_ngcontent-%COMP%]{min-height:8rem;display:flex;flex-direction:column;flex:1}.basketItems[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;width:100%;flex-wrap:wrap;overflow:scroll}.avatarBasket[_ngcontent-%COMP%]{height:2rem;width:2rem;margin:.5rem}"]}),T)},OZ4V:function(t,e,a){"use strict";a.d(e,"a",function(){return p});var n=a("mrSG"),r=a("fXoL"),o=a("TEn/"),c=a("zrcv"),d=a("L5fO"),u=a("ofXK"),l=a("g1yl");function b(t,e){if(1&t){var a=r.Sb();r.Rb(0,"ion-header",3),r.Rb(1,"ion-toolbar"),r.Rb(2,"ion-title"),r.tc(3),r.Qb(),r.Rb(4,"ion-buttons",4),r.Rb(5,"ion-button",5),r.Zb("click",function(t){return r.mc(a),r.bc().back(t)}),r.Mb(6,"ion-icon",6),r.Qb(),r.Qb(),r.Qb(),r.Qb()}if(2&t){var n=r.bc();r.Bb(3),r.vc(" ",n.langProvider.Select," ")}}function h(t,e){if(1&t){var a=r.Sb();r.Rb(0,"app-candidate-avatar",11),r.Zb("click",function(){r.mc(a);var t=e.$implicit;return r.bc(2).select(t)}),r.Qb()}if(2&t){var n=e.$implicit,i=r.bc(2);r.hc("candidate",n)("isSelected",i.selectedCandidatesCopy[n._id])}}function v(t,e){if(1&t){var a=r.Sb();r.Rb(0,"ion-fab-button",12),r.Zb("click",function(){return r.mc(a),r.bc(2).activate()}),r.Mb(1,"ion-icon",13),r.Qb()}}function f(t,e){if(1&t&&(r.Pb(0),r.Rb(1,"ion-content"),r.Rb(2,"div",7),r.Rb(3,"div",8),r.rc(4,h,1,2,"app-candidate-avatar",9),r.Qb(),r.rc(5,v,2,0,"ion-fab-button",10),r.Qb(),r.Qb(),r.Ob()),2&t){var a=r.bc();r.Bb(4),r.hc("ngForOf",a.candidates)("ngForTrackBy",a.trackByFn),r.Bb(1),r.hc("ngIf",a.isModal)}}function g(t,e){if(1&t){var a=r.Sb();r.Rb(0,"app-candidate-avatar",11),r.Zb("click",function(){r.mc(a);var t=e.$implicit;return r.bc(2).select(t)}),r.Qb()}if(2&t){var n=e.$implicit,i=r.bc(2);r.hc("candidate",n)("isSelected",i.selectedCandidatesCopy[n._id])}}function k(t,e){if(1&t&&(r.Rb(0,"div",14),r.rc(1,g,1,2,"app-candidate-avatar",9),r.Qb()),2&t){var a=r.bc();r.Bb(1),r.hc("ngForOf",a.candidates)("ngForTrackBy",a.trackByFn)}}var p=function(){var t=function(){function t(e,a,n){i(this,t),this.modalCtrl=e,this.msgService=a,this.langProvider=n,this.candidateSelected=new r.o}return s(t,[{key:"ngOnInit",value:function(){this.isModal?(this.select=this.selectModal,this.selectedCandidates?this.selectedCandidatesCopy=JSON.parse(JSON.stringify(this.selectedCandidates)):this.selectedCandidates={}):(this.select=this.selectNoneModal,this.selectedCandidatesCopy=this.selectedCandidates)}},{key:"selectNoneModal",value:function(t){this.candidateSelected.emit(t)}},{key:"selectModal",value:function(t){this.selectedCandidatesCopy[t._id]=!this.selectedCandidatesCopy[t._id]}},{key:"activate",value:function(){this.modalCtrl.dismiss(this.selectedCandidatesCopy)}},{key:"trackByFn",value:function(t,e){return e?e._id:t}},{key:"back",value:function(t){return Object(n.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.candidates.filter(function(t){return e.selectedCandidates[t._id]!=e.selectedCandidatesCopy[t._id]}).length>0)){t.next=8;break}return t.next=3,this.msgService.showAreYouSure(this.langProvider.DataNotSaved);case 3:if(t.t0=t.sent,!t.t0){t.next=6;break}this.modalCtrl.dismiss();case 6:t.next=9;break;case 8:this.modalCtrl.dismiss();case 9:case"end":return t.stop()}},t,this)}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(r.Lb(o.eb),r.Lb(c.a),r.Lb(d.b))},t.\u0275cmp=r.Fb({type:t,selectors:[["app-candidate-selection"]],inputs:{candidates:"candidates",selectedCandidates:"selectedCandidates",isModal:"isModal"},outputs:{candidateSelected:"candidateSelected"},decls:4,vars:3,consts:[["translucent","true",4,"ngIf"],[4,"ngIf","ngIfElse"],["noModal",""],["translucent","true"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"container"],[1,"candidates"],["class","candi",3,"candidate","isSelected","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","activate","color","secondary",3,"click",4,"ngIf"],[1,"candi",3,"candidate","isSelected","click"],["color","secondary",1,"activate",3,"click"],["name","checkmark"],[1,"candidates","candidatesNonModal"]],template:function(t,e){if(1&t&&(r.rc(0,b,7,1,"ion-header",0),r.rc(1,f,6,3,"ng-container",1),r.rc(2,k,2,2,"ng-template",null,2,r.sc)),2&t){var a=r.lc(3);r.hc("ngIf",e.isModal),r.Bb(1),r.hc("ngIf",e.isModal)("ngIfElse",a)}},directives:[u.m,o.s,o.Z,o.X,o.k,o.j,o.t,o.n,u.l,l.a,o.p],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-content:flex-start;overflow:scroll}.candidatesNonModal[_ngcontent-%COMP%]{height:100%}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{margin:.5rem auto}"]}),t}()},TtBN:function(a,n,r){"use strict";r.d(n,"a",function(){return j});var o=r("mrSG"),c=r("kMc0"),d=r("fXoL"),u=r("L5fO"),l=r("pQKU"),b=r("ofXK"),h=r("TEn/");function v(t,e){if(1&t&&(d.Pb(0),d.Rb(1,"span",3),d.tc(2),d.Qb(),d.Rb(3,"span",5),d.tc(4),d.Qb(),d.Ob()),2&t){var a=d.bc(2);d.Bb(2),d.uc(a.langProvider.TotalTasksNotParticipate),d.Bb(2),d.uc(a.orderedAggData.totalNotParticipated)}}function f(t,e){if(1&t&&(d.Pb(0),d.Rb(1,"span",3),d.tc(2),d.Qb(),d.Rb(3,"span",5),d.tc(4),d.Qb(),d.Rb(5,"span",8),d.tc(6),d.Qb(),d.Rb(7,"span",9),d.tc(8),d.Qb(),d.Ob()),2&t){var a=d.bc().$implicit;d.Bb(2),d.uc(a.key),d.Bb(2),d.uc(a.value.value),d.Bb(2),d.uc(a.value.avg),d.Bb(2),d.uc(a.value.max)}}function g(t,e){if(1&t&&(d.Pb(0),d.rc(1,f,9,4,"ng-container",0),d.Ob()),2&t){var a=e.$implicit;d.Bb(1),d.hc("ngIf",a.value.avg>0)}}function k(t,e){if(1&t&&(d.Pb(0),d.Rb(1,"ion-item"),d.Rb(2,"ion-label"),d.Rb(3,"div",1),d.Rb(4,"span"),d.tc(5),d.Qb(),d.Qb(),d.Rb(6,"div",2),d.Pb(7),d.Rb(8,"span",3),d.tc(9),d.Qb(),d.Rb(10,"span",4),d.tc(11),d.cc(12,"date"),d.Qb(),d.Ob(),d.Pb(13),d.Rb(14,"span",3),d.tc(15),d.Qb(),d.Rb(16,"span",4),d.tc(17),d.cc(18,"date"),d.Qb(),d.Ob(),d.Pb(19),d.Rb(20,"span",3),d.tc(21),d.Qb(),d.Rb(22,"span",5),d.tc(23),d.Qb(),d.Ob(),d.rc(24,v,5,2,"ng-container",0),d.Pb(25),d.Rb(26,"span",3),d.tc(27),d.Qb(),d.Rb(28,"span",5),d.tc(29),d.Qb(),d.Ob(),d.Pb(30),d.Rb(31,"span",3),d.tc(32),d.Qb(),d.Rb(33,"span",5),d.tc(34),d.Qb(),d.Ob(),d.Pb(35),d.Rb(36,"span",3),d.tc(37),d.Qb(),d.Rb(38,"span",5),d.tc(39),d.Qb(),d.Ob(),d.Pb(40),d.Rb(41,"span",3),d.tc(42),d.Qb(),d.Rb(43,"span",5),d.tc(44),d.Qb(),d.Ob(),d.Qb(),d.Rb(45,"div",6),d.Rb(46,"span",7),d.tc(47),d.Qb(),d.Rb(48,"span",5),d.tc(49),d.Qb(),d.Rb(50,"span",8),d.tc(51),d.Qb(),d.Rb(52,"span",9),d.tc(53),d.Qb(),d.rc(54,g,2,1,"ng-container",10),d.cc(55,"keyvalue"),d.Qb(),d.Qb(),d.Qb(),d.Ob()),2&t){var a=d.bc();d.Bb(1),d.qc("direction",a.langProvider.LangDirection),d.Bb(4),d.uc(a.taskName),d.Bb(4),d.uc(a.langProvider.TaskFirstDate),d.Bb(2),d.uc(d.ec(12,23,a.orderedAggData.firstTaskDate,"dd/MM/yy HH:mm:ss")),d.Bb(4),d.uc(a.langProvider.TaskLastDate),d.Bb(2),d.uc(d.ec(18,26,a.orderedAggData.lastTaskDate,"dd/MM/yy HH:mm:ss")),d.Bb(4),d.uc(a.langProvider.TotalTasks),d.Bb(2),d.uc(a.totalTasks),d.Bb(1),d.hc("ngIf",a.orderedAggData.totalNotParticipated>0),d.Bb(3),d.uc(a.langProvider.OrderedAvgPosition),d.Bb(2),d.uc(a.orderedAggData.avgPosition),d.Bb(3),d.uc(a.langProvider.HighPosition),d.Bb(2),d.uc(a.orderedAggData.highPosition),d.Bb(3),d.uc(a.langProvider.LowPosition),d.Bb(2),d.uc(a.orderedAggData.lowPosition),d.Bb(3),d.uc(a.langProvider.MeanPosition),d.Bb(2),d.uc(a.orderedAggData.meanPosition),d.Bb(3),d.vc("",a.langProvider.Tags,":"),d.Bb(2),d.uc(a.langProvider.BasketValue),d.Bb(2),d.uc(a.langProvider.BasketAvg),d.Bb(2),d.uc(a.langProvider.BasketMax),d.Bb(1),d.hc("ngForOf",d.dc(55,29,a.basketsAggData.basketsTotals))}}var p,m=((p=function(){function t(e,a,n){i(this,t),this.langProvider=e,this.orderedDelegtor=a,this.basketDelegator=n}return s(t,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,a,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.taskName=this.tasks[0].name,this.totalTasks=this.tasks.length,(e=new c.a).start(),this.orderedAggData=this.orderedDelegtor.calcCandidateAggDataForTask(this.candidate,this.tasks),t.next=5,this.orderedDelegtor.loadTasksBaskets(this.tasks);case 5:a=t.sent,this.basketsAggData=this.basketDelegator.calcCandidateAggData(this.candidate,this.candidates,a),n=e.stop(),console.log("OrderedCandidateHistoryAgg ".concat(this.candidate._id," time: ").concat(n)),this.isInit=!0;case 9:case"end":return t.stop()}},t,this)}))}}]),t}()).\u0275fac=function(t){return new(t||p)(d.Lb(u.b),d.Lb(j),d.Lb(l.a))},p.\u0275cmp=d.Fb({type:p,selectors:[["app-ordered-candidate-history-agg"]],inputs:{tasks:"tasks",candidate:"candidate",candidates:"candidates"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[1,"orderStats"],[1,"col1"],[1,"col2","ltr","ml-auto"],[1,"col2"],[1,"orderBaskets"],[1,"col1","basketsHeader"],[1,"col3"],[1,"col4"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&d.rc(0,k,56,31,"ng-container",0),2&t&&d.hc("ngIf",e.isInit)},directives:[b.m,h.w,h.C,b.l],pipes:[b.e,b.g],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.header[_ngcontent-%COMP%], .row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.orderStats[_ngcontent-%COMP%]{display:grid}.orderBaskets[_ngcontent-%COMP%]{display:grid;margin-top:.2rem}.basketsHeader[_ngcontent-%COMP%]{font-style:italic;font-weight:700}"]}),p);function y(t,e){if(1&t&&(d.Rb(0,"span"),d.tc(1),d.Qb()),2&t){var a=d.bc(2);d.Bb(1),d.wc("",a.langProvider.Position," : ",a.item.position,"")}}function C(t,e){if(1&t&&(d.Rb(0,"span"),d.tc(1),d.Qb()),2&t){var a=d.bc(2);d.Bb(1),d.uc(a.langProvider.NotParticipate)}}function D(t,e){if(1&t&&(d.Pb(0),d.Rb(1,"span",7),d.tc(2),d.Qb(),d.Rb(3,"span",8),d.tc(4),d.Qb(),d.Ob()),2&t){var a=d.bc().$implicit;d.Bb(2),d.uc(a.key),d.Bb(2),d.uc(a.value.total)}}function w(t,e){if(1&t&&(d.Pb(0),d.rc(1,D,5,2,"ng-container",0),d.Ob()),2&t){var a=e.$implicit;d.Bb(1),d.hc("ngIf",a.value.total>0)}}function R(t,e){if(1&t&&(d.Rb(0,"div",5),d.Rb(1,"div",6),d.Rb(2,"span",7),d.tc(3),d.Qb(),d.Rb(4,"span",8),d.tc(5),d.Qb(),d.rc(6,w,2,1,"ng-container",9),d.cc(7,"keyvalue"),d.Qb(),d.Qb()),2&t){var a=d.bc(2);d.Bb(3),d.uc(a.langProvider.Tags),d.Bb(2),d.uc(a.langProvider.Total),d.Bb(1),d.hc("ngForOf",d.dc(7,3,a.item.basketItems))}}function O(t,e){if(1&t&&(d.Pb(0),d.Rb(1,"ion-item"),d.Rb(2,"ion-label"),d.Rb(3,"div",1),d.Rb(4,"span"),d.tc(5),d.Qb(),d.Rb(6,"span",2),d.tc(7),d.cc(8,"date"),d.Qb(),d.Qb(),d.Rb(9,"div",3),d.Rb(10,"span"),d.tc(11),d.Qb(),d.rc(12,y,2,2,"span",0),d.rc(13,C,2,1,"span",0),d.Qb(),d.rc(14,R,8,5,"div",4),d.Qb(),d.Qb(),d.Ob()),2&t){var a=d.bc();d.Bb(1),d.qc("direction",a.langProvider.LangDirection),d.Bb(4),d.uc(a.task.name),d.Bb(2),d.uc(d.ec(8,11,a.task.date,"dd/MM/yy HH:mm:ss")),d.Bb(2),d.qc("direction",a.langProvider.LangDirection),d.Bb(2),d.wc("",a.langProvider.TotalParticipants," : ",a.item.total,""),d.Bb(1),d.hc("ngIf",a.item.position>0),d.Bb(1),d.hc("ngIf",0===a.item.position),d.Bb(1),d.hc("ngIf",a.item.basketItems)}}var x,P=((x=function(){function t(e,a,n){i(this,t),this.taskDelegator=e,this.basketsDelegator=a,this.langProvider=n}return s(t,[{key:"ngOnInit",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.calcHistory();case 1:case"end":return t.stop()}},t,this)}))}},{key:"calcHistory",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.taskDelegator.loadTask(this.task._id);case 2:this.taskSaveData=t.sent,this.item={total:this.task.orderedCandidates.length,position:this.task.orderedCandidates.findIndex(function(t){return t===a.candidate._id})+1,date:new Date(this.task.date)},e=this.basketsDelegator.GetBasketsForCandidate(this.candidate._id,this.taskSaveData.basketsSaveData.main),Object.keys(e).length>0&&(this.item.basketItems=e),this.isInit=!0;case 6:case"end":return t.stop()}},t,this)}))}}]),t}()).\u0275fac=function(t){return new(t||x)(d.Lb(j),d.Lb(l.a),d.Lb(u.b))},x.\u0275cmp=d.Fb({type:x,selectors:[["app-ordered-candidate-history"]],inputs:{task:"task",candidate:"candidate"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"header"],[2,"direction","ltr"],[1,"order"],["class","orderBaskets",4,"ngIf"],[1,"orderBaskets"],[1,"baskets"],[1,"col1"],[1,"col2"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&d.rc(0,O,15,14,"ng-container",0),2&t&&d.hc("ngIf",e.isInit)},directives:[b.m,h.w,h.C,b.l],pipes:[b.e,b.g],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.header[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.header[_ngcontent-%COMP%], .order[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.order[_ngcontent-%COMP%], .orderBaskets[_ngcontent-%COMP%]{margin-top:.2rem}.basketsHeader[_ngcontent-%COMP%]{font-style:italic;font-weight:700}.baskets[_ngcontent-%COMP%]{display:grid}"]}),x);function I(t,e){if(1&t&&(d.Pb(0),d.Pb(1),d.Rb(2,"span",1),d.tc(3),d.Qb(),d.Rb(4,"span",2),d.tc(5),d.Qb(),d.Rb(6,"span",3),d.tc(7),d.Qb(),d.Rb(8,"span",4),d.tc(9),d.Qb(),d.Rb(10,"span",5),d.tc(11),d.Qb(),d.Rb(12,"span",6),d.tc(13),d.Qb(),d.Ob(),d.Ob()),2&t){var a=e.$implicit;d.Bb(3),d.uc(a.candidate),d.Bb(2),d.uc(a.avg),d.Bb(2),d.uc(a.total),d.Bb(2),d.uc(a.max),d.Bb(2),d.uc(a.low),d.Bb(2),d.uc(a.mean)}}var S,B,T,Q=((B=function(){function t(e,a){i(this,t),this.taskDelegator=e,this.langProvider=a}return s(t,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){this.items=this.taskDelegator.calcAllCandidatesAggDataForTask(this.candidates,this.tasksGroup)}}]),t}()).\u0275fac=function(t){return new(t||B)(d.Lb(j),d.Lb(u.b))},B.\u0275cmp=d.Fb({type:B,selectors:[["app-ordered-history-agg"]],inputs:{tasksGroup:"tasksGroup",candidates:"candidates"},decls:14,vars:3,consts:[[1,"ordered-task-grouped"],[1,"col1"],[1,"col2"],[1,"col3"],[1,"col4"],[1,"col5"],[1,"col6"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(d.Rb(0,"div",0),d.Rb(1,"span",1),d.tc(2,"\u05de\u05e1\u05e4\u05e8"),d.Qb(),d.Rb(3,"span",2),d.tc(4,"\u05de\u05de\u05d5\u05e6\u05e2"),d.Qb(),d.Rb(5,"span",3),d.tc(6,"\u05de\u05e7\u05e6\u05d9\u05dd"),d.Qb(),d.Rb(7,"span",4),d.tc(8,"\u05de\u05e7\u05e1"),d.Qb(),d.Rb(9,"span",5),d.tc(10,"\u05de\u05d9\u05e0"),d.Qb(),d.Rb(11,"span",6),d.tc(12,'\u05e1"\u05ea'),d.Qb(),d.rc(13,I,14,6,"ng-container",7),d.Qb()),2&t&&(d.qc("direction",e.langProvider.LangDirection),d.Bb(13),d.hc("ngForOf",e.items))},directives:[b.l],styles:[".ordered-task-grouped[_ngcontent-%COMP%]{display:grid}"]}),B),M=((S=function(){function t(e){i(this,t),this.langProvider=e}return s(t,[{key:"ngOnInit",value:function(){this.calcHistory()}},{key:"calcHistory",value:function(){this.totalParticipated=this.task.orderedCandidates.length,this.totalCandidates=this.candidates.filter(function(t){return t.isActive}).length;var t=this.totalParticipated/this.totalCandidates;this.completedStatus=t>=1?"full":t>=.5?"half":"none"}}]),t}()).\u0275fac=function(t){return new(t||S)(d.Lb(u.b))},S.\u0275cmp=d.Fb({type:S,selectors:[["app-ordered-history"]],inputs:{task:"task",candidates:"candidates"},decls:5,vars:11,consts:[[1,"container"]],template:function(t,e){1&t&&(d.Rb(0,"div",0),d.Rb(1,"span"),d.tc(2),d.Qb(),d.Rb(3,"span"),d.tc(4),d.Qb(),d.Qb()),2&t&&(d.qc("direction",e.langProvider.LangDirection),d.Db("completed","full"===e.completedStatus)("halfCompleted","half"===e.completedStatus)("notCompleted","none"===e.completedStatus),d.Bb(2),d.uc(e.langProvider.TotalParticipants),d.Bb(2),d.wc("",e.totalCandidates," / ",e.totalParticipated,""))},styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.completed[_ngcontent-%COMP%]{color:green}.halfCompleted[_ngcontent-%COMP%]{color:orange}.notCompleted[_ngcontent-%COMP%]{color:red}"]}),S),_=r("2lKs"),L=r("nbnm"),A=r("ufmx"),F=r("h7jJ"),j=((T=function(){function a(t,e,n){i(this,a),this.entityNamer=t,this.candidatesDelegator=e,this.dataProvider=n}return s(a,[{key:"getTaskConfig",value:function(t){throw new Error("Method not implemented.")}},{key:"getTaskName",value:function(){throw new Error("Method not implemented.")}},{key:"exportCopy",value:function(t,a){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function a(){var n,i,r,s,o,c,d,u,l,b,h,v,f,g,k;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.loadTask(t);case 2:n=a.sent,i=this.candidatesDelegator.getCandidatesByIdsMap(n.basketsSaveData.main.candidates),n.main.exportOrder=[],r=1,s=e(n.main.orderedCandidates);try{for(s.s();!(o=s.n()).done;)c=o.value,d=i[c],u={candidateNum:d.number,candidateGroup:d.group,order:r++},n.main.exportOrder.push(u)}catch(p){s.e(p)}finally{s.f()}for(b in delete n.main.orderedCandidates,delete n.main.childIds,l=this.candidatesDelegator.getCandidatesByIdsMap(n.basketsSaveData.main.candidates),n.basketsSaveData.main.baskets)if(Object.prototype.hasOwnProperty.call(n.basketsSaveData.main.baskets,b)){delete(h=n.basketsSaveData.main.baskets[b]).preview,v=e(h.all);try{for(v.s();!(f=v.n()).done;)g=f.value,k=l[g.candidate],g.exportData={candidateNum:k.number,candidateGroup:k.group}}catch(p){v.e(p)}finally{v.f()}}return a.abrupt("return",n);case 12:case"end":return a.stop()}},a,this)}))}},{key:"saveTask",value:function(t,e){var a,n,i,r;return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],t.main._id=null!==(a=t.main._id)&&void 0!==a?a:this.entityNamer.taskPrefixWithUniqueIdAnd(t.main.type,t.main.taskId),t.main._rev=t.main._rev,t.main.date=null!==(n=t.main.date)&&void 0!==n?n:new Date,t.main.updateDate=new Date,s.push(t.main),t.basketsSaveData.main._id=null!==(i=t.basketsSaveData.main._id)&&void 0!==i?i:"".concat(t.main._id.replace("main","baskets")),t.basketsSaveData.main._rev=t.basketsSaveData.main._rev,t.basketsSaveData.main.date=null!==(r=t.basketsSaveData.main.date)&&void 0!==r?r:new Date,t.basketsSaveData.main.updateDate=new Date,t.main.childIds.baskets=[t.basketsSaveData.main._id],s.push(t.basketsSaveData.main),e.next=14,this.dataProvider.saveEntities(s);case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}},e,this)}))}},{key:"loadTask",value:function(t){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataProvider.loadTask(t);case 2:return a=e.sent,n=a._id.replace("main","baskets"),e.t0=a,e.next=7,this.dataProvider.loadEntitiesByPrefix(n);case 7:return e.t1=e.sent[0],e.t2={main:e.t1},e.abrupt("return",{main:e.t0,basketsSaveData:e.t2});case 10:case"end":return e.stop()}},e,this)}))}},{key:"deleteTask",value:function(t){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=[t],n=t._id.replace("main","baskets"),e.next=3,this.dataProvider.loadEntitiesByPrefix(n,{includeDocs:!1});case 3:return e.sent.forEach(function(t){return a.push(t)}),e.next=6,this.dataProvider.deleteEntities(a);case 6:case"end":return e.stop()}},e,this)}))}},{key:"getTaskHistory",value:function(){throw new Error("Method not implemented.")}},{key:"getComponentRoute",value:function(){return"ordered"}},{key:"getComponent",value:function(){return _.a}},{key:"getHistoryComponent",value:function(){return M}},{key:"getHistoryAggComponent",value:function(){return Q}},{key:"getCandidateHistoryComponent",value:function(){return P}},{key:"getCandidateAggregateComponent",value:function(){return m}},{key:"getTasksForCandidates",value:function(t){throw new Error("Method not implemented.")}},{key:"checkTaskEmpty",value:function(t,e){var a,n=(null===(a=t.main.orderedCandidates)||void 0===a?void 0:a.length)>0,i=Object.keys(t.basketsSaveData.main.baskets).some(function(e){var a,n;return null===(n=null===(a=t.basketsSaveData.main.baskets[e])||void 0===a?void 0:a.all)||void 0===n?void 0:n.some(function(t){return t.total>0})});return!(t.main._id||n||i)}},{key:"loadTasksBaskets",value:function(e){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark(function a(){var n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.reduce(function(e,a,n){return e.push.apply(e,t(a.childIds.baskets)),e},[]),a.next=3,this.dataProvider.loadEntitiesByIds(n);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},a,this)}))}},{key:"calcCandidateAggDataForAll",value:function(t,e){var a=e.reduce(function(t,e){return t[e.taskId]||(t[e.taskId]=[]),t[e.taskId].push(e),t},{}),n=[];for(var i in a)if(Object.prototype.hasOwnProperty.call(a,i)){var r=this.calcCandidateAggDataForTask(t,e);n.push(r)}return n}},{key:"calcCandidateAggDataForTask",value:function(t,a){var n,i=[],r=a.sort(function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()}),s=r[0].date,o=r[a.length-1].date,c=e(a);try{for(c.s();!(n=c.n()).done;){var d=n.value,u={total:d.orderedCandidates.length,position:d.orderedCandidates.findIndex(function(e){return e===t._id})+1,date:d.date};i.push(u)}}catch(y){c.e(y)}finally{c.f()}var l=i.filter(function(t){return 0===t.position}).length,b=i.length-l,h=(i.filter(function(t){return t.position>-1}).map(function(t){return t.position}).reduce(function(t,e){return t+e})/b).toFixed(1),v=i.map(function(t){return t.position}).filter(function(t){return t>0}),f=v.reduce(function(t,e){return e<=t?e:t}),g=v.reduce(function(t,e){return e>=t?e:t}),k=v.map(function(t){return Math.pow(t-Number(h),2)}).reduce(function(t,e){return t+e})/a.length,p=Math.sqrt(k),m=Number(p.toFixed(1));return{firstTaskDate:s,lastTaskDate:o,totalParticipated:b,totalNotParticipated:l,avgPosition:h,highPosition:f,lowPosition:g,meanPosition:m}}},{key:"calcAllCandidatesAggDataForTask",value:function(t,e){var a=this.candidatesDelegator.getCandidatesByIdsMap(t.map(function(t){return t._id})),n=e.tasks.reduce(function(t,e){for(var a=0;a<e.orderedCandidates.length;a++){var n=e.orderedCandidates[a],i=t[n];i||(i=[],t[n]=i),i.push(a+1)}return t},{});return Object.keys(n).map(function(t){var e=a[t].number,i=a[t].isActive,r=n[t],s=r.length,o=Number((r.reduce(function(t,e){return t+e})/s).toFixed(1)),c=r.reduce(function(t,e){return e<=t?e:t}),d=r.reduce(function(t,e){return e>=t?e:t}),u=r.map(function(t){return Math.pow(t-o,2)}).reduce(function(t,e){return t+e})/s,l=Math.sqrt(u),b=Number(l.toFixed(1));return{candidate:e,total:s,avg:o,max:c,low:d,mean:b,isActive:i}}).filter(function(t){return t.isActive}).sort(function(t,e){var a=0;return t.total>e.total?a=-1:e.total>t.total||t.avg>e.avg?a=1:e.avg>t.avg&&(a=-1),a})}}]),a}()).\u0275fac=function(t){return new(t||T)(d.Vb(L.a),d.Vb(A.a),d.Vb(F.a))},T.\u0275prov=d.Hb({token:T,factory:T.\u0275fac,providedIn:"root"}),T)}}])}();