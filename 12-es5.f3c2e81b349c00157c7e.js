!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function n(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{OrUu:function(e,a,s){"use strict";s.r(a),s.d(a,"TasksHistoryPageModule",function(){return z});var i,r=s("ofXK"),o=s("3Pt+"),c=s("TEn/"),u=s("tyNb"),l=s("mrSG"),p=s("Mxx3"),d=s("fXoL"),g=s("zrcv"),h=((i=function(){function e(n,a){t(this,e),this.popupCtrl=n,this.msgService=a}return n(e,[{key:"ngOnInit",value:function(){}},{key:"copy",value:function(){var t=JSON.stringify(this.msg);this.msgService.copyToClipboard(t),this.msgService.showToast("Copy to clipboard",1e3),this.popupCtrl.dismiss()}},{key:"whatsapp",value:function(){var t=JSON.stringify(this.msg),e=document.createElement("a");e.href="whatsapp://send?text=".concat(t),e["data-action"]="share/whatsapp/share",e.click(),this.popupCtrl.dismiss()}},{key:"upload",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.popupCtrl.dismiss("upload");case 1:case"end":return t.stop()}},t,this)}))}}]),e}()).\u0275fac=function(t){return new(t||i)(d.Kb(c.ib),d.Kb(g.a))},i.\u0275cmp=d.Eb({type:i,selectors:[["app-share-data"]],inputs:{msg:"msg"},decls:7,vars:0,consts:[[1,"container"],["color","light",3,"click"],["color","primary","name","copy",1,"sicon"],["color","primary","name","logo-whatsapp",1,"sicon"],["color","primary","name","cloud-upload",1,"sicon"]],template:function(t,e){1&t&&(d.Qb(0,"div",0),d.Qb(1,"ion-button",1),d.Yb("click",function(){return e.copy()}),d.Lb(2,"ion-icon",2),d.Pb(),d.Qb(3,"ion-button",1),d.Yb("click",function(){return e.whatsapp()}),d.Lb(4,"ion-icon",3),d.Pb(),d.Qb(5,"ion-button",1),d.Yb("click",function(){return e.upload()}),d.Lb(6,"ion-icon",4),d.Pb(),d.Pb())},directives:[c.j,c.t],styles:[".container[_ngcontent-%COMP%]{display:flex}.sicon[_ngcontent-%COMP%]{font-size:x-large}"]}),i),b=s("3LWr"),f=s("ufmx"),k=s("NrBX"),v=s("o6Vy"),m=s("VYsW"),y=s("L5fO"),w=s("RybT"),T=s("VVJX");function C(t,e){}var x,P=((x=function(){function e(n,a){t(this,e),this.componentFactoryResolver=n,this.taskDelegatorFactory=a}return n(e,[{key:"ngOnInit",value:function(){var t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t),n=this.taskHost.viewContainerRef;n.clear();var a=n.createComponent(e);a.instance.task=this.task,a.instance.candidates=this.candidates,this.componentRef=a}}},{key:"ngOnChanges",value:function(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}]),e}()).\u0275fac=function(t){return new(t||x)(d.Kb(d.k),d.Kb(w.a))},x.\u0275cmp=d.Eb({type:x,selectors:[["app-task-history-host"]],viewQuery:function(t,e){var n;1&t&&d.yc(T.a,3),2&t&&d.jc(n=d.Zb())&&(e.taskHost=n.first)},inputs:{task:"task",candidates:"candidates"},features:[d.yb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&d.qc(0,C,0,0,"ng-template",0)},directives:[T.a],styles:[""]}),x);function D(t,e){}var O,R=((O=function(){function e(n,a){t(this,e),this.componentFactoryResolver=n,this.taskDelegatorFactory=a}return n(e,[{key:"ngOnInit",value:function(){var t=this.taskDelegatorFactory.getTaskDelegator(this.tasksGroup.taskType).getHistoryAggComponent();if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t),n=this.taskHost.viewContainerRef;n.clear();var a=n.createComponent(e);a.instance.tasksGroup=this.tasksGroup,a.instance.candidates=this.candidates,this.componentRef=a}}},{key:"ngOnChanges",value:function(t){this.componentRef&&(this.componentRef.instance.tasksGroup=this.tasksGroup,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}]),e}()).\u0275fac=function(t){return new(t||O)(d.Kb(d.k),d.Kb(w.a))},O.\u0275cmp=d.Eb({type:O,selectors:[["app-task-history-agg-host"]],viewQuery:function(t,e){var n;1&t&&d.yc(T.a,3),2&t&&d.jc(n=d.Zb())&&(e.taskHost=n.first)},inputs:{tasksGroup:"tasksGroup",candidates:"candidates"},features:[d.yb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&d.qc(0,D,0,0,"ng-template",0)},directives:[T.a],styles:[""]}),O);function S(t,e){if(1&t){var n=d.Rb();d.Qb(0,"ion-button",7),d.Yb("click",function(){return d.lc(n),d.ac(3).showSearchbar(!0)}),d.Lb(1,"ion-icon",9),d.Pb()}}function Q(t,e){if(1&t){var n=d.Rb();d.Ob(0),d.Qb(1,"ion-buttons",4),d.Lb(2,"ion-menu-button"),d.Pb(),d.Qb(3,"ion-title"),d.sc(4),d.Pb(),d.Qb(5,"ion-buttons",5),d.qc(6,S,2,0,"ion-button",6),d.Qb(7,"ion-button",7),d.Yb("click",function(){return d.lc(n),d.ac(2).showTaskFilters()}),d.Lb(8,"ion-icon",8),d.Pb(),d.Pb(),d.Nb()}if(2&t){var a=d.ac(2);d.Ab(3),d.pc("direction",a.langProvider.LangDirection),d.Ab(1),d.tc(a.langProvider.TasksHistory),d.Ab(2),d.gc("ngIf",!a.isShowSearchbar)}}function A(t,e){if(1&t){var n=d.Rb();d.Qb(0,"ion-searchbar",10),d.Yb("ngModelChange",function(t){return d.lc(n),d.ac(2).searchTaskStr=t})("ionChange",function(){return d.lc(n),d.ac(2).updateSearchTask()})("ionCancel",function(){return d.lc(n),d.ac(2).showSearchbar(!1)}),d.Pb()}if(2&t){var a=d.ac(2);d.gc("ngModel",a.searchTaskStr)}}function I(t,e){if(1&t){var n=d.Rb();d.Qb(0,"ion-item"),d.Qb(1,"ion-toggle",11),d.Yb("ngModelChange",function(t){return d.lc(n),d.ac(2).tasksViewGroupedToggle=t})("ionChange",function(t){return d.lc(n),d.ac(2).changeTasksViewMode(t)}),d.Pb(),d.Qb(2,"ion-label",4),d.sc(3),d.Pb(),d.Pb()}if(2&t){var a=d.ac(2);d.pc("direction",a.langProvider.LangDirection),d.Ab(1),d.gc("ngModel",a.tasksViewGroupedToggle),d.Ab(2),d.tc(a.langProvider.TasksGroupedSummerized)}}function F(t,e){1&t&&d.Lb(0,"ion-icon",23)}function G(t,e){if(1&t){var n=d.Rb();d.Qb(0,"ion-item-sliding",null,13),d.bc(2,"lowercase"),d.Qb(3,"ion-item-options",14),d.Qb(4,"ion-item-option",15),d.Yb("click",function(){d.lc(n);var t=e.$implicit,a=d.kc(1);return d.ac(3).onDeleted(t,a)}),d.Lb(5,"ion-icon",16),d.Pb(),d.Qb(6,"ion-item-option",15),d.Yb("click",function(t){d.lc(n);var a=e.$implicit,s=d.kc(1);return d.ac(3).onCopyExport(a,s,t)}),d.Lb(7,"ion-icon",17),d.Pb(),d.Pb(),d.Qb(8,"ion-item",18),d.Yb("click",function(){d.lc(n);var t=e.$implicit;return d.ac(3).onEdit(t)}),d.Qb(9,"ion-label"),d.Qb(10,"h3",19),d.Qb(11,"div",19),d.qc(12,F,1,0,"ion-icon",20),d.Qb(13,"span"),d.sc(14),d.Pb(),d.Pb(),d.Qb(15,"span",21),d.sc(16),d.bc(17,"date"),d.Pb(),d.Pb(),d.Lb(18,"app-task-history-host",22),d.Pb(),d.Pb(),d.Pb()}if(2&t){var a=e.$implicit,s=d.ac(3);d.Bb("track",d.cc(2,8,a.type)),d.Ab(9),d.pc("direction",s.langProvider.LangDirection),d.Ab(3),d.gc("ngIf",a.isExported),d.Ab(2),d.tc(a.name),d.Ab(2),d.tc(d.dc(17,10,a.date,"dd/MM/yy HH:mm:ss")),d.Ab(2),d.gc("task",a)("candidates",s.candidates)}}function M(t,e){if(1&t&&d.qc(0,G,19,13,"ion-item-sliding",12),2&t){var n=e.$implicit,a=d.ac(2);d.gc("ngForOf",n.tasks)("ngForTrackBy",a.trackByFn)}}var L=function(t){return{tasks:t,isGrouped:!1}},H=function(t){return{$implicit:t}};function j(t,e){if(1&t&&(d.Qb(0,"ion-list"),d.Mb(1,24),d.Pb()),2&t){d.ac();var n=d.kc(8),a=d.ac();d.Ab(1),d.gc("ngTemplateOutlet",n)("ngTemplateOutletContext",d.ic(4,H,d.ic(2,L,a.tasksHistory)))}}function E(t,e){if(1&t&&(d.Ob(0),d.Qb(1,"h3",26),d.Qb(2,"span"),d.sc(3),d.Pb(),d.Pb(),d.Lb(4,"app-task-history-agg-host",27),d.bc(5,"lowercase"),d.Nb()),2&t){var n=d.ac().$implicit,a=d.ac(3);d.Ab(3),d.vc("",n.taskDesc," - ",a.langProvider.Aggregate,""),d.Ab(1),d.gc("tasksGroup",n)("candidates",a.candidates),d.Bb("track",d.cc(5,5,n.taskType))}}var K=function(t){return{tasks:t,isGrouped:!0}};function V(t,e){if(1&t&&(d.Ob(0),d.qc(1,E,6,7,"ng-container",0),d.Mb(2,24),d.Nb()),2&t){var n=e.$implicit;d.ac(2);var a=d.kc(8);d.Ab(1),d.gc("ngIf",n.isShowGroupedAddData),d.Ab(1),d.gc("ngTemplateOutlet",a)("ngTemplateOutletContext",d.ic(5,H,d.ic(3,K,n.tasks)))}}function q(t,e){if(1&t&&(d.Qb(0,"ion-list"),d.qc(1,V,3,7,"ng-container",25),d.Pb()),2&t){var n=d.ac(2);d.Ab(1),d.gc("ngForOf",n.tasksGrouped)}}function B(t,e){if(1&t&&(d.Ob(0),d.Qb(1,"ion-header"),d.Qb(2,"ion-toolbar"),d.qc(3,Q,9,4,"ng-container",0),d.qc(4,A,1,1,"ion-searchbar",1),d.Pb(),d.qc(5,I,4,4,"ion-item",2),d.Pb(),d.Qb(6,"ion-content"),d.qc(7,M,1,2,"ng-template",null,3,d.rc),d.qc(9,j,2,6,"ion-list",0),d.qc(10,q,2,1,"ion-list",0),d.Pb(),d.Nb()),2&t){var n=d.ac();d.Ab(3),d.gc("ngIf",!n.isShowSearchbar),d.Ab(1),d.gc("ngIf",n.isShowSearchbar),d.Ab(1),d.gc("ngIf",n.isTasksViewGroupedToggleEnabled),d.Ab(4),d.gc("ngIf",!n.tasksViewGroupedToggle),d.Ab(1),d.gc("ngIf",n.tasksViewGroupedToggle)}}var N,Y,W,U=[{path:"",component:(N=function(){function e(n,a,s,i,r,o,c,u,l,p,d,g){t(this,e),this.router=n,this.store=a,this.candidatesDelegator=s,this.tasksDelegator=i,this.syncService=r,this.appContext=o,this.langProvider=c,this.msgService=u,this.popupCtrl=l,this.loadingCtrl=p,this.alertController=d,this.taskDelegatorFactory=g,this.subscription={},this.tasksViewGroupedToggle=!0,this.isTasksViewGroupedToggleEnabled=!0,this.isInit=!1}return n(e,[{key:"ngOnInit",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.candidatesDelegator.getCandidatesCopy();case 2:this.candidates=t.sent,this.subscription.lastTasksChangeTime=this.store.lastTasksChangeTime.subscribe(function(t){return Object(l.a)(e,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loadTasks();case 1:case"end":return t.stop()}},t,this)}))}),this.isInit=!0;case 5:case"end":return t.stop()}},t,this)}))}},{key:"ngOnDestroy",value:function(){for(var t in this.subscription)Object.prototype.hasOwnProperty.call(this.subscription,t)&&this.subscription[t].unsubscribe()}},{key:"ionViewWillEnter",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)}))}},{key:"loadTasks",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,n,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.msgService.showLoader();case 3:return e=t.sent,t.next=6,this.tasksDelegator.getAllTasks();case 6:n=t.sent,a=n.sort(function(t,e){var n=new Date(t.date).getTime();return new Date(e.date).getTime()-n}),this.tasksHistory=a,this.isTasksViewGroupedToggleEnabled&&(s=n.reduce(function(t,e){var n=t[e.name];return n||(n={taskId:e.taskId,taskType:e.type,taskDesc:e.name,tasks:[]},t[e.name]=n),n.tasks.push(e),n.firstDate=n.tasks.sort(function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()})[0].date,n.lastDate=n.tasks.sort(function(t,e){return new Date(e.date).getTime()-new Date(t.date).getTime()})[0].date,t},{}),this.tasksGrouped=Object.keys(s).map(function(t){return s[t]}).map(function(t){return"Ordered"===t.taskType&&(t.isShowGroupedAddData=!0),t}).sort(function(t,e){return new Date(e.lastDate).getTime()-new Date(t.lastDate).getTime()})),console.log("");case 10:return t.prev=10,e.dismiss(),t.finish(10);case 13:case"end":return t.stop()}},t,this,[[0,,10,13]])}))}},{key:"onEdit",value:function(t){var e=this.taskDelegatorFactory.getTaskDelegator(t.type),n={};n[p.a.TaskDescId]=t.taskId,n[p.a.SavedTaskId]=t._id;var a={Path:"tabs/tasks/".concat(e.getComponentRoute()),Params:n,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(a),this.router.navigate([a.Path,a.Params],a.NavigationExtras)}},{key:"onCopyExport",value:function(t,e,n){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function a(){var s,i,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s=this.taskDelegatorFactory.getTaskDelegator(t.type),a.prev=1,a.next=4,s.exportCopy(t._id,t.taskId);case 4:return i=a.sent,a.next=7,this.popupCtrl.create({component:h,event:n,componentProps:{msg:i}});case 7:return r=a.sent,a.next=10,r.present();case 10:return a.next=12,r.onWillDismiss();case 12:if(a.t0=a.sent.data,a.t1="upload"===a.t0,!a.t1){a.next=16;break}this.uploadTask(i,t);case 16:a.next=21;break;case 18:a.prev=18,a.t2=a.catch(1),this.msgService.showToast("Cant export this task",1e3,"toastWarn");case 21:e.closeOpened();case 22:case"end":return a.stop()}},a,this,[[1,18]])}))}},{key:"onDeleted",value:function(t,e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var a,s,i,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.closeOpened(),a=!1,n.next=4,this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:function(){return a=!0}}]});case 4:return s=n.sent,n.next=7,s.present();case 7:return n.next=9,s.onWillDismiss();case 9:if(!a){n.next=24;break}return i=this.taskDelegatorFactory.getTaskDelegator(t.type),n.next=13,this.loadingCtrl.create({message:"temp delete task"});case 13:return r=n.sent,n.next=16,r.present();case 16:return n.next=18,i.deleteTask(t);case 18:return n.next=20,this.loadTasks();case 20:return n.next=22,r.dismiss();case 22:return n.next=24,r.onDidDismiss();case 24:case"end":return n.stop()}},n,this)}))}},{key:"showSearchbar",value:function(t){}},{key:"showTaskFilters",value:function(){}},{key:"updateSearchTask",value:function(){}},{key:"trackByFn",value:function(t,e){return e?e._id:t}},{key:"temp",value:function(t){console.log(t._id)}},{key:"changeTasksViewMode",value:function(t){}},{key:"uploadTask",value:function(t,e){var n,a,s;return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var r,o,c,u,l,p,d,g;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.popupCtrl.dismiss("upload"),i.prev=1,o=!0,c=null,i.next=5,this.tasksDelegator.getCategoryConfig();case 5:if(u=i.sent.isNoTaskUploadWithDesc){i.next=16;break}return i.next=9,this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.TaskUpload,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"activate",cssClass:"danger"}],inputs:[{name:"taskDesc",type:"text",placeholder:this.langProvider.TaskUploadDesc}]});case 9:return l=i.sent,i.next=12,l.present();case 12:return i.next=14,l.onWillDismiss();case 14:p=i.sent,o="activate"===p.role,c=null===(a=null===(n=p.data)||void 0===n?void 0:n.values)||void 0===a?void 0:a.taskDesc;case 16:if(!o){i.next=32;break}if(!u&&!c){i.next=31;break}return i.next=20,this.msgService.showLoader();case 20:return r=i.sent,d=this.appContext.getAppContext(),g={ActivationCode:d.activationCode,User:d.user,UserDesc:null!==(s=d.userDesc)&&void 0!==s?s:d.user,TaskDesc:c,Task:t},i.next=24,this.syncService.uploadTask(g);case 24:return e.isExported=!0,i.next=27,this.tasksDelegator.saveTask(e);case 27:return i.next=29,this.msgService.showToast(this.langProvider.TaskUploadedSuccessfuly,2e3,"toastSuccess");case 29:i.next=32;break;case 31:this.msgService.showToast(this.langProvider.TaskUploadDescMissing,1e3,"toastWarn");case 32:i.next=37;break;case 34:i.prev=34,i.t0=i.catch(1),this.msgService.showMessage(null==i.t0?void 0:i.t0.message,this.langProvider.ErrorUploadTask,"toastWarn"),this.popupCtrl.dismiss();case 37:return i.prev=37,r.dismiss(),i.finish(37);case 40:case"end":return i.stop()}},i,this,[[1,34,37,40]])}))}}]),e}(),N.\u0275fac=function(t){return new(t||N)(d.Kb(u.f),d.Kb(b.a),d.Kb(f.a),d.Kb(k.a),d.Kb(v.a),d.Kb(m.a),d.Kb(y.b),d.Kb(g.a),d.Kb(c.ib),d.Kb(c.cb),d.Kb(c.b),d.Kb(w.a))},N.\u0275cmp=d.Eb({type:N,selectors:[["app-tasks-history"]],viewQuery:function(t,e){var n;1&t&&d.yc(c.ab,1),2&t&&d.jc(n=d.Zb())&&(e.virtualScroll=n.first)},decls:1,vars:1,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[3,"direction",4,"ngIf"],["tasksTemplate",""],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slot","start",3,"ngModel","ngModelChange","ionChange"],[4,"ngFor","ngForOf","ngForTrackBy"],["slide",""],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"],["name","share-social","color","primary",1,"htBtn"],["button","",3,"click"],[1,"taskHistory"],["name","cloud-upload","color","primary","class","exportIcon",4,"ngIf"],[1,"ltr"],[3,"task","candidates"],["name","cloud-upload","color","primary",1,"exportIcon"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngFor","ngForOf"],["id","tasksGroup",1,"rtl"],[3,"tasksGroup","candidates"]],template:function(t,e){1&t&&d.qc(0,B,11,5,"ng-container",0),2&t&&d.gc("ngIf",e.isInit)},directives:[r.m,c.s,c.Z,c.n,c.k,c.F,c.X,c.j,c.t,c.N,c.lb,o.e,o.h,c.w,c.Y,c.c,c.C,r.l,c.B,c.A,c.z,P,c.D,r.p,R],pipes:[r.k,r.e],styles:[".taskHistory[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.htBtn[_ngcontent-%COMP%]{font-size:x-large}.exportIcon[_ngcontent-%COMP%]{margin-left:.2rem}"]}),N)}],_=((Y=function e(){t(this,e)}).\u0275fac=function(t){return new(t||Y)},Y.\u0275mod=d.Ib({type:Y}),Y.\u0275inj=d.Hb({imports:[[u.h.forChild(U)],u.h]}),Y),$=s("ajeZ"),z=((W=function e(){t(this,e)}).\u0275fac=function(t){return new(t||W)},W.\u0275mod=d.Ib({type:W}),W.\u0275inj=d.Hb({imports:[[r.c,o.a,c.bb,$.a,_]]}),W)}}])}();