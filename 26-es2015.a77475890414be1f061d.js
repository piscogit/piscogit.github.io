(window.webpackJsonp=window.webpackJsonp||[]).push([[26,27],{tEcr:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var o=n("mrSG"),r=n("kLqA"),i=n("fXoL"),s=n("L5fO"),a=n("TEn/"),d=n("ofXK");function c(e,t){if(1&e&&(i.Nb(0,"span"),i.pc(1),i.Mb()),2&e){const e=i.Xb();i.yb(1),i.sc("",e.langProvider.Comment,": ",e.comment.TaskDescRef.description,"")}}function m(e,t){if(1&e&&(i.Nb(0,"span"),i.pc(1),i.Mb()),2&e){const e=i.Xb();i.yb(1),i.qc(e.langProvider.GeneralComment)}}let l=(()=>{class e{constructor(e){this.langProvider=e}ngOnInit(){this.calcHistory()}calcHistory(){this.comment=this.task}}return e.\u0275fac=function(t){return new(t||e)(i.Ib(s.b))},e.\u0275cmp=i.Cb({type:e,selectors:[["app-comment-candidate-history"]],decls:12,vars:9,consts:[[1,"header"],[4,"ngIf","ngIfElse"],["elseNoTaskDesk",""],[2,"direction","ltr"],[1,"commentTxt"]],template:function(e,t){if(1&e&&(i.Lb(0),i.Nb(1,"ion-item"),i.Nb(2,"ion-label"),i.Nb(3,"div",0),i.nc(4,c,2,2,"span",1),i.nc(5,m,2,1,"ng-template",null,2,i.oc),i.Nb(7,"span",3),i.pc(8),i.Yb(9,"date"),i.Mb(),i.Mb(),i.Nb(10,"span",4),i.pc(11),i.Mb(),i.Mb(),i.Mb(),i.Kb()),2&e){const e=i.hc(6);i.yb(1),i.mc("direction",t.langProvider.LangDirection),i.yb(3),i.dc("ngIf",t.comment.TaskDescRef)("ngIfElse",e),i.yb(4),i.qc(i.ac(9,6,t.task.date,"dd/MM/yy HH:mm:ss")),i.yb(3),i.qc(null==t.comment?null:t.comment.comment)}},directives:[a.v,a.B,d.l],pipes:[d.d],styles:[".commentDate[_ngcontent-%COMP%]{font-size:.7rem;margin-bottom:.2rem;display:flex;justify-content:flex-end;color:var(--ion-color-medium)}.commentTxt[_ngcontent-%COMP%]{white-space:normal}.commentTask[_ngcontent-%COMP%]{margin-bottom:.2rem;color:var(--ion-color-tertiary)}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;color:var(--ion-color-medium)}"]}),e})();var h=n("h7jJ"),u=n("nbnm");let p=(()=>{class e{constructor(e,t){this.dataProvider=e,this.entityNamer=t,this.commentsPrefix="comments"}getAllTasks(){return Object(o.a)(this,void 0,void 0,(function*(){return yield this.dataProvider.getAllTasks()}))}mergeTasksAndCandidateComments(e,t){return Object(o.a)(this,void 0,void 0,(function*(){return[...e,...t].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())}))}buildTasksGroupsByType(e){return e.reduce((e,t,n)=>(e[t.type]||(e[t.type]=[]),e[t.type].push(t),e),{})}loadCandidateComments(e){return Object(o.a)(this,void 0,void 0,(function*(){const t=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}@${e}`;return yield this.dataProvider.loadEntitiesByPrefix(t)}))}loadComments(){return Object(o.a)(this,void 0,void 0,(function*(){const e=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}`;return(yield this.dataProvider.loadEntitiesByPrefix(e)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).reduce((e,t,n)=>{const o=e.length>0?e[e.length-1]:null,r=this.dataProvider.getCandidatesByIds([t.candidateId]);if(o&&t.comment===o.comment&&new Date(t.date).getTime()===o.date.getTime())e[e.length-1].candidates.push(...r),e[e.length-1].SavedComments.push(t);else{const n={comment:t.comment,candidates:r,date:new Date(t.date),SavedComments:[t],TaskDescRef:t.TaskDescRef};e.push(n)}return e},[])}))}deleteComments(e){return Object(o.a)(this,void 0,void 0,(function*(){yield this.dataProvider.deleteEntities(e)}))}createComment(e){var t;return Object(o.a)(this,void 0,void 0,(function*(){const n=[],o=null!==(t=e.date)&&void 0!==t?t:new Date,i=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}`;let s;s=e.TaskDescRef?e.TaskDescRef.type:"general";for(const t of e.candidates){const a={type:"comment",_id:`${i}@${t._id}@${s}@${r.Guid.raw()}`,date:o,candidateId:t._id,comment:e.comment,tags:e.tags,TaskDescRef:e.TaskDescRef};n.push(a)}return yield this.dataProvider.saveEntities(n)}))}getTaskConfig(e){throw new Error("Method not implemented.")}getTaskName(){throw new Error("Method not implemented.")}saveTask(e,t){throw new Error("Method not implemented.")}loadTask(e){throw new Error("Method not implemented.")}getTaskHistory(){throw new Error("Method not implemented.")}getComponent(){throw new Error("Method not implemented.")}getHistoryComponent(){throw new Error("Method not implemented.")}getCandidateHistoryComponent(){return l}getCandidateAggregateComponent(){throw new Error("Method not implemented.")}deleteTask(e){throw new Error("Method not implemented.")}getTasksForCandidates(e){throw new Error("Method not implemented.")}checkTaskEmpty(e,t){throw new Error("Method not implemented.")}}return e.\u0275fac=function(t){return new(t||e)(i.Rb(h.a),i.Rb(u.a))},e.\u0275prov=i.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);