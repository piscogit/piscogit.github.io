!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{OrUu:function(e,r,i){"use strict";i.r(r),i.d(r,"TasksHistoryPageModule",(function(){return H}));var s,a=i("ofXK"),o=i("3Pt+"),c=i("TEn/"),u=i("tyNb"),l=i("mrSG"),b=i("Mxx3"),p=i("fXoL"),h=i("zrcv"),d=((s=function(){function e(n,r){t(this,e),this.popupCtrl=n,this.msgService=r}return n(e,[{key:"ngOnInit",value:function(){}},{key:"copy",value:function(){var t=JSON.stringify(this.msg);this.msgService.copyToClipboard(t),this.msgService.showToast("Copy to clipboard",1e3),this.popupCtrl.dismiss()}},{key:"whatsapp",value:function(){var t=JSON.stringify(this.msg),e=document.createElement("a");e.href="whatsapp://send?text="+t,e["data-action"]="share/whatsapp/share",e.click(),this.popupCtrl.dismiss()}},{key:"upload",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.popupCtrl.dismiss("upload");case 1:case"end":return t.stop()}}),t,this)})))}}]),e}()).\u0275fac=function(t){return new(t||s)(p.Ib(c.Jb),p.Ib(h.a))},s.\u0275cmp=p.Cb({type:s,selectors:[["app-share-data"]],inputs:{msg:"msg"},decls:7,vars:0,consts:[[1,"container"],["color","light",3,"click"],["color","primary","name","copy",1,"sicon"],["color","primary","name","logo-whatsapp",1,"sicon"],["color","primary","name","cloud-upload",1,"sicon"]],template:function(t,e){1&t&&(p.Nb(0,"div",0),p.Nb(1,"ion-button",1),p.Vb("click",(function(){return e.copy()})),p.Jb(2,"ion-icon",2),p.Mb(),p.Nb(3,"ion-button",1),p.Vb("click",(function(){return e.whatsapp()})),p.Jb(4,"ion-icon",3),p.Mb(),p.Nb(5,"ion-button",1),p.Vb("click",(function(){return e.upload()})),p.Jb(6,"ion-icon",4),p.Mb(),p.Mb())},directives:[c.k,c.C],styles:[".container[_ngcontent-%COMP%]{display:flex}.sicon[_ngcontent-%COMP%]{font-size:x-large}"]}),s),f=i("3LWr"),g=i("ufmx"),v=i("NrBX"),k=i("o6Vy"),m=i("VYsW"),y=i("L5fO"),w=i("RybT"),C=i("VVJX");function x(t,e){}var T,M=((T=function(){function e(n,r){t(this,e),this.componentFactoryResolver=n,this.taskDelegatorFactory=r}return n(e,[{key:"ngOnInit",value:function(){var t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t),n=this.taskHost.viewContainerRef;n.clear();var r=n.createComponent(e);r.instance.task=this.task,r.instance.candidates=this.candidates,this.componentRef=r}}},{key:"ngOnChanges",value:function(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}]),e}()).\u0275fac=function(t){return new(t||T)(p.Ib(p.j),p.Ib(w.a))},T.\u0275cmp=p.Cb({type:T,selectors:[["app-task-history-host"]],viewQuery:function(t,e){var n;1&t&&p.mc(C.a,!0),2&t&&p.gc(n=p.Wb())&&(e.taskHost=n.first)},inputs:{task:"task",candidates:"candidates"},features:[p.wb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&p.oc(0,x,0,0,"ng-template",0)},directives:[C.a],styles:[""]}),T);function I(t,e){if(1&t){var n=p.Ob();p.Nb(0,"ion-button",6),p.Vb("click",(function(){return p.ic(n),p.Xb(3).showSearchbar(!0)})),p.Jb(1,"ion-icon",8),p.Mb()}}function O(t,e){if(1&t){var n=p.Ob();p.Lb(0),p.Nb(1,"ion-buttons",3),p.Jb(2,"ion-menu-button"),p.Mb(),p.Nb(3,"ion-title"),p.qc(4),p.Mb(),p.Nb(5,"ion-buttons",4),p.oc(6,I,2,0,"ion-button",5),p.Nb(7,"ion-button",6),p.Vb("click",(function(){return p.ic(n),p.Xb(2).showTaskFilters()})),p.Jb(8,"ion-icon",7),p.Mb(),p.Mb(),p.Kb()}if(2&t){var r=p.Xb(2);p.yb(3),p.nc("direction",r.langProvider.LangDirection),p.yb(1),p.rc(r.langProvider.TasksHistory),p.yb(2),p.dc("ngIf",!r.isShowSearchbar)}}function N(t,e){if(1&t){var n=p.Ob();p.Nb(0,"ion-searchbar",9),p.Vb("ngModelChange",(function(t){return p.ic(n),p.Xb(2).searchTaskStr=t}))("ionChange",(function(){return p.ic(n),p.Xb(2).updateSearchTask()}))("ionCancel",(function(){return p.ic(n),p.Xb(2).showSearchbar(!1)})),p.Mb()}if(2&t){var r=p.Xb(2);p.dc("ngModel",r.searchTaskStr)}}function S(t,e){if(1&t){var n=p.Ob();p.Nb(0,"ion-item-sliding",null,10),p.Yb(2,"lowercase"),p.Nb(3,"ion-item-options",11),p.Nb(4,"ion-item-option",12),p.Vb("click",(function(){p.ic(n);var t=e.$implicit,r=p.hc(1);return p.Xb(2).onDeleted(t,r)})),p.Jb(5,"ion-icon",13),p.Mb(),p.Nb(6,"ion-item-option",12),p.Vb("click",(function(t){p.ic(n);var r=e.$implicit,i=p.hc(1);return p.Xb(2).onCopyExport(r,i,t)})),p.Jb(7,"ion-icon",14),p.Mb(),p.Mb(),p.Nb(8,"ion-item",15),p.Vb("click",(function(){p.ic(n);var t=e.$implicit;return p.Xb(2).onEdit(t)})),p.Nb(9,"ion-label"),p.Nb(10,"h3",16),p.Nb(11,"span"),p.qc(12),p.Mb(),p.Nb(13,"span",17),p.qc(14),p.Yb(15,"date"),p.Mb(),p.Mb(),p.Jb(16,"app-task-history-host",18),p.Mb(),p.Mb(),p.Mb()}if(2&t){var r=e.$implicit,i=p.Xb(2);p.zb("track",p.Zb(2,7,r.type)),p.yb(9),p.nc("direction",i.langProvider.LangDirection),p.yb(3),p.rc(r.name),p.yb(2),p.rc(p.ac(15,9,r.date,"dd/MM/yy HH:mm:ss")),p.yb(2),p.dc("task",r)("candidates",i.candidates)}}function D(t,e){if(1&t&&(p.Lb(0),p.Nb(1,"ion-header"),p.Nb(2,"ion-toolbar"),p.oc(3,O,9,4,"ng-container",0),p.oc(4,N,1,1,"ion-searchbar",1),p.Mb(),p.Mb(),p.Nb(5,"ion-content"),p.Nb(6,"ion-list"),p.oc(7,S,17,12,"ion-item-sliding",2),p.Mb(),p.Mb(),p.Kb()),2&t){var n=p.Xb();p.yb(3),p.dc("ngIf",!n.isShowSearchbar),p.yb(1),p.dc("ngIf",n.isShowSearchbar),p.yb(3),p.dc("ngForOf",n.tasksHistory)("ngForTrackBy",n.trackByFn)}}var R,P,F,j=[{path:"",component:(R=function(){function e(n,r,i,s,a,o,c,u,l,b,p,h){t(this,e),this.router=n,this.store=r,this.candidatesDelegator=i,this.tasksDelegator=s,this.syncService=a,this.appContext=o,this.langProvider=c,this.msgService=u,this.popupCtrl=l,this.loadingCtrl=b,this.alertController=p,this.taskDelegatorFactory=h,this.subscription={},this.isInit=!1}return n(e,[{key:"ngOnInit",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.candidatesDelegator.getCandidatesCopy();case 2:this.candidates=t.sent,this.subscription.lastTasksChangeTime=this.store.lastTasksChangeTime.subscribe((function(t){return Object(l.a)(e,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.loadTasks();case 1:case"end":return t.stop()}}),t,this)})))})),this.isInit=!0;case 5:case"end":return t.stop()}}),t,this)})))}},{key:"ngOnDestroy",value:function(){for(var t in this.subscription)Object.prototype.hasOwnProperty.call(this.subscription,t)&&this.subscription[t].unsubscribe()}},{key:"ionViewWillEnter",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))}},{key:"loadTasks",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.msgService.showLoader();case 3:return e=t.sent,t.next=6,this.tasksDelegator.getAllTasks();case 6:n=t.sent.sort((function(t,e){var n=new Date(t.date).getTime();return new Date(e.date).getTime()-n})),this.tasksHistory=n;case 8:return t.prev=8,e.dismiss(),t.finish(8);case 11:case"end":return t.stop()}}),t,this,[[0,,8,11]])})))}},{key:"onEdit",value:function(t){var e=this.taskDelegatorFactory.getTaskDelegator(t.type),n={};n[b.a.TaskDescId]=t.taskId,n[b.a.SavedTaskId]=t._id;var r={Path:"tabs/tasks/"+e.getComponentRoute(),Params:n,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(r),this.router.navigate([r.Path,r.Params],r.NavigationExtras)}},{key:"onCopyExport",value:function(t,e,n){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,s,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=this.taskDelegatorFactory.getTaskDelegator(t.type),r.prev=1,r.next=4,i.exportCopy(t._id,t.taskId);case 4:return s=r.sent,r.next=7,this.popupCtrl.create({component:d,event:n,componentProps:{msg:s}});case 7:return a=r.sent,r.next=10,a.present();case 10:return r.next=12,a.onWillDismiss();case 12:if(r.t0=r.sent.data,r.t1="upload"===r.t0,!r.t1){r.next=16;break}this.uploadTask(s);case 16:r.next=21;break;case 18:r.prev=18,r.t2=r.catch(1),this.msgService.showToast("Cant export this task type to clipboard",1e3,"toastWarn");case 21:e.closeOpened();case 22:case"end":return r.stop()}}),r,this,[[1,18]])})))}},{key:"onDeleted",value:function(t,e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,i,s,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.closeOpened(),r=!1,n.next=4,this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:function(){return r=!0}}]});case 4:return i=n.sent,n.next=7,i.present();case 7:return n.next=9,i.onWillDismiss();case 9:if(!r){n.next=24;break}return s=this.taskDelegatorFactory.getTaskDelegator(t.type),n.next=13,this.loadingCtrl.create({message:"temp delete task"});case 13:return a=n.sent,n.next=16,a.present();case 16:return n.next=18,s.deleteTask(t);case 18:return n.next=20,this.loadTasks();case 20:return n.next=22,a.dismiss();case 22:return n.next=24,a.onDidDismiss();case 24:case"end":return n.stop()}}),n,this)})))}},{key:"showSearchbar",value:function(t){}},{key:"showTaskFilters",value:function(){}},{key:"updateSearchTask",value:function(){}},{key:"trackByFn",value:function(t,e){return e?e._id:t}},{key:"temp",value:function(t){console.log(t._id)}},{key:"uploadTask",value:function(t){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.popupCtrl.dismiss("upload"),e.prev=1,e.next=4,this.msgService.showLoader();case 4:return n=e.sent,r=this.appContext.getAppContext(),i={ActivationCode:r.activationCode,User:r.user,Task:t},e.next=8,this.syncService.uploadTask(i);case 8:return e.next=10,this.msgService.showToast(this.langProvider.TaskUploadedSuccessfuly,2e3,"toastSuccess");case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.msgService.showMessage(null==e.t0?void 0:e.t0.message,this.langProvider.ErrorUploadTask,"toastWarn"),this.popupCtrl.dismiss();case 15:return e.prev=15,n.dismiss(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])})))}}]),e}(),R.\u0275fac=function(t){return new(t||R)(p.Ib(u.f),p.Ib(f.a),p.Ib(g.a),p.Ib(v.a),p.Ib(k.a),p.Ib(m.a),p.Ib(y.b),p.Ib(h.a),p.Ib(c.Jb),p.Ib(c.Cb),p.Ib(c.b),p.Ib(w.a))},R.\u0275cmp=p.Cb({type:R,selectors:[["app-tasks-history"]],viewQuery:function(t,e){var n;1&t&&p.wc(c.Ab,!0),2&t&&p.gc(n=p.Wb())&&(e.virtualScroll=n.first)},decls:1,vars:1,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slide",""],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"],["name","share-social","color","primary",1,"htBtn"],["button","",3,"click"],[1,"taskHistory"],[2,"direction","ltr"],[3,"task","candidates"]],template:function(t,e){1&t&&p.oc(0,D,8,4,"ng-container",0),2&t&&p.dc("ngIf",e.isInit)},directives:[a.t,c.B,c.zb,c.u,c.O,a.s,c.l,c.R,c.xb,c.k,c.C,c.hb,c.Nb,o.j,o.m,c.M,c.L,c.K,c.H,c.N,M],pipes:[a.p,a.f],styles:[".taskHistory[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.htBtn[_ngcontent-%COMP%]{font-size:x-large}"]}),R)}],J=((P=function e(){t(this,e)}).\u0275mod=p.Gb({type:P}),P.\u0275inj=p.Fb({factory:function(t){return new(t||P)},imports:[[u.j.forChild(j)],u.j]}),P),X=i("ajeZ"),H=((F=function e(){t(this,e)}).\u0275mod=p.Gb({type:F}),F.\u0275inj=p.Fb({factory:function(t){return new(t||F)},imports:[[a.c,o.e,c.Bb,X.a,J]]}),F)}}])}();