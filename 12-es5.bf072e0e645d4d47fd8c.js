!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{OrUu:function(e,s,a){"use strict";a.r(s),a.d(s,"TasksHistoryPageModule",function(){return H});var r,i=a("ofXK"),o=a("3Pt+"),c=a("TEn/"),u=a("tyNb"),l=a("mrSG"),p=a("Mxx3"),b=a("fXoL"),h=a("zrcv"),d=((r=function(){function e(n,s){t(this,e),this.popupCtrl=n,this.msgService=s}return n(e,[{key:"ngOnInit",value:function(){}},{key:"copy",value:function(){var t=JSON.stringify(this.msg);this.msgService.copyToClipboard(t),this.msgService.showToast("Copy to clipboard",1e3),this.popupCtrl.dismiss()}},{key:"whatsapp",value:function(){var t=JSON.stringify(this.msg),e=document.createElement("a");e.href="whatsapp://send?text=".concat(t),e["data-action"]="share/whatsapp/share",e.click(),this.popupCtrl.dismiss()}},{key:"upload",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.popupCtrl.dismiss("upload");case 1:case"end":return t.stop()}},t,this)}))}}]),e}()).\u0275fac=function(t){return new(t||r)(b.Kb(c.ib),b.Kb(h.a))},r.\u0275cmp=b.Eb({type:r,selectors:[["app-share-data"]],inputs:{msg:"msg"},decls:7,vars:0,consts:[[1,"container"],["color","light",3,"click"],["color","primary","name","copy",1,"sicon"],["color","primary","name","logo-whatsapp",1,"sicon"],["color","primary","name","cloud-upload",1,"sicon"]],template:function(t,e){1&t&&(b.Pb(0,"div",0),b.Pb(1,"ion-button",1),b.Xb("click",function(){return e.copy()}),b.Lb(2,"ion-icon",2),b.Ob(),b.Pb(3,"ion-button",1),b.Xb("click",function(){return e.whatsapp()}),b.Lb(4,"ion-icon",3),b.Ob(),b.Pb(5,"ion-button",1),b.Xb("click",function(){return e.upload()}),b.Lb(6,"ion-icon",4),b.Ob(),b.Ob())},directives:[c.j,c.t],styles:[".container[_ngcontent-%COMP%]{display:flex}.sicon[_ngcontent-%COMP%]{font-size:x-large}"]}),r),f=a("3LWr"),g=a("ufmx"),v=a("NrBX"),k=a("o6Vy"),m=a("VYsW"),y=a("L5fO"),x=a("RybT"),w=a("VVJX");function C(t,e){}var P,O=((P=function(){function e(n,s){t(this,e),this.componentFactoryResolver=n,this.taskDelegatorFactory=s}return n(e,[{key:"ngOnInit",value:function(){var t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){var e=this.componentFactoryResolver.resolveComponentFactory(t),n=this.taskHost.viewContainerRef;n.clear();var s=n.createComponent(e);s.instance.task=this.task,s.instance.candidates=this.candidates,this.componentRef=s}}},{key:"ngOnChanges",value:function(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}]),e}()).\u0275fac=function(t){return new(t||P)(b.Kb(b.k),b.Kb(x.a))},P.\u0275cmp=b.Eb({type:P,selectors:[["app-task-history-host"]],viewQuery:function(t,e){var n;1&t&&b.xc(w.a,3),2&t&&b.ic(n=b.Yb())&&(e.taskHost=n.first)},inputs:{task:"task",candidates:"candidates"},features:[b.yb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&b.pc(0,C,0,0,"ng-template",0)},directives:[w.a],styles:[""]}),P);function T(t,e){if(1&t){var n=b.Qb();b.Pb(0,"ion-button",6),b.Xb("click",function(){return b.kc(n),b.Zb(3).showSearchbar(!0)}),b.Lb(1,"ion-icon",8),b.Ob()}}function D(t,e){if(1&t){var n=b.Qb();b.Nb(0),b.Pb(1,"ion-buttons",3),b.Lb(2,"ion-menu-button"),b.Ob(),b.Pb(3,"ion-title"),b.rc(4),b.Ob(),b.Pb(5,"ion-buttons",4),b.pc(6,T,2,0,"ion-button",5),b.Pb(7,"ion-button",6),b.Xb("click",function(){return b.kc(n),b.Zb(2).showTaskFilters()}),b.Lb(8,"ion-icon",7),b.Ob(),b.Ob(),b.Mb()}if(2&t){var s=b.Zb(2);b.Ab(3),b.oc("direction",s.langProvider.LangDirection),b.Ab(1),b.sc(s.langProvider.TasksHistory),b.Ab(2),b.fc("ngIf",!s.isShowSearchbar)}}function S(t,e){if(1&t){var n=b.Qb();b.Pb(0,"ion-searchbar",9),b.Xb("ngModelChange",function(t){return b.kc(n),b.Zb(2).searchTaskStr=t})("ionChange",function(){return b.kc(n),b.Zb(2).updateSearchTask()})("ionCancel",function(){return b.kc(n),b.Zb(2).showSearchbar(!1)}),b.Ob()}if(2&t){var s=b.Zb(2);b.fc("ngModel",s.searchTaskStr)}}function R(t,e){1&t&&b.Lb(0,"ion-icon",20)}function I(t,e){if(1&t){var n=b.Qb();b.Pb(0,"ion-item-sliding",null,10),b.ac(2,"lowercase"),b.Pb(3,"ion-item-options",11),b.Pb(4,"ion-item-option",12),b.Xb("click",function(){b.kc(n);var t=e.$implicit,s=b.jc(1);return b.Zb(2).onDeleted(t,s)}),b.Lb(5,"ion-icon",13),b.Ob(),b.Pb(6,"ion-item-option",12),b.Xb("click",function(t){b.kc(n);var s=e.$implicit,a=b.jc(1);return b.Zb(2).onCopyExport(s,a,t)}),b.Lb(7,"ion-icon",14),b.Ob(),b.Ob(),b.Pb(8,"ion-item",15),b.Xb("click",function(){b.kc(n);var t=e.$implicit;return b.Zb(2).onEdit(t)}),b.Pb(9,"ion-label"),b.Pb(10,"h3",16),b.Pb(11,"div",16),b.pc(12,R,1,0,"ion-icon",17),b.Pb(13,"span"),b.rc(14),b.Ob(),b.Ob(),b.Pb(15,"span",18),b.rc(16),b.ac(17,"date"),b.Ob(),b.Ob(),b.Lb(18,"app-task-history-host",19),b.Ob(),b.Ob(),b.Ob()}if(2&t){var s=e.$implicit,a=b.Zb(2);b.Bb("track",b.bc(2,8,s.type)),b.Ab(9),b.oc("direction",a.langProvider.LangDirection),b.Ab(3),b.fc("ngIf",s.isExported),b.Ab(2),b.sc(s.name),b.Ab(2),b.sc(b.cc(17,10,s.date,"dd/MM/yy HH:mm:ss")),b.Ab(2),b.fc("task",s)("candidates",a.candidates)}}function L(t,e){if(1&t&&(b.Nb(0),b.Pb(1,"ion-header"),b.Pb(2,"ion-toolbar"),b.pc(3,D,9,4,"ng-container",0),b.pc(4,S,1,1,"ion-searchbar",1),b.Ob(),b.Ob(),b.Pb(5,"ion-content"),b.Pb(6,"ion-list"),b.pc(7,I,19,13,"ion-item-sliding",2),b.Ob(),b.Ob(),b.Mb()),2&t){var n=b.Zb();b.Ab(3),b.fc("ngIf",!n.isShowSearchbar),b.Ab(1),b.fc("ngIf",n.isShowSearchbar),b.Ab(3),b.fc("ngForOf",n.tasksHistory)("ngForTrackBy",n.trackByFn)}}var M,F,j,A=[{path:"",component:(M=function(){function e(n,s,a,r,i,o,c,u,l,p,b,h){t(this,e),this.router=n,this.store=s,this.candidatesDelegator=a,this.tasksDelegator=r,this.syncService=i,this.appContext=o,this.langProvider=c,this.msgService=u,this.popupCtrl=l,this.loadingCtrl=p,this.alertController=b,this.taskDelegatorFactory=h,this.subscription={},this.isInit=!1}return n(e,[{key:"ngOnInit",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.candidatesDelegator.getCandidatesCopy();case 2:this.candidates=t.sent,this.subscription.lastTasksChangeTime=this.store.lastTasksChangeTime.subscribe(function(t){return Object(l.a)(e,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loadTasks();case 1:case"end":return t.stop()}},t,this)}))}),this.isInit=!0;case 5:case"end":return t.stop()}},t,this)}))}},{key:"ngOnDestroy",value:function(){for(var t in this.subscription)Object.prototype.hasOwnProperty.call(this.subscription,t)&&this.subscription[t].unsubscribe()}},{key:"ionViewWillEnter",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)}))}},{key:"loadTasks",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.msgService.showLoader();case 3:return e=t.sent,t.next=6,this.tasksDelegator.getAllTasks();case 6:n=t.sent.sort(function(t,e){var n=new Date(t.date).getTime();return new Date(e.date).getTime()-n}),this.tasksHistory=n;case 8:return t.prev=8,e.dismiss(),t.finish(8);case 11:case"end":return t.stop()}},t,this,[[0,,8,11]])}))}},{key:"onEdit",value:function(t){var e=this.taskDelegatorFactory.getTaskDelegator(t.type),n={};n[p.a.TaskDescId]=t.taskId,n[p.a.SavedTaskId]=t._id;var s={Path:"tabs/tasks/".concat(e.getComponentRoute()),Params:n,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(s),this.router.navigate([s.Path,s.Params],s.NavigationExtras)}},{key:"onCopyExport",value:function(t,e,n){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function s(){var a,r,i;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=this.taskDelegatorFactory.getTaskDelegator(t.type),s.prev=1,s.next=4,a.exportCopy(t._id,t.taskId);case 4:return r=s.sent,s.next=7,this.popupCtrl.create({component:d,event:n,componentProps:{msg:r}});case 7:return i=s.sent,s.next=10,i.present();case 10:return s.next=12,i.onWillDismiss();case 12:if(s.t0=s.sent.data,s.t1="upload"===s.t0,!s.t1){s.next=16;break}this.uploadTask(r,t);case 16:s.next=21;break;case 18:s.prev=18,s.t2=s.catch(1),this.msgService.showToast("Cant export this task",1e3,"toastWarn");case 21:e.closeOpened();case 22:case"end":return s.stop()}},s,this,[[1,18]])}))}},{key:"onDeleted",value:function(t,e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var s,a,r,i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.closeOpened(),s=!1,n.next=4,this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:function(){return s=!0}}]});case 4:return a=n.sent,n.next=7,a.present();case 7:return n.next=9,a.onWillDismiss();case 9:if(!s){n.next=24;break}return r=this.taskDelegatorFactory.getTaskDelegator(t.type),n.next=13,this.loadingCtrl.create({message:"temp delete task"});case 13:return i=n.sent,n.next=16,i.present();case 16:return n.next=18,r.deleteTask(t);case 18:return n.next=20,this.loadTasks();case 20:return n.next=22,i.dismiss();case 22:return n.next=24,i.onDidDismiss();case 24:case"end":return n.stop()}},n,this)}))}},{key:"showSearchbar",value:function(t){}},{key:"showTaskFilters",value:function(){}},{key:"updateSearchTask",value:function(){}},{key:"trackByFn",value:function(t,e){return e?e._id:t}},{key:"temp",value:function(t){console.log(t._id)}},{key:"uploadTask",value:function(t,e){var n,s,a;return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function r(){var i,o,c,u,l,p,b,h;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.popupCtrl.dismiss("upload"),r.prev=1,o=!0,c=null,r.next=5,this.tasksDelegator.getCategoryConfig();case 5:if(u=r.sent.isNoTaskUploadWithDesc){r.next=16;break}return r.next=9,this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.TaskUpload,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"activate",cssClass:"danger"}],inputs:[{name:"taskDesc",type:"text",placeholder:this.langProvider.TaskUploadDesc}]});case 9:return l=r.sent,r.next=12,l.present();case 12:return r.next=14,l.onWillDismiss();case 14:p=r.sent,o="activate"===p.role,c=null===(s=null===(n=p.data)||void 0===n?void 0:n.values)||void 0===s?void 0:s.taskDesc;case 16:if(!o){r.next=32;break}if(!u&&!c){r.next=31;break}return r.next=20,this.msgService.showLoader();case 20:return i=r.sent,b=this.appContext.getAppContext(),h={ActivationCode:b.activationCode,User:b.user,UserDesc:null!==(a=b.userDesc)&&void 0!==a?a:b.user,TaskDesc:c,Task:t},r.next=24,this.syncService.uploadTask(h);case 24:return e.isExported=!0,r.next=27,this.tasksDelegator.saveTask(e);case 27:return r.next=29,this.msgService.showToast(this.langProvider.TaskUploadedSuccessfuly,2e3,"toastSuccess");case 29:r.next=32;break;case 31:this.msgService.showToast(this.langProvider.TaskUploadDescMissing,1e3,"toastWarn");case 32:r.next=37;break;case 34:r.prev=34,r.t0=r.catch(1),this.msgService.showMessage(null==r.t0?void 0:r.t0.message,this.langProvider.ErrorUploadTask,"toastWarn"),this.popupCtrl.dismiss();case 37:return r.prev=37,i.dismiss(),r.finish(37);case 40:case"end":return r.stop()}},r,this,[[1,34,37,40]])}))}}]),e}(),M.\u0275fac=function(t){return new(t||M)(b.Kb(u.f),b.Kb(f.a),b.Kb(g.a),b.Kb(v.a),b.Kb(k.a),b.Kb(m.a),b.Kb(y.b),b.Kb(h.a),b.Kb(c.ib),b.Kb(c.cb),b.Kb(c.b),b.Kb(x.a))},M.\u0275cmp=b.Eb({type:M,selectors:[["app-tasks-history"]],viewQuery:function(t,e){var n;1&t&&b.xc(c.ab,1),2&t&&b.ic(n=b.Yb())&&(e.virtualScroll=n.first)},decls:1,vars:1,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slide",""],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"],["name","share-social","color","primary",1,"htBtn"],["button","",3,"click"],[1,"taskHistory"],["name","cloud-upload","color","primary","class","exportIcon",4,"ngIf"],[2,"direction","ltr"],[3,"task","candidates"],["name","cloud-upload","color","primary",1,"exportIcon"]],template:function(t,e){1&t&&b.pc(0,L,8,4,"ng-container",0),2&t&&b.fc("ngIf",e.isInit)},directives:[i.m,c.s,c.Z,c.n,c.D,i.l,c.k,c.F,c.X,c.j,c.t,c.N,c.lb,o.e,o.h,c.B,c.A,c.z,c.w,c.C,O],pipes:[i.k,i.e],styles:[".taskHistory[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.htBtn[_ngcontent-%COMP%]{font-size:x-large}.exportIcon[_ngcontent-%COMP%]{margin-left:.2rem}"]}),M)}],K=((F=function e(){t(this,e)}).\u0275fac=function(t){return new(t||F)},F.\u0275mod=b.Ib({type:F}),F.\u0275inj=b.Hb({imports:[[u.h.forChild(A)],u.h]}),F),E=a("ajeZ"),H=((j=function e(){t(this,e)}).\u0275fac=function(t){return new(t||j)},j.\u0275mod=b.Ib({type:j}),j.\u0275inj=b.Hb({imports:[[i.c,o.a,c.bb,E.a,K]]}),j)}}])}();