(window.webpackJsonp=window.webpackJsonp||[]).push([[9,26,27],{OrUu:function(t,e,n){"use strict";n.r(e),n.d(e,"TasksHistoryPageModule",(function(){return D}));var o=n("ofXK"),s=n("3Pt+"),i=n("TEn/"),a=n("tyNb"),r=n("mrSG"),c=n("Mxx3"),d=n("fXoL"),l=n("3LWr"),b=n("h7jJ"),m=n("L5fO"),h=n("zrcv"),u=n("RybT"),f=n("VVJX");function g(t,e){}let p=(()=>{class t{constructor(t,e){this.componentFactoryResolver=t,this.taskDelegatorFactory=e}ngOnInit(){const t=this.taskDelegatorFactory.getTaskDelegator(this.task.type).getHistoryComponent();if(t){const e=this.componentFactoryResolver.resolveComponentFactory(t),n=this.taskHost.viewContainerRef;n.clear();const o=n.createComponent(e);o.instance.task=this.task,o.instance.candidates=this.candidates,this.componentRef=o}}ngOnChanges(t){this.componentRef&&(this.componentRef.instance.task=this.task,this.componentRef.instance.candidates=this.candidates,this.componentRef.instance.calcHistory())}}return t.\u0275fac=function(e){return new(e||t)(d.Ib(d.j),d.Ib(u.a))},t.\u0275cmp=d.Cb({type:t,selectors:[["app-task-history-host"]],viewQuery:function(t,e){var n;1&t&&d.lc(f.a,!0),2&t&&d.gc(n=d.Wb())&&(e.taskHost=n.first)},inputs:{task:"task",candidates:"candidates"},features:[d.wb],decls:1,vars:0,consts:[["appTaskHost",""]],template:function(t,e){1&t&&d.nc(0,g,0,0,"ng-template",0)},directives:[f.a],styles:[""]}),t})();function y(t,e){if(1&t){const t=d.Ob();d.Nb(0,"ion-button",7),d.Vb("click",(function(){return d.ic(t),d.Xb(2).showSearchbar(!0)})),d.Jb(1,"ion-icon",9),d.Mb()}}function k(t,e){if(1&t){const t=d.Ob();d.Lb(0),d.Nb(1,"ion-buttons",4),d.Jb(2,"ion-menu-button"),d.Mb(),d.Nb(3,"ion-title"),d.pc(4),d.Mb(),d.Nb(5,"ion-buttons",5),d.nc(6,y,2,0,"ion-button",6),d.Nb(7,"ion-button",7),d.Vb("click",(function(){return d.ic(t),d.Xb().showTaskFilters()})),d.Jb(8,"ion-icon",8),d.Mb(),d.Mb(),d.Kb()}if(2&t){const t=d.Xb();d.yb(3),d.mc("direction",t.langProvider.LangDirection),d.yb(1),d.qc(t.langProvider.TasksHistory),d.yb(2),d.dc("ngIf",!t.isShowSearchbar)}}function v(t,e){if(1&t){const t=d.Ob();d.Nb(0,"ion-searchbar",10),d.Vb("ngModelChange",(function(e){return d.ic(t),d.Xb().searchTaskStr=e}))("ionChange",(function(){return d.ic(t),d.Xb().updateSearchTask()}))("ionCancel",(function(){return d.ic(t),d.Xb().showSearchbar(!1)})),d.Mb()}if(2&t){const t=d.Xb();d.dc("ngModel",t.searchTaskStr)}}function w(t,e){if(1&t){const t=d.Ob();d.Nb(0,"div"),d.Nb(1,"ion-item-sliding",null,11),d.Yb(3,"lowercase"),d.Nb(4,"ion-item-options",12),d.Nb(5,"ion-item-option",13),d.Vb("click",(function(){d.ic(t);const n=e.$implicit,o=d.hc(2);return d.Xb().onDeleted(n,o)})),d.Jb(6,"ion-icon",14),d.Mb(),d.Mb(),d.Nb(7,"ion-item",15),d.Vb("click",(function(){d.ic(t);const n=e.$implicit;return d.Xb().onEdit(n)})),d.Nb(8,"ion-label"),d.Nb(9,"h3",16),d.Nb(10,"span"),d.pc(11),d.Mb(),d.Nb(12,"span",17),d.pc(13),d.Yb(14,"date"),d.Mb(),d.Mb(),d.Jb(15,"app-task-history-host",18),d.Mb(),d.Mb(),d.Mb(),d.Mb()}if(2&t){const t=e.$implicit,n=d.Xb();d.yb(1),d.zb("track",d.Zb(3,7,t.type)),d.yb(7),d.mc("direction",n.langProvider.LangDirection),d.yb(3),d.qc(t.name),d.yb(2),d.qc(d.ac(14,9,t.date,"dd/MM/yy HH:mm:ss")),d.yb(2),d.dc("task",t)("candidates",n.candidates)}}const T=[{path:"",component:(()=>{class t{constructor(t,e,n,o,s,i,a,r){this.router=t,this.store=e,this.dataProvider=n,this.langProvider=o,this.msgService=s,this.loadingCtrl=i,this.alertController=a,this.taskDelegatorFactory=r}ngOnInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.candidates=this.dataProvider.getCandidatesCopy()}))}ionViewWillEnter(){return Object(r.a)(this,void 0,void 0,(function*(){yield this.loadTasks()}))}loadTasks(){return Object(r.a)(this,void 0,void 0,(function*(){let t;try{t=yield this.msgService.showLoader();const e=(yield this.dataProvider.getAllTasks()).sort((t,e)=>{const n=new Date(t.date).getTime();return new Date(e.date).getTime()-n});this.tasksHistory=e}finally{t.dismiss()}}))}onEdit(t){const e={};e[c.a.TaskDescId]=t.taskId,e[c.a.SavedTaskId]=t._id;const n={Path:"tabs/tasks/"+t.type.toLowerCase(),Params:e,NavigationExtras:{skipLocationChange:!0,replaceUrl:!0}};this.store.lastTaskNavData.next(n),this.router.navigate([n.Path,n.Params],n.NavigationExtras)}onDeleted(t,e){return Object(r.a)(this,void 0,void 0,(function*(){e.closeOpened();let n=!1;const o=yield this.alertController.create({cssClass:[this.langProvider.LangDirection],header:this.langProvider.AreYouSure,subHeader:this.langProvider.TaskDeleteWarnMsg,buttons:[{text:this.langProvider.Cancel,role:"cancel",cssClass:"secondary"},{text:this.langProvider.Activate,role:"destructive",cssClass:"danger",handler:()=>n=!0}]});if(yield o.present(),yield o.onWillDismiss(),n){const e=this.taskDelegatorFactory.getTaskDelegator(t.type),n=yield this.loadingCtrl.create({message:"temp delete task"});yield n.present(),yield e.deleteTask(t),yield this.loadTasks(),yield n.dismiss(),yield n.onDidDismiss()}}))}showSearchbar(t){}showTaskFilters(){}updateSearchTask(){}trackByFn(t,e){return e?e._id:t}temp(t){console.log(t._id)}}return t.\u0275fac=function(e){return new(e||t)(d.Ib(a.g),d.Ib(l.a),d.Ib(b.a),d.Ib(m.b),d.Ib(h.a),d.Ib(i.ab),d.Ib(i.b),d.Ib(u.a))},t.\u0275cmp=d.Cb({type:t,selectors:[["app-tasks-history"]],viewQuery:function(t,e){var n;1&t&&d.tc(i.X,!0),2&t&&d.gc(n=d.Wb())&&(e.virtualScroll=n.first)},decls:7,vars:4,consts:[[4,"ngIf"],["class","searchbar","showCancelButton","always",3,"ngModel","ngModelChange","ionChange","ionCancel",4,"ngIf"],[3,"items","trackBy"],[4,"virtualItem"],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","icon-only","name","search"],["showCancelButton","always",1,"searchbar",3,"ngModel","ngModelChange","ionChange","ionCancel"],["slide",""],["side","end"],["color","danger",3,"click"],["name","trash",1,"deletedBtn"],["button","",3,"click"],[1,"taskHistory"],[2,"direction","ltr"],[3,"task","candidates"]],template:function(t,e){1&t&&(d.Nb(0,"ion-header"),d.Nb(1,"ion-toolbar"),d.nc(2,k,9,4,"ng-container",0),d.nc(3,v,1,1,"ion-searchbar",1),d.Mb(),d.Mb(),d.Nb(4,"ion-content"),d.Nb(5,"ion-virtual-scroll",2),d.nc(6,w,16,12,"div",3),d.Mb(),d.Mb()),2&t&&(d.yb(2),d.dc("ngIf",!e.isShowSearchbar),d.yb(1),d.dc("ngIf",e.isShowSearchbar),d.yb(2),d.dc("items",e.tasksHistory)("trackBy",e.trackByFn))},directives:[i.r,i.W,o.l,i.n,i.X,i.jb,i.k,i.E,i.U,i.j,i.s,i.K,i.hb,s.d,s.g,i.A,i.z,i.y,i.v,i.B,p],pipes:[o.j,o.d],styles:[".taskHistory[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.deletedBtn[_ngcontent-%COMP%]{font-size:large}"]}),t})()}];let C=(()=>{class t{}return t.\u0275mod=d.Gb({type:t}),t.\u0275inj=d.Fb({factory:function(e){return new(e||t)},imports:[[a.i.forChild(T)],a.i]}),t})();var M=n("ajeZ");let D=(()=>{class t{}return t.\u0275mod=d.Gb({type:t}),t.\u0275inj=d.Fb({factory:function(e){return new(e||t)},imports:[[o.b,s.a,i.Y,M.a,C]]}),t})()},RybT:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n("fXoL"),s=n("pQKU"),i=n("Gwuq"),a=n("TtBN"),r=n("tEcr");let c=(()=>{class t{constructor(t,e,n,o){this.basketDelegator=t,this.formsDelegator=e,this.orderedDelegator=n,this.tasksDelegator=o}getTaskDelegator(t){let e;switch(t.toLowerCase()){case"baskets":e=this.basketDelegator;break;case"forms":e=this.formsDelegator;break;case"ordered":e=this.orderedDelegator;break;case"comment":e=this.tasksDelegator;break;default:throw new Error(`Task delegator for type: ${t} does not exist !!!`)}return e}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(s.a),o.Rb(i.a),o.Rb(a.a),o.Rb(r.a))},t.\u0275prov=o.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},VVJX:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n("fXoL");let s=(()=>{class t{constructor(t){this.viewContainerRef=t}}return t.\u0275fac=function(e){return new(e||t)(o.Ib(o.O))},t.\u0275dir=o.Db({type:t,selectors:[["","appTaskHost",""]]}),t})()},tEcr:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var o=n("mrSG"),s=n("kLqA"),i=n("fXoL"),a=n("L5fO"),r=n("TEn/"),c=n("ofXK");function d(t,e){if(1&t&&(i.Nb(0,"span"),i.pc(1),i.Mb()),2&t){const t=i.Xb();i.yb(1),i.sc("",t.langProvider.Comment,": ",t.comment.TaskDescRef.description,"")}}function l(t,e){if(1&t&&(i.Nb(0,"span"),i.pc(1),i.Mb()),2&t){const t=i.Xb();i.yb(1),i.qc(t.langProvider.GeneralComment)}}let b=(()=>{class t{constructor(t){this.langProvider=t}ngOnInit(){this.calcHistory()}calcHistory(){this.comment=this.task}}return t.\u0275fac=function(e){return new(e||t)(i.Ib(a.b))},t.\u0275cmp=i.Cb({type:t,selectors:[["app-comment-candidate-history"]],decls:12,vars:9,consts:[[1,"header"],[4,"ngIf","ngIfElse"],["elseNoTaskDesk",""],[2,"direction","ltr"],[1,"commentTxt"]],template:function(t,e){if(1&t&&(i.Lb(0),i.Nb(1,"ion-item"),i.Nb(2,"ion-label"),i.Nb(3,"div",0),i.nc(4,d,2,2,"span",1),i.nc(5,l,2,1,"ng-template",null,2,i.oc),i.Nb(7,"span",3),i.pc(8),i.Yb(9,"date"),i.Mb(),i.Mb(),i.Nb(10,"span",4),i.pc(11),i.Mb(),i.Mb(),i.Mb(),i.Kb()),2&t){const t=i.hc(6);i.yb(1),i.mc("direction",e.langProvider.LangDirection),i.yb(3),i.dc("ngIf",e.comment.TaskDescRef)("ngIfElse",t),i.yb(4),i.qc(i.ac(9,6,e.task.date,"dd/MM/yy HH:mm:ss")),i.yb(3),i.qc(null==e.comment?null:e.comment.comment)}},directives:[r.v,r.B,c.l],pipes:[c.d],styles:[".commentDate[_ngcontent-%COMP%]{font-size:.7rem;margin-bottom:.2rem;display:flex;justify-content:flex-end;color:var(--ion-color-medium)}.commentTxt[_ngcontent-%COMP%]{white-space:normal}.commentTask[_ngcontent-%COMP%]{margin-bottom:.2rem;color:var(--ion-color-tertiary)}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;color:var(--ion-color-medium)}"]}),t})();var m=n("h7jJ"),h=n("nbnm");let u=(()=>{class t{constructor(t,e){this.dataProvider=t,this.entityNamer=e,this.commentsPrefix="comments"}getAllTasks(){return Object(o.a)(this,void 0,void 0,(function*(){return yield this.dataProvider.getAllTasks()}))}mergeTasksAndCandidateComments(t,e){return Object(o.a)(this,void 0,void 0,(function*(){return[...t,...e].sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime())}))}buildTasksGroupsByType(t){return t.reduce((t,e,n)=>(t[e.type]||(t[e.type]=[]),t[e.type].push(e),t),{})}loadCandidateComments(t){return Object(o.a)(this,void 0,void 0,(function*(){const e=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}@${t}`;return yield this.dataProvider.loadEntities(e)}))}loadComments(){return Object(o.a)(this,void 0,void 0,(function*(){const t=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}`;return(yield this.dataProvider.loadEntities(t)).sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()).reduce((t,e,n)=>{const o=t.length>0?t[t.length-1]:null,s=this.dataProvider.getCandidatesByIds([e.candidateId]);if(o&&e.comment===o.comment&&new Date(e.date).getTime()===o.date.getTime())t[t.length-1].candidates.push(...s),t[t.length-1].SavedComments.push(e);else{const n={comment:e.comment,candidates:s,date:new Date(e.date),SavedComments:[e],TaskDescRef:e.TaskDescRef};t.push(n)}return t},[])}))}deleteComments(t){return Object(o.a)(this,void 0,void 0,(function*(){yield this.dataProvider.deleteEntities(t)}))}createComment(t){var e;return Object(o.a)(this,void 0,void 0,(function*(){const n=[],o=null!==(e=t.date)&&void 0!==e?e:new Date,i=`${this.entityNamer.userPrefix()}@${this.commentsPrefix}`;let a;a=t.TaskDescRef?t.TaskDescRef.type:"general";for(const e of t.candidates){const r={type:"comment",_id:`${i}@${e._id}@${a}@${s.Guid.raw()}`,date:o,candidateId:e._id,comment:t.comment,tags:t.tags,TaskDescRef:t.TaskDescRef};n.push(r)}return yield this.dataProvider.saveEntities(n)}))}getTaskConfig(t){throw new Error("Method not implemented.")}getTaskName(){throw new Error("Method not implemented.")}saveTask(t,e){throw new Error("Method not implemented.")}loadTask(t){throw new Error("Method not implemented.")}getTaskHistory(){throw new Error("Method not implemented.")}getComponent(){throw new Error("Method not implemented.")}getHistoryComponent(){throw new Error("Method not implemented.")}getCandidateHistoryComponent(){return b}getCandidateAggregateComponent(){throw new Error("Method not implemented.")}deleteTask(t){throw new Error("Method not implemented.")}getTasksForCandidates(t){throw new Error("Method not implemented.")}checkTaskEmpty(t,e){throw new Error("Method not implemented.")}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(m.a),i.Rb(h.a))},t.\u0275prov=i.Eb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);