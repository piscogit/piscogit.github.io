(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{LTzM:function(t,e,n){"use strict";n.r(e),n.d(e,"CreateCommentPageModule",function(){return _});var i=n("ofXK"),a=n("3Pt+"),o=n("TEn/"),s=n("tyNb"),c=n("mrSG"),d=n("OZ4V"),r=n("a6kD"),l=n("Mxx3"),m=n("fXoL"),h=n("NrBX"),b=n("nTzd"),g=n("ufmx"),v=n("zrcv"),C=n("L5fO"),u=n("Cbio"),f=n("o6Vy"),p=n("3LWr"),y=n("5+WD"),k=n("g1yl");function M(t,e){1&t&&m.Mb(0,"app-candidate-avatar",19),2&t&&m.hc("candidate",e.$implicit.value)}function O(t,e){if(1&t){const t=m.Sb();m.Rb(0,"ion-item-options",27),m.Rb(1,"ion-item-option",28),m.Zb("click",function(){m.mc(t);const e=m.bc().$implicit;return m.bc(2).onDeleteSavedComment(e)}),m.Mb(2,"ion-icon",29),m.Qb(),m.Qb()}}function S(t,e){1&t&&(m.Rb(0,"span"),m.tc(1,"*"),m.Qb())}function P(t,e){if(1&t){const t=m.Sb();m.Rb(0,"ion-item-sliding",null,22),m.rc(2,O,3,0,"ion-item-options",23),m.Rb(3,"ion-item",24),m.Zb("click",function(){m.mc(t);const n=e.$implicit;return m.bc(2).savedCommentSelected(n)}),m.Rb(4,"ion-label"),m.rc(5,S,2,0,"span",25),m.Rb(6,"span",26),m.tc(7),m.Qb(),m.Qb(),m.Qb(),m.Qb()}if(2&t){const t=e.$implicit,n=m.bc(2);m.Bb(2),m.hc("ngIf",t._id),m.Bb(1),m.qc("direction",n.langProvider.LangDirection),m.Bb(2),m.hc("ngIf",!t._id),m.Bb(2),m.uc(t.comment)}}function R(t,e){if(1&t&&(m.Rb(0,"div",20),m.Rb(1,"ion-list"),m.rc(2,P,8,5,"ion-item-sliding",21),m.Qb(),m.Qb()),2&t){const t=m.bc();m.Bb(2),m.hc("ngForOf",t.savedComments)}}const w=[{path:"",component:(()=>{class t{constructor(t,e,n,i,a,o,s,c,d,r,m,h,b){this.navCtrl=t,this.modalCtrl=e,this.route=n,this.router=i,this.tasksDelegator=a,this.tasksCommentsDelegator=o,this.candidatesDelegator=s,this.msgService=c,this.popupCtrl=d,this.langProvider=r,this.micService=m,this.syncService=h,this.store=b,this.selectedCandidates={},this.dragDelay=l.a.DragDelay,this.title=this.langProvider.GeneralComment,this.isInit=!1}ngOnInit(){var t,e,n;return Object(c.a)(this,void 0,void 0,function*(){this.candidates=yield this.candidatesDelegator.getCandidatesCopy(!0),this.savedComments=yield this.tasksCommentsDelegator.loadSavedComments();const i=this.route.snapshot.paramMap.get(l.a.TaskDescId);i&&(this.taskDescRef=yield this.tasksDelegator.getTaskDesk(i),this.taskConfigRef=yield this.tasksDelegator.getTasksConfig(i),this.title=this.taskDescRef.description,this.savedComments=[...null!==(t=this.taskConfigRef.comments)&&void 0!==t?t:[],...null!==(e=this.savedComments)&&void 0!==e?e:[]]);const a=this.route.snapshot.paramMap.get(l.a.Navigate);a&&this.store.editComment.value.id===a&&(this.editedComment=this.store.editComment.value.data,this.editedComment&&(this.comment=this.editedComment.comment,this.editedComment.candidates.forEach(t=>this.selectedCandidates[t._id]=t),this.taskDescRef=this.editedComment.TaskDescRef,this.title=null===(n=this.editedComment.TaskDescRef)||void 0===n?void 0:n.description)),this.isInit=!0})}ngOnDestroy(){}selectCandidate(t){this.selectedCandidates[t._id]=this.selectedCandidates[t._id]?null:t}createComment(){var t,e;return Object(c.a)(this,void 0,void 0,function*(){this.editedComment&&(yield this.tasksCommentsDelegator.deleteComments(this.editedComment.SavedComments));const n=Object.keys(this.selectedCandidates).filter(t=>this.selectedCandidates[t]).map(t=>this.selectedCandidates[t]);if(0===n.length)this.msgService.showToast(this.langProvider.NoneSelectedCandidates,1e3,"toastWarn");else if(null===(t=this.comment)||void 0===t?void 0:t.trim()){const t={candidates:n,comment:this.comment,TaskDescRef:this.taskDescRef,date:null===(e=this.editedComment)||void 0===e?void 0:e.date},i=yield this.tasksCommentsDelegator.createComment(t);if(this.store.lastCommentsChangeDateTime.next(i[0].date),this.msgService.showToast(`${this.langProvider.CommentSaved}...`),this.taskDescRef){const t=this.store.lastTaskNavData;yield this.router.navigate([t.value.Path,t.value.Params],t.value.NavigationExtras)}else yield this.router.navigate(["tabs/comments"],{skipLocationChange:!0})}else this.msgService.showToast(this.langProvider.EmptyComment,1e3,"toastWarn")})}addSavedComment(){var t;return Object(c.a)(this,void 0,void 0,function*(){if(null===(t=this.comment)||void 0===t?void 0:t.trim()){const t={comment:this.comment.trim()},e=yield this.tasksCommentsDelegator.createSavedComment(t);this.savedComments.push(e),this.msgService.showToast(this.langProvider.SavedCommentAdded),this.comment=""}else this.msgService.showToast(this.langProvider.EmptyComment,1e3,"toastWarn")})}onDeleteSavedComment(t){return Object(c.a)(this,void 0,void 0,function*(){yield this.tasksCommentsDelegator.deleteSavedComment(t),this.savedComments=this.savedComments.filter(e=>{var n;return(null===(n=e)||void 0===n?void 0:n._id)!==t._id})})}savedCommentSelected(t){this.comment=`${this.comment?`${this.comment}\n`:""}${t.comment}`}selectCandidates(){return Object(c.a)(this,void 0,void 0,function*(){const t={};Object.keys(this.selectedCandidates).forEach(e=>t[this.selectedCandidates[e]._id]=!0);const e=yield this.modalCtrl.create({component:d.a,componentProps:{candidates:this.candidates,selectedCandidates:t,isModal:!0}});yield e.present();const n=yield e.onWillDismiss();if(n.data){const t=Object.keys(n.data).filter(t=>n.data[t]);this.selectedCandidates=yield this.candidatesDelegator.getCandidatesByIdsMap(t)}})}trackByFn(t,e){return(null==e?void 0:e.value)?e.value._id:t}recordComment(){return Object(c.a)(this,void 0,void 0,function*(){let t;try{const e=yield this.popupCtrl.create({component:r.a,backdropDismiss:!1,componentProps:{}});this.micService.startRecording(),yield e.present();const n=yield e.onWillDismiss();console.log(n.data);const i=yield this.micService.stopRecording(),a=new FormData;a.append("audioFile",i),t=yield this.msgService.showLoader(this.langProvider.Transcribe);const o=yield this.syncService.uploadComment(a);this.comment=o.text}catch(e){this.msgService.showMessage(null==e?void 0:e.message,"Record Error","toastWarn")}finally{t.dismiss()}})}back(t){var e;return Object(c.a)(this,void 0,void 0,function*(){(null===(e=this.comment)||void 0===e?void 0:e.trim())?(yield this.msgService.showAreYouSure(this.langProvider.CommentNotSaved))&&this.navCtrl.back():this.navCtrl.back()})}}return t.\u0275fac=function(e){return new(e||t)(m.Lb(o.fb),m.Lb(o.eb),m.Lb(s.a),m.Lb(s.f),m.Lb(h.a),m.Lb(b.a),m.Lb(g.a),m.Lb(v.a),m.Lb(o.ib),m.Lb(C.b),m.Lb(u.a),m.Lb(f.a),m.Lb(p.a))},t.\u0275cmp=m.Fb({type:t,selectors:[["app-create-comment"]],decls:28,vars:17,consts:[["slot","start"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],["cdkDropListGroup","",1,"container"],[1,"commentArea"],["autocomplete","on","rows","5",1,"commentText",3,"ngModel","placeholder","ngModelChange"],[1,"selectedCandidates"],["class","candi",3,"candidate",4,"ngFor","ngForOf","ngForTrackBy"],[1,"commentBtns"],["color","secondary",1,"sendBtn",3,"click"],["name","send"],["color","secondary",1,"saveCommentBtn",3,"click"],["name","save"],["color","secondary",1,"recordCommentBtn",3,"click"],["name","mic"],["color","primary",1,"selectCandidatesBtn",3,"click"],["name","people"],["class","savedComments",4,"ngIf"],[1,"candi",3,"candidate"],[1,"savedComments"],[4,"ngFor","ngForOf"],["slide",""],["side","end",4,"ngIf"],["button","",3,"click"],[4,"ngIf"],[1,"savedComment"],["side","end"],["color","light",3,"click"],["name","trash","color","danger",1,"htBtn"]],template:function(t,e){1&t&&(m.Rb(0,"ion-header"),m.Rb(1,"ion-toolbar"),m.Rb(2,"ion-buttons",0),m.Mb(3,"ion-menu-button"),m.Qb(),m.Rb(4,"ion-buttons",1),m.Rb(5,"ion-button",2),m.Zb("click",function(t){return e.back(t)}),m.Mb(6,"ion-icon",3),m.Qb(),m.Qb(),m.Rb(7,"ion-title"),m.tc(8),m.Qb(),m.Qb(),m.Qb(),m.Rb(9,"ion-content"),m.Rb(10,"div",4),m.Rb(11,"div",5),m.Rb(12,"ion-textarea",6),m.Zb("ngModelChange",function(t){return e.comment=t}),m.Qb(),m.Rb(13,"div",7),m.rc(14,M,1,1,"app-candidate-avatar",8),m.cc(15,"keyvalue"),m.Qb(),m.Rb(16,"div",9),m.Rb(17,"ion-fab-button",10),m.Zb("click",function(){return e.createComment()}),m.Mb(18,"ion-icon",11),m.Qb(),m.Rb(19,"ion-fab-button",12),m.Zb("click",function(){return e.addSavedComment()}),m.Mb(20,"ion-icon",13),m.Qb(),m.Rb(21,"ion-fab-button",14),m.Zb("click",function(){return e.recordComment()}),m.Mb(22,"ion-icon",15),m.Qb(),m.Rb(23,"ion-fab-button",16),m.Zb("click",function(){return e.selectCandidates()}),m.Mb(24,"ion-icon",17),m.Qb(),m.Qb(),m.Rb(25,"h3"),m.tc(26),m.Qb(),m.rc(27,R,3,1,"div",18),m.Qb(),m.Qb(),m.Qb()),2&t&&(m.Bb(7),m.qc("direction",e.langProvider.LangDirection),m.Bb(1),m.uc(e.title),m.Bb(4),m.qc("direction",e.langProvider.LangDirection),m.hc("ngModel",e.comment)("placeholder",e.langProvider.CreateComment),m.Bb(1),m.qc("direction",e.langProvider.LangDirection),m.Bb(1),m.hc("ngForOf",m.dc(15,15,e.selectedCandidates))("ngForTrackBy",e.trackByFn),m.Bb(11),m.qc("direction",e.langProvider.LangDirection),m.Bb(1),m.uc(e.langProvider.SavedComments),m.Bb(1),m.hc("ngIf",(null==e.savedComments?null:e.savedComments.length)>0))},directives:[o.s,o.Z,o.k,o.F,o.j,o.t,o.X,o.n,y.e,o.W,o.lb,a.e,a.h,i.l,o.p,i.m,k.a,o.D,o.B,o.w,o.C,o.A,o.z],pipes:[i.g],styles:["ion-content[_ngcontent-%COMP%]{--overflow:hidden}.container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{height:100%;width:auto;overflow:scroll;min-width:var(--avatar-empty-width)}.avatar[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width)}.avatarMargin[_ngcontent-%COMP%]{margin:var(--avatar-margin)}.avatarComment[_ngcontent-%COMP%]{height:2rem;width:2rem}.commentArea[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;justify-content:flex-start;flex:1}.commentText[_ngcontent-%COMP%]{color:var(--ion-color-dark);max-height:20%}.commentBtns[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:.3rem;min-height:auto}.closeBtn[_ngcontent-%COMP%]{margin-left:auto;--background:transparent;--color:var(--ion-color-dark)}.savedComments[_ngcontent-%COMP%]{overflow:scroll;width:100%}.savedComment[_ngcontent-%COMP%]{white-space:normal}.selectedCandidates[_ngcontent-%COMP%]{display:flex;width:100%;flex-wrap:wrap;overflow:scroll;max-height:5rem}.selectCandidatesBtn[_ngcontent-%COMP%]{margin:.5rem .5rem .5rem auto}.sendBtn[_ngcontent-%COMP%]{transform:rotate(180deg)}.recordCommentBtn[_ngcontent-%COMP%], .saveCommentBtn[_ngcontent-%COMP%], .sendBtn[_ngcontent-%COMP%]{margin:.5rem}.candi[_ngcontent-%COMP%]{height:2rem;width:2rem;margin:.2rem}.htBtn[_ngcontent-%COMP%]{font-size:x-large}"]}),t})()}];let B=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.Jb({type:t}),t.\u0275inj=m.Ib({imports:[[s.h.forChild(w)],s.h]}),t})();var D=n("ajeZ");let _=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.Jb({type:t}),t.\u0275inj=m.Ib({imports:[[i.c,a.a,o.bb,B,D.a,y.f]]}),t})()},OZ4V:function(t,e,n){"use strict";n.d(e,"a",function(){return C});var i=n("mrSG"),a=n("fXoL"),o=n("TEn/"),s=n("zrcv"),c=n("L5fO"),d=n("ofXK"),r=n("g1yl");function l(t,e){if(1&t){const t=a.Sb();a.Rb(0,"ion-header",3),a.Rb(1,"ion-toolbar"),a.Rb(2,"ion-title"),a.tc(3),a.Qb(),a.Rb(4,"ion-buttons",4),a.Rb(5,"ion-button",5),a.Zb("click",function(e){return a.mc(t),a.bc().back(e)}),a.Mb(6,"ion-icon",6),a.Qb(),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=a.bc();a.Bb(3),a.vc(" ",t.langProvider.Select," ")}}function m(t,e){if(1&t){const t=a.Sb();a.Rb(0,"app-candidate-avatar",11),a.Zb("click",function(){a.mc(t);const n=e.$implicit;return a.bc(2).select(n)}),a.Qb()}if(2&t){const t=e.$implicit,n=a.bc(2);a.hc("candidate",t)("isSelected",n.selectedCandidatesCopy[t._id])}}function h(t,e){if(1&t){const t=a.Sb();a.Rb(0,"ion-fab-button",12),a.Zb("click",function(){return a.mc(t),a.bc(2).activate()}),a.Mb(1,"ion-icon",13),a.Qb()}}function b(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"ion-content"),a.Rb(2,"div",7),a.Rb(3,"div",8),a.rc(4,m,1,2,"app-candidate-avatar",9),a.Qb(),a.rc(5,h,2,0,"ion-fab-button",10),a.Qb(),a.Qb(),a.Ob()),2&t){const t=a.bc();a.Bb(4),a.hc("ngForOf",t.candidates)("ngForTrackBy",t.trackByFn),a.Bb(1),a.hc("ngIf",t.isModal)}}function g(t,e){if(1&t){const t=a.Sb();a.Rb(0,"app-candidate-avatar",11),a.Zb("click",function(){a.mc(t);const n=e.$implicit;return a.bc(2).select(n)}),a.Qb()}if(2&t){const t=e.$implicit,n=a.bc(2);a.hc("candidate",t)("isSelected",n.selectedCandidatesCopy[t._id])}}function v(t,e){if(1&t&&(a.Rb(0,"div",14),a.rc(1,g,1,2,"app-candidate-avatar",9),a.Qb()),2&t){const t=a.bc();a.Bb(1),a.hc("ngForOf",t.candidates)("ngForTrackBy",t.trackByFn)}}let C=(()=>{class t{constructor(t,e,n){this.modalCtrl=t,this.msgService=e,this.langProvider=n,this.candidateSelected=new a.o}ngOnInit(){this.isModal?(this.select=this.selectModal,this.selectedCandidates?this.selectedCandidatesCopy=JSON.parse(JSON.stringify(this.selectedCandidates)):this.selectedCandidates={}):(this.select=this.selectNoneModal,this.selectedCandidatesCopy=this.selectedCandidates)}selectNoneModal(t){this.candidateSelected.emit(t)}selectModal(t){this.selectedCandidatesCopy[t._id]=!this.selectedCandidatesCopy[t._id]}activate(){this.modalCtrl.dismiss(this.selectedCandidatesCopy)}trackByFn(t,e){return e?e._id:t}back(t){return Object(i.a)(this,void 0,void 0,function*(){this.candidates.filter(t=>this.selectedCandidates[t._id]!=this.selectedCandidatesCopy[t._id]).length>0?(yield this.msgService.showAreYouSure(this.langProvider.DataNotSaved))&&this.modalCtrl.dismiss():this.modalCtrl.dismiss()})}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(o.eb),a.Lb(s.a),a.Lb(c.b))},t.\u0275cmp=a.Fb({type:t,selectors:[["app-candidate-selection"]],inputs:{candidates:"candidates",selectedCandidates:"selectedCandidates",isModal:"isModal"},outputs:{candidateSelected:"candidateSelected"},decls:4,vars:3,consts:[["translucent","true",4,"ngIf"],[4,"ngIf","ngIfElse"],["noModal",""],["translucent","true"],["slot","end"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"container"],[1,"candidates"],["class","candi",3,"candidate","isSelected","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","activate","color","secondary",3,"click",4,"ngIf"],[1,"candi",3,"candidate","isSelected","click"],["color","secondary",1,"activate",3,"click"],["name","checkmark"],[1,"candidates","candidatesNonModal"]],template:function(t,e){if(1&t&&(a.rc(0,l,7,1,"ion-header",0),a.rc(1,b,6,3,"ng-container",1),a.rc(2,v,2,2,"ng-template",null,2,a.sc)),2&t){const t=a.lc(3);a.hc("ngIf",e.isModal),a.Bb(1),a.hc("ngIf",e.isModal)("ngIfElse",t)}},directives:[d.m,o.s,o.Z,o.X,o.k,o.j,o.t,o.n,d.l,r.a,o.p],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.candidates[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-content:flex-start;overflow:scroll}.candidatesNonModal[_ngcontent-%COMP%]{height:100%}.candi[_ngcontent-%COMP%]{height:var(--avatar-height);width:var(--avatar-width);margin:.5rem}.activate[_ngcontent-%COMP%]{margin:.5rem auto}"]}),t})()}}]);